{% extends "base.html" %}

{% block content %}
<div class="container py-3 py-md-5"
     x-data="alpineData()"
     x-init="initTooltips(); init(); showNotification('Selamat datang di AI Image Generator! Silakan pilih mode yang diinginkan.', 'info')">
  <!-- Modern Tab Switcher -->
  <div class="mb-5 modern-tab-container" :class="{ 'loading': loading }">
    <div class="modern-tab-wrapper">
      <div class="modern-tab-background" 
           :data-tab="tab"
           :style="getTabBackgroundStyle()"></div>
      
      <button type="button" 
              class="modern-tab-btn" 
              :class="{ 'active': tab==='generate' }" 
              @click="switchTab('generate')">
        <div class="tab-icon">
          <i class="bi bi-image"></i>
        </div>
        <div class="tab-content">
          <span class="tab-title">Generate Gambar</span>
          <span class="tab-subtitle">Buat gambar dengan AI</span>
        </div>
        <div class="tab-indicator" :class="{ 'active': tab==='generate' }"></div>
      </button>
      
      <button type="button" 
              class="modern-tab-btn" 
              :class="{ 'active': tab==='fusigaya' }" 
              @click="switchTab('fusigaya')">
        <div class="tab-icon">
          <i class="bi bi-palette"></i>
        </div>
        <div class="tab-content">
          <span class="tab-title">Fusigaya</span>
          <span class="tab-subtitle">Style transfer AI</span>
        </div>
        <div class="tab-indicator" :class="{ 'active': tab==='fusigaya' }"></div>
      </button>
      
      <button type="button" 
              class="modern-tab-btn" 
              :class="{ 'active': tab==='faceswap' }" 
              @click="switchTab('faceswap')">
        <div class="tab-icon">
          <i class="bi bi-person-badge"></i>
        </div>
        <div class="tab-content">
          <span class="tab-title">Face Swap</span>
          <span class="tab-subtitle">Tukar wajah dengan AI</span>
        </div>
        <div class="tab-indicator" :class="{ 'active': tab==='faceswap' }"></div>
      </button>
    </div>
  </div>
  
  <!-- Informasi Biaya -->
  <div class="mb-4" x-show="tab === 'generate'">
    <div class="glass-panel p-3 cost-info-panel">
      <div class="d-flex align-items-center cost-info-content">
        <i class="bi bi-info-circle text-info me-3 fs-4 cost-info-icon"></i>
        <div class="cost-info-text">
          <div class="text-white fw-semibold cost-info-main">
            Permintaan Anda akan dikenakan biaya 
            <strong class="text-warning" x-text="
              photo.model === 'gpt-image-1' ? '12 kredit' : '15 kredit'
            "></strong> 
            per kali generate.
            <span x-show="photo.model === 'gpt-image-1'" class="text-success ms-2">
              <i class="bi bi-rocket me-1"></i>Model Cepat
            </span>
            <span x-show="photo.model === 'imagen4-ultra'" class="text-primary ms-2">
              <i class="bi bi-star-fill me-1"></i>Kualitas Premium
            </span>
          </div>
          <!-- <div class="text-muted">Dengan <strong>$1</strong> Anda dapat menjalankan model ini sekitar <strong>50</strong> kali.</div> -->
        </div>
      </div>
    </div>
  </div>
  
  <!-- Informasi Biaya Generate Miniatur -->
  <div class="mb-4" x-show="tab === 'miniatur'">
    <div class="glass-panel p-3 cost-info-panel">
      <div class="d-flex align-items-center cost-info-content">
        <i class="bi bi-info-circle text-info me-3 fs-4 cost-info-icon"></i>
        <div class="cost-info-text">
          <div class="text-white fw-semibold cost-info-main">
            Permintaan Anda akan dikenakan biaya 
            <strong class="text-warning">10 kredit</strong>
          </div>
          <div class="text-muted cost-info-sub">Edit gambar dengan AI menggunakan prompt instruksi</div>
        </div>
      </div>
    </div>
  </div>

  
  <div class="row justify-content-center align-items-stretch g-3 g-md-4">
    <!-- Form Kiri -->
    <div class="col-12 col-lg-6 d-flex">
      <div class="glass-panel p-3 p-md-4 w-100 d-flex flex-column justify-content-between">
        <div>
          <!-- Form Generate Gambar (lama) -->
          <form x-show="tab==='generate'" @submit.prevent="submitPhoto()">
            <!-- Judul Gambar Section -->
            <div class="mb-4 title-input-section">
              <!-- Label -->
              <div class="title-label-container">
                <label class="form-label text-secondary d-flex align-items-center mb-2">
                  <i class="bi bi-pencil-square me-2"></i>Judul Gambar
                </label>
              </div>
              
              <!-- Input Field dengan Character Counter -->
              <div class="input-with-counter-container">
                <div class="input-field-wrapper">
                  <input 
                    type="text" 
                    class="form-control form-dark focus-ring title-input" 
                    x-model="photo.title"
                    placeholder="Masukkan judul gambar Anda... Contoh: 'Wanita dengan jaket denim yang sedang duduk di kafe dengan suasana yang hangat dan nyaman, sambil menikmati secangkir kopi panas dengan latar belakang kota yang ramai dan modern, dengan pencahayaan alami yang lembut dan suasana yang tenang dan damai'"
                    maxlength="300">
                  <!-- Character Counter di sebelah kanan input -->
                  <div class="inline-char-counter" :class="photoCharCounterClass">
                    <span class="char-counter-text-inline" x-text="`${photo.title.length}/300`"></span>
                  </div>
                </div>
              </div>
              
              <!-- Generate Button -->
              <div class="generate-btn-container">
                <button 
                  type="button"
                  class="btn btn-outline-primary hover-lift focus-ring generate-prompt-btn" 
                  :class="{ 'generating': isGeneratingPrompt }"
                  @click="generatePromptFromTitle()" 
                  :disabled="!photo.title.trim() || isGeneratingPrompt"
                  title="Generate prompt otomatis dari judul">
                  <span x-show="!isGeneratingPrompt" class="btn-content">
                    <i class="bi bi-magic me-2"></i>Generate Prompt
                  </span>
                  <span x-show="isGeneratingPrompt" class="btn-content">
                    <i class="bi bi-arrow-repeat spinner me-2"></i>Generating...
                  </span>
                </button>
              </div>
              
              <!-- Input Hint -->
              <div class="input-hint">
                <i class="bi bi-lightbulb me-2"></i>
                <small>AI akan membuat prompt detail berdasarkan judul yang Anda masukkan. Prompt dan negative prompt akan otomatis terisi!</small>
              </div>
            </div>
            
            <!-- Model Selection -->
            <div class="photo-model-selection">
              <label class="form-label text-secondary">
                <i class="bi bi-cpu me-2"></i>Pilih Model AI
              </label>
              <select class="form-control form-dark" x-model="photo.model" @change="onPhotoModelChange()">
                <option value="imagen4-ultra">Imagen4 Ultra (High Quality) - 15 kredit</option>
                <option value="gpt-image-1">GPT Image 1 (Fast & Creative) - 12 kredit</option>
              </select>
              <div class="input-hint mt-2">
                <i class="bi bi-info-circle me-2"></i>
                <small>
                  <strong>Imagen4 Ultra:</strong> Kualitas tinggi untuk hasil yang detail dan realistis. 
                  <strong>GPT Image 1:</strong> Cepat dan kreatif untuk eksperimen dan ide baru.
                </small>
              </div>
            </div>
            
            <div class="mb-3">
              <label class="form-label text-secondary">Prompt Gambar</label>
              <textarea class="form-control form-dark" rows="2" placeholder="denim jacket, white headphones around her neck, sipping iced coffee from a clear plastic cup. Her short curly hair blows slightly in the wind as city lights begin to glow in the distance." x-model="photo.prompt" required></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label text-secondary">Negative Prompt <span class='text-muted' style='font-size:0.95em;'>(opsional)</span></label>
              <input type="text" class="form-control form-dark" placeholder="Contoh: blur, noise, distorsi" x-model="photo.negative_prompt">
              <div class="input-hint">
                <i class="bi bi-info-circle me-1"></i>
                <small>Negative prompt akan otomatis terisi saat generate prompt dari judul</small>
              </div>
            </div>
            <div class="mb-3 row g-2">
              <div class="col-md-6">
                <label class="form-label text-secondary">Rasio Aspek</label>
                <select class="form-select form-dark" x-model="photo.aspect">
                  <option value="1:1">1:1 (Persegi)</option>
                  <option value="16:9">16:9 (Landscape)</option>
                  <option value="9:16">9:16 (Portrait)</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label text-secondary">Format Output</label>
                <select class="form-select form-dark" x-model="photo.format">
                  <option value="jpg">JPG</option>
                  <option value="png">PNG</option>
                  <option value="webp">WEBP</option>
                </select>
              </div>
            </div>
            <div class="d-grid mt-4">
              <button type="submit" class="btn btn-gradient py-3 fw-bold fs-5" :disabled="loading">
                <span x-show="!loading">Generate Gambar</span>
                <span x-show="loading"><span class="spinner-border spinner-border-sm me-2"></span>Memproses...</span>
              </button>
            </div>
          </form>
          <!-- Form Fusigaya -->
          <form x-show="tab==='fusigaya'" @submit.prevent="submitFusigaya()">
            <!-- Model Status Header -->
            <div class="model-status-header mb-3" x-show="fusigaya.model">
              <div class="d-flex align-items-center justify-content-between">
                <div class="model-info">
                  <span class="badge bg-primary me-2">
                    <i class="bi bi-cpu me-1"></i>
                    <span x-text="
                      fusigaya.model === 'flux-kontext-dev' ? 'FLUX.1 Dev' :
                      fusigaya.model === 'flux-kontext-pro' ? 'FLUX.1 Pro' :
                      'Nano Banana'
                    "></span>
                  </span>
                  <small class="text-muted" x-text="
                    fusigaya.model === 'flux-kontext-dev' ? 'Model cepat untuk eksperimen' :
                    fusigaya.model === 'flux-kontext-pro' ? 'Model premium berkualitas tinggi' :
                    'Model khusus style editing'
                  "></small>
                </div>
                <div class="model-cost">
                  <span class="badge bg-warning text-dark">
                    <i class="bi bi-credit-card me-1"></i>
                    <span x-text="
                      fusigaya.model === 'flux-kontext-pro' ? '6 kredit' : '4 kredit'
                    "></span>
                  </span>
                </div>
              </div>
            </div>
            <div class="alert alert-info d-flex align-items-center mb-4 cost-info-panel">
              <i class="bi bi-info-circle text-info me-3 fs-4 cost-info-icon"></i>
              <div class="cost-info-text">
                <div class="text-white fw-semibold cost-info-main">
                  Permintaan Anda akan dikenakan biaya 
                  <strong class="text-warning" x-text="
                    fusigaya.model === 'nano-banana' ? '4 kredit' : 
                    fusigaya.model === 'flux-kontext-pro' ? '6 kredit' : 
                    '4 kredit'
                  "></strong> 
                  per kali generate.
                  <span x-show="fusigaya.model === 'flux-kontext-pro'" class="text-success ms-2">
                    <i class="bi bi-star-fill me-1"></i>Kualitas Premium
                  </span>
                </div>
              </div>
            </div>
            
            <!-- Judul Gambar Section untuk Fusigaya -->
            <div class="mb-4 title-input-section">
              <!-- Label -->
              <div class="title-label-container">
                <label class="form-label fw-bold d-flex align-items-center mb-2">
                  <i class="bi bi-pencil-square me-2"></i>Judul Gambar
                </label>
              </div>
              
              <!-- Input Field dengan Character Counter -->
              <div class="input-with-counter-container">
                <div class="input-field-wrapper">
                  <input 
                    type="text" 
                    class="form-control form-dark focus-ring title-input" 
                    x-model="fusigaya.title"
                    placeholder="Masukkan judul gambar untuk fusigaya... Contoh: 'Portrait wanita dengan gaya anime yang sedang berdiri di taman bunga dengan latar belakang matahari terbenam, dengan suasana yang romantis dan damai, sambil memegang bunga mawar merah yang indah dan elegan'"
                    maxlength="300">
                  <!-- Character Counter di sebelah kanan input -->
                  <div class="inline-char-counter" :class="fusigayaCharCounterClass">
                    <span class="char-counter-text-inline" x-text="`${fusigaya.title.length}/300`"></span>
                  </div>
                </div>
              </div>
              
              <!-- Generate Button -->
              <div class="generate-btn-container">
                <button 
                  type="button"
                  class="btn btn-outline-primary hover-lift focus-ring generate-prompt-btn" 
                  :class="{ 'generating': isGeneratingFusigayaPrompt }"
                  @click="generateFusigayaPromptFromTitle()" 
                  :disabled="!fusigaya.title.trim() || isGeneratingFusigayaPrompt"
                  title="Generate prompt otomatis dari judul">
                  <span x-show="!isGeneratingFusigayaPrompt" class="btn-content">
                    <i class="bi bi-magic me-2"></i>Generate Prompt
                  </span>
                  <span x-show="isGeneratingFusigayaPrompt" class="btn-content">
                    <i class="bi bi-arrow-repeat spinner me-2"></i>Generating...
                  </span>
                </button>
              </div>
              
              <div class="input-hint">
                <i class="bi bi-lightbulb me-2"></i>
                <small>AI akan menganalisis gambar yang diupload dan membuat <strong>satu prompt FLUX.1 Kontext yang detail, spesifik, dan siap pakai</strong> untuk style fusion. Upload gambar terlebih dahulu agar AI bisa menganalisis dengan akurat dan membuat prompt yang sesuai dengan foto Anda!</small>
              </div>
            </div>
            
            <!-- Model Selection -->
            <div class="model-selection-container">
              <label class="form-label fw-bold">
                <i class="bi bi-cpu me-2"></i>Pilih Model
              </label>
              <select class="form-control form-dark" x-model="fusigaya.model" @change="onModelChange()" title="Pilih model AI yang sesuai dengan kebutuhan Anda">
                <option value="flux-kontext-dev" title="Model cepat untuk eksperimen dan testing">FLUX.1 Kontext Dev (Ultra Fast) - Rekomendasi</option>
                <option value="flux-kontext-pro" title="Model premium untuk hasil berkualitas tinggi">FLUX.1 Kontext Pro (High Quality)</option>
                <option value="nano-banana" title="Model khusus untuk style editing dan transfer">Nano Banana (Style Edit)</option>
              </select>
              <div class="input-hint mt-2">
                <i class="bi bi-info-circle me-2"></i>
                <small>
                  <strong>FLUX.1 Kontext Dev:</strong> Cepat dan efisien untuk eksperimen. 
                  <strong>FLUX.1 Kontext Pro:</strong> Kualitas tinggi untuk hasil final. 
                  <strong>Nano Banana:</strong> Khusus untuk editing dan style transfer.
                </small>
              </div>
            </div>
            
            <label class="form-label fw-bold">Prompt*</label>
            <textarea class="form-control form-dark mb-3" x-model="fusigaya.prompt" required placeholder="Masukkan prompt untuk fusigaya..."></textarea>
            
            <!-- Modern Upload Area untuk Fusigaya -->
            <div class="mb-4">
              <label class="form-label fw-bold">
                <i class="bi bi-images me-2"></i>Upload Gambar
              </label>
              <small class="text-muted d-block mb-3">Upload gambar yang akan difusikan dengan gaya tertentu</small>
              
              <div class="alert alert-info mb-3">
                <i class="bi bi-info-circle me-2"></i>
                <strong>Tips:</strong> Gunakan gambar dengan wajah yang jelas dan resolusi tinggi (minimal 512x512) untuk hasil terbaik. Format yang didukung: JPG, PNG, WEBP.
              </div>
              
              <template x-for="(img, idx) in fusigaya.images" :key="idx">
                <div class="modern-upload-area mb-3" :class="{ 'has-preview': img.preview, 'dragover': img.dragover }"
                     @dragover.prevent="img.dragover = true"
                     @drop.prevent="handleDrop($event, idx)"
                     @dragenter.prevent="img.dragover = true"
                     @dragleave.prevent="img.dragover = false">
                  <!-- Upload Placeholder -->
                  <div x-show="!img.preview" class="upload-placeholder" @click="triggerFileInput(idx)">
                    <i class="bi bi-cloud-upload upload-icon"></i>
                    <h5>Upload Gambar</h5>
                    <p>Klik untuk memilih file atau drag & drop</p>
                    <div class="upload-hint">Supports: JPG, PNG, WEBP (Max: 10MB)</div>
                  </div>
                  
                  <!-- Image Preview -->
                  <div x-show="img.preview" class="image-preview-container">
                    <img :src="img.preview" class="preview-img" alt="Preview">
                    <div class="image-actions">
                      <button type="button" class="btn btn-sm btn-outline-primary" @click="triggerFileInput(idx)">
                        <i class="bi bi-arrow-repeat"></i> Ganti
                      </button>
                      <button type="button" class="btn btn-sm btn-outline-info" @click="showGallery = idx">
                        <i class="bi bi-images"></i> Galeri
                      </button>
                      <button type="button" class="btn btn-sm btn-outline-warning" @click="clearImageInput(idx)">
                        <i class="bi bi-trash"></i> Hapus
                      </button>
                    </div>
                  </div>
                  
                  <!-- Empty State Actions (ketika belum ada gambar) -->
                  <div x-show="!img.preview" class="empty-state-actions">
                    <button type="button" class="btn btn-sm btn-outline-danger" @click="removeFusigayaImage(idx)" 
                            x-show="fusigaya.images.length > 1" 
                            title="Hapus slot gambar ini">
                      <i class="bi bi-trash"></i> Hapus Slot
                    </button>
                  </div>
                  
                  <!-- Hidden File Input -->
                  <input 
                    type="file" 
                    :id="'fusigayaFile' + idx"
                    accept="image/*" 
                    @change="handleFusigayaFile($event, idx)" 
                    style="display: none;">
                  
                  <!-- URL Input -->
                  <div class="url-input-container mt-2">
                    <div class="input-group">
                      <span class="input-group-text">
                        <i class="bi bi-link-45deg"></i>
                      </span>
                      <input 
                        type="text" 
                        class="form-control form-dark" 
                        :value="img.url" 
                        @input="handleFusigayaUrl($event, idx)" 
                        placeholder="Atau masukkan URL gambar...">
                      <button type="button" class="btn btn-outline-secondary" @click="clearImageInput(idx)" title="Clear input">
                        <i class="bi bi-x-lg"></i>
                      </button>
                    </div>
                  </div>
                  
                  <!-- Upload Progress Bar -->
                  <div x-show="img.uploadProgress > 0 && img.uploadProgress < 100" class="upload-progress mt-2">
                    <div class="progress-info">
                      <span class="progress-text">Uploading...</span>
                      <span class="progress-percent" x-text="`${Math.round(img.uploadProgress)}%`"></span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill" :style="`width: ${img.uploadProgress}%`"></div>
                    </div>
                  </div>
                  
                  <!-- Gallery Button untuk Slot ini -->
                  <div class="mt-2">
                    <button type="button" class="btn btn-tag btn-sm" @click="showFusigayaSlotGallery = idx">
                      <i class="bi bi-images me-1"></i>Pilih dari Galeri
                    </button>
                  </div>
                </div>
              </template>
              
              <div class="d-flex justify-content-between align-items-center mb-3">
                <button type="button" class="btn btn-outline-secondary" 
                        @click="addFusigayaImage()"
                        :disabled="fusigaya.images.length >= 10"
                        :class="{ 'btn-disabled': fusigaya.images.length >= 10 }">
                  <i class="bi bi-plus-circle me-2"></i>+ Tambah Gambar
                </button>
                <small class="text-muted">
                  <i class="bi bi-info-circle me-1"></i>
                  Slot: <span x-text="fusigaya.images.length"></span> / 10
                </small>
              </div>
              
              <!-- Gallery Modal untuk setiap slot Fusigaya -->
              {% raw %}
              <template x-for="(slot, idx) in fusigaya.images" :key="idx">
                <template x-if="showFusigayaSlotGallery === idx">
                  <div class="gallery-overlay" @click.self="showFusigayaSlotGallery = null">
                    <div class="gallery-popup animate__animated animate__zoomIn">
                      <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="fw-bold text-gradient fs-5">
                          <i class="bi bi-images me-2"></i>Galeri Gambar - Slot <span x-text="idx + 1"></span>
                        </div>
                        <button type="button" class="btn-close btn-close-white" aria-label="Close" @click="showFusigayaSlotGallery = null"></button>
                      </div>
                      <div class="mb-3 small text-secondary">
                        <i class="bi bi-info-circle me-1"></i>Pilih gambar untuk slot <span x-text="idx + 1"></span>
                      </div>
                      
                      <!-- Gallery Images -->
                      <div class="mb-4">
                        <div class="fw-bold text-gradient fs-6 mb-2">
                          <i class="bi bi-image me-2"></i>Galeri Gambar
                        </div>
                        <div class="d-flex flex-wrap gap-2">
                          <template x-for="img in galleryImages" :key="img.id">
                            <div class="gallery-thumb" style="cursor:pointer;" 
                                 @click="setFusigayaImageFromGallery(idx, img.url); showFusigayaSlotGallery = null"
                                 title="Klik untuk memilih gambar ini">
                              <img :src="img.url" :alt="img.caption" class="gallery-img">
                            </div>
                          </template>
                        </div>
                      </div>
                      
                      <!-- Generated Images -->
                      <div class="mb-3">
                        <div class="fw-bold text-gradient fs-6 mb-2">
                          <i class="bi bi-stars me-2"></i>Gambar Hasil Generate
                        </div>
                        <div class="d-flex flex-wrap gap-2">
                          <template x-for="img in galleryGenerated" :key="img.id">
                            <div class="gallery-thumb" style="cursor:pointer;" 
                                 @click="setFusigayaImageFromGallery(idx, img.url); showFusigayaSlotGallery = null"
                                 title="Klik untuk memilih gambar ini">
                              <img :src="img.url" :alt="img.caption" class="gallery-img gallery-img-gen">
                            </div>
                          </template>
                        </div>
                      </div>
                    </div>
                  </div>
                </template>
              </template>
              {% endraw %}
            </div>
            
            <!-- Advanced Parameters - Only show for FLUX models -->
            <div x-show="fusigaya.model !== 'nano-banana'" class="advanced-parameters-section">
              <div class="mb-3">
                <h6 class="text-gradient fw-bold">
                  <i class="bi bi-sliders me-2"></i>Parameter Lanjutan
                </h6>
                <small class="text-muted">Parameter ini hanya tersedia untuk model FLUX.1 Kontext</small>
              </div>
              
              <div class="mb-2">
                <label>Size <small class="text-muted">(opsional, contoh: 512x512, 1024x1024)</small></label>
                <input type="text" class="form-control form-dark" x-model="fusigaya.size" placeholder="512x512">
              </div>
              <div class="mb-2">
                <label title="Jumlah langkah untuk menghasilkan gambar, lebih tinggi = lebih detail tapi lebih lama (rekomendasi: 20-50)">num_inference_steps <i class="bi bi-question-circle text-muted"></i></label>
                <input type="number" class="form-control form-dark" x-model="fusigaya.num_inference_steps" min="1" max="100">
              </div>
              <div class="mb-2">
                <label title="Seberapa ketat mengikuti prompt, lebih tinggi = lebih ketat (rekomendasi: 2.0-7.5)">guidance_scale <i class="bi bi-question-circle text-muted"></i></label>
                <input type="number" class="form-control form-dark" x-model="fusigaya.guidance_scale" step="0.1" min="0.1" max="20">
              </div>
              <div class="mb-2">
                <label title="Jumlah gambar yang akan dihasilkan (rekomendasi: 1-4 untuk performa optimal)">num_images <i class="bi bi-question-circle text-muted"></i></label>
                <input type="number" class="form-control form-dark" x-model="fusigaya.num_images" min="1" max="10">
              </div>
              <div class="mb-2">
                <label title="Seed untuk konsistensi hasil, -1 = random, angka positif = hasil yang konsisten">Seed <i class="bi bi-question-circle text-muted"></i></label>
                <input type="number" class="form-control form-dark" x-model="fusigaya.seed">
              </div>
              <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" x-model="fusigaya.enable_base64_output" id="base64out">
                <label class="form-check-label" for="base64out" title="Mengembalikan hasil dalam format base64 (untuk pengembangan)">enable_base64_output <i class="bi bi-question-circle text-muted"></i></label>
              </div>
              <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" x-model="fusigaya.enable_safety_checker" id="safetycheck">
                <label class="form-check-label" for="safetycheck" title="Memeriksa konten yang tidak aman (rekomendasi: aktif)">enable_safety_checker <i class="bi bi-question-circle text-muted"></i></label>
              </div>
            </div>
            
            <!-- Nano Banana specific parameters -->
            <div x-show="fusigaya.model === 'nano-banana'" class="nano-banana-params">
              <div class="mb-3">
                <h6 class="text-gradient fw-bold">
                  <i class="bi bi-magic me-2"></i>Parameter Nano Banana
                </h6>
                <small class="text-muted">Model ini khusus untuk style editing dan transfer</small>
              </div>
              
              <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" x-model="fusigaya.enable_base64_output" id="base64out-nano">
                <label class="form-check-label" for="base64out-nano" title="Mengembalikan hasil dalam format base64 (untuk pengembangan)">enable_base64_output <i class="bi bi-question-circle text-muted"></i></label>
              </div>
            </div>
            <button type="submit" class="btn btn-gradient py-2 fw-bold" :disabled="loading">
              <span x-show="!loading">Generate Fusigaya</span>
              <span x-show="loading"><span class="spinner-border spinner-border-sm me-2"></span>Memproses...</span>
            </button>
          </form>
          <!-- Form Face Swap -->
          <form x-show="tab==='faceswap'" @submit.prevent="submitFaceSwap()" class="face-swap-form">
            <div class="alert alert-info d-flex align-items-center mb-4 cost-info-panel">
              <i class="bi bi-info-circle text-info me-3 fs-4 cost-info-icon"></i>
              <div class="cost-info-text">
                <div class="text-white fw-semibold cost-info-main">Permintaan Anda akan dikenakan biaya <strong class="text-warning">1 kredit</strong> per kali generate.</div>
              </div>
            </div>
            
            <!-- Main Image Upload -->
            <div class="mb-4">
              <label class="form-label fw-bold">
                <i class="bi bi-image me-2"></i>Gambar Utama
              </label>
              <small class="text-muted d-block mb-3">Upload gambar utama yang akan ditukar wajahnya</small>
              
              <div class="modern-upload-area" :class="{ 'has-preview': faceSwap.imagePreview, 'dragover': faceSwap.imageDragover }"
                   @dragover.prevent="faceSwap.imageDragover = true"
                   @drop.prevent="handleFaceSwapDrop($event, 'image')"
                   @dragenter.prevent="faceSwap.imageDragover = true"
                   @dragleave.prevent="faceSwap.imageDragover = false">
                <!-- Upload Placeholder -->
                <div x-show="!faceSwap.imagePreview" class="upload-placeholder" @click="triggerFaceSwapFileInput('image')">
                  <i class="bi bi-cloud-upload upload-icon"></i>
                  <h5>Upload Gambar Utama</h5>
                  <p>Klik untuk memilih file atau drag & drop</p>
                  <div class="upload-hint">Supports: JPG, PNG, WEBP (Max: 10MB)</div>
                </div>
                
                <!-- Image Preview -->
                <div x-show="faceSwap.imagePreview" class="image-preview-container">
                  <img :src="faceSwap.imagePreview" class="preview-img" alt="Main Image Preview">
                  <div class="image-actions">
                    <button type="button" class="btn btn-sm btn-outline-primary" @click="triggerFaceSwapFileInput('image')">
                      <i class="bi bi-arrow-repeat"></i> Ganti
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-info" @click="showGallery = 'image'">
                      <i class="bi bi-images"></i> Galeri
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-warning" @click="clearFaceSwapInput('image')">
                      <i class="bi bi-trash"></i> Hapus
                    </button>
                  </div>
                </div>
                
                <!-- Hidden File Input -->
                <input 
                  type="file" 
                  id="faceSwapImageInput"
                  accept="image/*" 
                  @change="handleFaceSwapImageFile($event, 'image')" 
                  style="display: none;">
                
                <!-- URL Input -->
                <div class="url-input-container mt-2">
                  <div class="input-group">
                    <span class="input-group-text">
                      <i class="bi bi-link-45deg"></i>
                    </span>
                    <input 
                      type="text" 
                      class="form-control form-dark" 
                      :value="faceSwap.image" 
                      @input="handleFaceSwapUrl($event, 'image')" 
                      placeholder="Atau masukkan URL gambar...">
                    <button type="button" class="btn btn-outline-secondary" @click="clearFaceSwapInput('image')" title="Clear input">
                      <i class="bi bi-x-lg"></i>
                    </button>
                  </div>
                </div>
                
                <!-- Upload Progress Bar -->
                <div x-show="faceSwap.imageUploadProgress > 0 && faceSwap.imageUploadProgress < 100" class="upload-progress mt-2">
                  <div class="progress-info">
                    <span class="progress-text">Uploading...</span>
                    <span class="progress-percent" x-text="`${Math.round(faceSwap.imageUploadProgress)}%`"></span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill" :style="`width: ${faceSwap.imageUploadProgress}%`"></div>
                  </div>
                </div>
              </div>
              
              <!-- Gallery Button untuk Gambar Utama Face Swap -->
              <div class="mt-3">
                <button type="button" class="btn btn-tag me-2" @click="showFaceSwapMainGallery = true">
                  <i class="bi bi-images me-2"></i>Pilih dari Galeri
                </button>
              </div>
            </div>
            
            <!-- Face Image Upload -->
            <div class="mb-4">
              <label class="form-label fw-bold">
                <i class="bi bi-person-badge me-2"></i>Gambar Wajah
              </label>
              <small class="text-muted d-block mb-3">Upload gambar wajah yang akan ditukar</small>
              
              <div class="modern-upload-area" :class="{ 'has-preview': faceSwap.faceImagePreview, 'dragover': faceSwap.faceDragover }"
                   @dragover.prevent="faceSwap.faceDragover = true"
                   @drop.prevent="handleFaceSwapDrop($event, 'face')"
                   @dragenter.prevent="faceSwap.faceDragover = true"
                   @dragleave.prevent="faceSwap.faceDragover = false">
                <!-- Upload Placeholder -->
                <div x-show="!faceSwap.faceImagePreview" class="upload-placeholder" @click="triggerFaceSwapFileInput('face')">
                  <i class="bi bi-cloud-upload upload-icon"></i>
                  <h5>Upload Gambar Wajah</h5>
                  <p>Klik untuk memilih file atau drag & drop</p>
                  <div class="upload-hint">Supports: JPG, PNG, WEBP (Max: 10MB)</div>
                </div>
                
                <!-- Image Preview -->
                <div x-show="faceSwap.faceImagePreview" class="image-preview-container">
                  <img :src="faceSwap.faceImagePreview" class="preview-img" alt="Face Image Preview">
                  <div class="image-actions">
                    <button type="button" class="btn btn-sm btn-outline-primary" @click="triggerFaceSwapFileInput('face')">
                      <i class="bi bi-arrow-repeat"></i> Ganti
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-info" @click="showGallery = 'face'">
                      <i class="bi bi-images"></i> Galeri
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-warning" @click="clearFaceSwapInput('face')">
                      <i class="bi bi-trash"></i> Hapus
                    </button>
                  </div>
                </div>
                
                <!-- Hidden File Input -->
                <input 
                  type="file" 
                  id="faceSwapFaceInput"
                  accept="image/*" 
                  @change="handleFaceSwapImageFile($event, 'face')" 
                  style="display: none;">
                
                <!-- URL Input -->
                <div class="url-input-container mt-2">
                  <div class="input-group">
                    <span class="input-group-text">
                      <i class="bi bi-link-45deg"></i>
                    </span>
                    <input 
                      type="text" 
                      class="form-control form-dark" 
                      :value="faceSwap.faceImage" 
                      @input="handleFaceSwapUrl($event, 'face')" 
                      placeholder="Atau masukkan URL gambar...">
                    <button type="button" class="btn btn-outline-secondary" @click="clearFaceSwapInput('face')" title="Clear input">
                      <i class="bi bi-x-lg"></i>
                    </button>
                  </div>
                </div>
                
                <!-- Upload Progress Bar -->
                <div x-show="faceSwap.faceUploadProgress > 0 && faceSwap.faceUploadProgress < 100" class="upload-progress mt-2">
                  <div class="progress-info">
                    <span class="progress-text">Uploading...</span>
                    <span class="progress-percent" x-text="`${Math.round(faceSwap.faceUploadProgress)}%`"></span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill" :style="`width: ${faceSwap.faceUploadProgress}%`"></div>
                  </div>
                </div>
              </div>
              
              <!-- Gallery Button untuk Gambar Wajah Face Swap -->
              <div class="mt-3">
                <button type="button" class="btn btn-tag me-2" @click="showFaceSwapFaceGallery = true">
                  <i class="bi bi-images me-2"></i>Pilih dari Galeri
                </button>
              </div>
            </div>
            

            
            <!-- Gallery Modal untuk Gambar Utama Face Swap -->
            {% raw %}
            <template x-if="showFaceSwapMainGallery">
              <div class="gallery-overlay" @click.self="showFaceSwapMainGallery = false">
                <div class="gallery-popup animate__animated animate__zoomIn">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="fw-bold text-gradient fs-5">
                      <i class="bi bi-image me-2"></i>Galeri Gambar Utama - Face Swap
                    </div>
                    <button type="button" class="btn-close btn-close-white" aria-label="Close" @click="showFaceSwapMainGallery = false"></button>
                  </div>
                  <div class="mb-3 small text-secondary">
                    <i class="bi bi-info-circle me-1"></i>Pilih gambar utama yang akan ditukar wajahnya
                  </div>
                  
                  <!-- Gallery Images -->
                  <div class="mb-4">
                    <div class="fw-bold text-gradient fs-6 mb-2">
                      <i class="bi bi-image me-2"></i>Galeri Gambar
                    </div>
                    <div class="d-flex flex-wrap gap-2">
                      <template x-for="img in galleryImages" :key="img.id">
                        <div class="gallery-thumb" style="cursor:pointer;" 
                             @click="setFaceSwapMainImage(img.url); showFaceSwapMainGallery = false"
                             title="Klik untuk memilih gambar ini">
                          <img :src="img.url" :alt="img.caption" class="gallery-img">
                        </div>
                      </template>
                    </div>
                  </div>
                  
                  <!-- Generated Images -->
                  <div class="mb-3">
                    <div class="fw-bold text-gradient fs-6 mb-2">
                      <i class="bi bi-stars me-2"></i>Gambar Hasil Generate
                    </div>
                    <div class="d-flex flex-wrap gap-2">
                      <template x-for="img in galleryGenerated" :key="img.id">
                        <div class="gallery-thumb" style="cursor:pointer;" 
                             @click="setFaceSwapMainImage(img.url); showFaceSwapMainGallery = false"
                             title="Klik untuk memilih gambar ini">
                          <img :src="img.url" :alt="img.caption" class="gallery-img gallery-img-gen">
                        </div>
                      </template>
                    </div>
                  </div>
                </div>
              </div>
            </template>
            {% endraw %}
            
            <!-- Gallery Modal untuk Gambar Wajah Face Swap -->
            {% raw %}
            <template x-if="showFaceSwapFaceGallery">
              <div class="gallery-overlay" @click.self="showFaceSwapFaceGallery = false">
                <div class="gallery-popup animate__animated animate__zoomIn">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="fw-bold text-gradient fs-5">
                      <i class="bi bi-person-badge me-2"></i>Galeri Gambar Wajah - Face Swap
                    </div>
                    <button type="button" class="btn-close btn-close-white" aria-label="Close" @click="showFaceSwapFaceGallery = false"></button>
                  </div>
                  <div class="mb-3 small text-secondary">
                    <i class="bi bi-info-circle me-1"></i>Pilih gambar wajah yang akan ditukar
                  </div>
                  
                  <!-- Gallery Images -->
                  <div class="mb-4">
                    <div class="fw-bold text-gradient fs-6 mb-2">
                      <i class="bi bi-image me-2"></i>Galeri Gambar
                    </div>
                    <div class="d-flex flex-wrap gap-2">
                      <template x-for="img in galleryImages" :key="img.id">
                        <div class="gallery-thumb" style="cursor:pointer;" 
                             @click="setFaceSwapFaceImage(img.url); showFaceSwapFaceGallery = false"
                             title="Klik untuk memilih gambar ini">
                          <img :src="img.url" :alt="img.caption" class="gallery-img">
                        </div>
                      </template>
                    </div>
                  </div>
                  
                  <!-- Generated Images -->
                  <div class="mb-3">
                    <div class="fw-bold text-gradient fs-6 mb-2">
                      <i class="bi bi-stars me-2"></i>Gambar Hasil Generate
                    </div>
                    <div class="d-flex flex-wrap gap-2">
                      <template x-for="img in galleryGenerated" :key="img.id">
                        <div class="gallery-thumb" style="cursor:pointer;" 
                             @click="setFaceSwapFaceImage(img.url); showFaceSwapFaceGallery = false"
                             title="Klik untuk memilih gambar ini">
                          <img :src="img.url" :alt="img.caption" class="gallery-img gallery-img-gen">
                        </div>
                      </template>
                    </div>
                  </div>
                </div>
              </div>
            </template>
            {% endraw %}
            
            <div class="mb-3">
              <label class="form-label fw-bold">Target Index <i class="bi bi-question-circle text-muted"></i></label>
              <input type="number" class="form-control form-dark" x-model="faceSwap.targetIndex" min="0" max="10" value="0">
              <small class="text-muted">Index wajah yang akan ditukar (0 = wajah pertama)</small>
            </div>
            
            <div class="mb-3">
              <label class="form-label fw-bold">Output Format</label>
              <select class="form-select form-dark" x-model="faceSwap.outputFormat">
                <option value="jpeg">JPEG</option>
                <option value="png">PNG</option>
                <option value="webp">WEBP</option>
              </select>
            </div>
            
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" x-model="faceSwap.enableBase64Output" id="base64out_fs">
              <label class="form-check-label" for="base64out_fs" title="Mengembalikan hasil dalam format base64">enable_base64_output <i class="bi bi-question-circle text-muted"></i></label>
            </div>
            
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" x-model="faceSwap.enableSafetyChecker" id="safetycheck_fs" checked>
              <label class="form-check-label" for="safetycheck_fs" title="Memeriksa konten yang tidak aman">enable_safety_checker <i class="bi bi-question-circle text-muted"></i></label>
            </div>
            
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" x-model="faceSwap.enableSyncMode" id="syncmode_fs">
              <label class="form-check-label" for="syncmode_fs" title="Menunggu hasil selesai sebelum mengembalikan response">enable_sync_mode <i class="bi bi-question-circle text-muted"></i></label>
            </div>
            
            <button type="submit" class="btn btn-gradient py-3 fw-bold fs-5" :disabled="loading">
              <span x-show="!loading">Generate Face Swap</span>
              <span x-show="loading"><span class="spinner-border spinner-border-sm me-2"></span>Memproses...</span>
            </button>
          </form>

          <!-- Form Generate Miniatur -->
          <form x-show="tab==='miniatur'" @submit.prevent="submitMiniatur()">
            <!-- Workflow Guide -->
            <div class="alert alert-primary mb-4 py-3">
              <h6 class="fw-bold mb-2">
                <i class="bi bi-info-circle me-2"></i>Cara Membuat Figurine Miniatur
              </h6>
              <div class="row g-2 small">
                <div class="col-12 col-md-4">
                  <div class="d-flex align-items-center">
                    <span class="badge bg-warning text-dark me-2">1</span>
                    <span><strong>Upload Gambar</strong> karakter/objek</span>
                  </div>
                </div>
                <div class="col-12 col-md-4">
                  <div class="d-flex align-items-center">
                    <span class="badge bg-warning text-dark me-2">2</span>
                    <span><strong>Pilih cara:</strong> Langsung atau Manual</span>
                  </div>
                </div>
                <div class="col-12 col-md-4">
                  <div class="d-flex align-items-center">
                    <span class="badge bg-success me-2">3</span>
                    <span><strong>Dapatkan</strong> figurine 1/7 scale</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Prompt Editing Section -->
            <div class="mb-4 prompt-section">
              <div class="prompt-label-container">
                <label class="form-label fw-bold d-flex align-items-center mb-2">
                  <i class="bi bi-magic me-2"></i>Instruksi Edit
                </label>
                <small class="text-muted d-block mb-3">Berikan instruksi bagaimana gambar harus diedit (contoh: "Change background to Christmas tree")</small>
              </div>

              <div class="textarea-container">
                <textarea 
                  class="form-control form-dark focus-ring prompt-textarea" 
                  x-model="miniatur.prompt"
                  rows="4"
                  placeholder="Masukkan instruksi edit gambar Anda... Contoh: 'Change background to Christmas tree', 'Remove the background', 'Add snow effect', dll."
                  ></textarea>
                <div class="char-counter" :class="miniaturPromptCharCounterClass">
                  <span class="char-counter-text" x-text="`${miniatur.prompt.length}`"></span>
                </div>
              </div>
              
              <!-- AI Helper Buttons -->
              <div class="ai-helper-section mt-3">
                <button 
                  type="button"
                  class="btn btn-outline-primary w-100 py-2 fw-semibold" 
                  :class="{ 'generating': miniatur.isGeneratingPrompt }"
                  @click="generateMiniaturPrompt()" 
                  :disabled="!miniatur.imagePreview || miniatur.isGeneratingPrompt"
                  title="AI akan membuat instruksi edit figurine otomatis">
                  <span x-show="!miniatur.isGeneratingPrompt">
                    <i class="bi bi-magic me-2"></i>Generate Instruksi dengan AI
                  </span>
                  <span x-show="miniatur.isGeneratingPrompt">
                    <i class="bi bi-arrow-repeat spinner me-2"></i>AI sedang membuat instruksi...
                  </span>
                </button>
                
                <div class="alert alert-light mt-2 py-2">
                  <div class="d-flex align-items-center">
                    <i class="bi bi-lightbulb text-warning me-2"></i>
                    <small class="mb-0">
                      <strong>Cara pakai:</strong> Upload gambar dulu, lalu klik tombol ini. AI akan mengisi kotak instruksi dengan prompt figurine 1/7 scale yang detail. Setelah itu bisa diedit atau langsung pakai untuk Generate Manual.
                    </small>
                  </div>
                </div>
              </div>
            </div>

            <!-- Upload Gambar Section -->
            <div class="mb-4">
              <label class="form-label fw-bold">
                <i class="bi bi-images me-2"></i>Upload Gambar
              </label>
              <small class="text-muted d-block mb-3">Upload gambar yang akan diedit dengan instruksi AI</small>
              
              <div class="alert alert-info mb-3">
                <i class="bi bi-info-circle me-2"></i>
                <strong>Tips:</strong> Gunakan gambar dengan kualitas baik dan resolusi tinggi (minimal 512x512) untuk hasil edit terbaik. Format yang didukung: JPG, PNG, WEBP.
              </div>
              
              <div class="modern-upload-area mb-3" :class="{ 'has-preview': miniatur.imagePreview, 'dragover': miniatur.dragover }"
                   @dragover.prevent="miniatur.dragover = true"
                   @drop.prevent="handleMiniaturFileDrop($event)"
                   @dragenter.prevent="miniatur.dragover = true"
                   @dragleave.prevent="miniatur.dragover = false">
                <!-- Upload Placeholder -->
                <div x-show="!miniatur.imagePreview" class="upload-placeholder" @click="$refs.miniaturFileInput.click()">
                  <i class="bi bi-cloud-upload upload-icon"></i>
                  <h5>Upload Gambar</h5>
                  <p>Klik untuk memilih file atau drag & drop</p>
                  <div class="upload-hint">Supports: JPG, PNG, WEBP (Max: 10MB)</div>
                </div>
                
                <!-- Image Preview -->
                <div x-show="miniatur.imagePreview" class="image-preview-container">
                  <img :src="miniatur.imagePreview" class="preview-img" alt="Preview">
                  <div class="image-actions">
                    <button type="button" class="btn btn-sm btn-outline-primary" @click="$refs.miniaturFileInput.click()">
                      <i class="bi bi-arrow-repeat"></i> Ganti
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-info" @click="openMiniaturGallery()">
                      <i class="bi bi-images"></i> Galeri
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-warning" @click="removeMiniaturImage()">
                      <i class="bi bi-trash"></i> Hapus
                    </button>
                  </div>
                </div>
                
                <!-- Hidden File Input -->
                <input type="file" 
                       x-ref="miniaturFileInput"
                       accept="image/*" 
                       @change="handleMiniaturFile($event)" 
                       style="display: none;">
                
                <!-- URL Input -->
                <div class="url-input-container mt-2">
                  <div class="input-group">
                    <span class="input-group-text">
                      <i class="bi bi-link-45deg"></i>
                    </span>
                    <input type="text" 
                           class="form-control form-dark" 
                           x-model="miniatur.imageUrl"
                           @input="loadMiniaturImageFromUrl()"
                           placeholder="Atau masukkan URL gambar...">
                    <button type="button" class="btn btn-outline-secondary" @click="openMiniaturGallery()" title="Pilih dari galeri">
                      <i class="bi bi-images"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Action Buttons Section -->
            <div class="action-buttons-section mt-4">
              <div class="row g-2">
                <!-- Generate Langsung Button -->
                <div class="col-12 col-md-6">
                  <button 
                    type="button"
                    class="btn btn-warning w-100 py-2 fw-semibold" 
                    @click="generateMiniaturDirect()" 
                    :disabled="!miniatur.imagePreview || loading || miniatur.isGeneratingPrompt"
                    title="Upload gambar, AI buat instruksi, langsung proses - semua otomatis!">
                    <i class="bi bi-lightning-fill me-2"></i>Generate Langsung
                  </button>
                </div>
                
                <!-- Generate Manual Button -->
                <div class="col-12 col-md-6">
                  <button 
                    type="submit" 
                    class="btn btn-gradient w-100 py-2 fw-semibold" 
                    :disabled="loading || !miniatur.imagePreview || !miniatur.prompt.trim() || !miniatur.imageUrl">
                    <span x-show="!loading">
                      <i class="bi bi-gear-fill me-2"></i>Generate Manual
                    </span>
                    <span x-show="loading">
                      <span class="spinner-border spinner-border-sm me-2"></span>Memproses...
                    </span>
                  </button>
                </div>
              </div>
              
              <!-- Helper Text -->
              <div class="alert alert-info mt-3 py-2 px-3">
                <div class="row g-2 text-sm">
                  <div class="col-12 col-md-6">
                    <div class="d-flex align-items-start">
                      <i class="bi bi-lightning-fill text-warning me-2 mt-1"></i>
                      <div>
                        <strong>Generate Langsung</strong><br>
                        <small>Cukup upload gambar, AI akan otomatis membuat instruksi figurine dan langsung memproses. Paling mudah!</small>
                      </div>
                    </div>
                  </div>
                  <div class="col-12 col-md-6">
                    <div class="d-flex align-items-start">
                      <i class="bi bi-gear-fill text-primary me-2 mt-1"></i>
                      <div>
                        <strong>Generate Manual</strong><br>
                        <small>Gunakan instruksi yang sudah Anda tulis sendiri atau hasil AI. Kontrol penuh atas prompt.</small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
        <template x-if="errorMsg">
          <div class="alert alert-danger mt-4">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <strong>Error:</strong> <span x-text="errorMsg"></span>
          </div>
        </template>
        <template x-if="resultUrl && !errorMsg">
          <div class="alert alert-success mt-4">
            <i class="bi bi-check-circle me-2"></i>
            <strong>
              <template x-if="tab === 'generate'">Generate gambar berhasil!</template>
              <template x-if="tab === 'fusigaya'">Fusigaya berhasil!</template>
              <template x-if="tab === 'faceswap'">Face swap berhasil!</template>
            </strong> 
            Gambar telah diproses dan siap untuk didownload.
          </div>
        </template>
      </div>
    </div>
    <!-- Preview Kanan -->
    <div class="col-12 col-lg-6 d-flex">
      <div class="glass-panel p-4 w-100 d-flex flex-column align-items-center justify-content-center position-relative" style="min-height:420px;">
        <template x-if="loading">
          <div class="loading-overlay d-flex flex-column align-items-center justify-content-center rounded-4" style="z-index:2;">
            <div class="spinner-border text-gradient mb-3" style="width:3rem;height:3rem;"></div>
            <div class="fw-bold text-white fs-5">
              <template x-if="tab === 'generate'">Sedang generate gambar...</template>
              <template x-if="tab === 'fusigaya'">Sedang proses fusigaya...</template>
              <template x-if="tab === 'faceswap'">Sedang proses face swap...</template>
              <template x-if="tab === 'miniatur'">Sedang proses edit gambar...</template>
            </div>
            <div class="text-light mt-2">
              <template x-if="tab === 'generate'">Mohon tunggu, proses generate gambar membutuhkan waktu 30-60 detik</template>
              <template x-if="tab === 'fusigaya'">Mohon tunggu, proses fusigaya membutuhkan waktu 60-120 detik</template>
              <template x-if="tab === 'faceswap'">Mohon tunggu, proses face swap membutuhkan waktu 30-60 detik</template>
              <template x-if="tab === 'miniatur'">Mohon tunggu, proses edit gambar membutuhkan waktu 60-90 detik</template>
            </div>
            <div class="progress mt-3" style="width: 80%; height: 8px;">
              <div class="progress-bar bg-gradient" style="width: 0%; animation: progress-animation 2s infinite;"></div>
            </div>
          </div>
        </template>
        <template x-if="resultUrl && !errorMsg">
          <div class="w-100 d-flex flex-column align-items-center animate__animated animate__fadeIn animate__faster" style="animation-duration:0.7s;">
            <img :src="resultUrl" 
                 :alt="tab === 'fusigaya' ? 'Hasil Fusigaya' : tab === 'faceswap' ? 'Hasil Face Swap' : tab === 'miniatur' ? 'Hasil Edit Gambar' : 'Hasil Gambar AI'" 
                 class="img-fluid rounded shadow-lg result-image" 
                 style="max-width: 100%; max-height: 350px; border: 2px solid #a855f7; background: #23233a; transition:box-shadow 0.4s,transform 0.4s; box-shadow:0 8px 40px #a855f755; cursor: pointer;"
                 @click="showImagePreview(resultUrl)"
                 :title="`Click untuk preview lebih besar - ${tab === 'fusigaya' ? 'Hasil Fusigaya' : tab === 'faceswap' ? 'Hasil Face Swap' : tab === 'miniatur' ? 'Hasil Edit Gambar' : 'Hasil Gambar AI'}`">
            <div class="mt-3 d-flex gap-2">
              <button type="button" class="btn btn-gradient px-4 py-2 fw-bold" @click="downloadResult(resultUrl, tab === 'fusigaya' ? 'hasil-fusigaya.jpg' : tab === 'faceswap' ? 'hasil-face-swap.jpg' : tab === 'miniatur' ? 'hasil-edit-gambar.jpg' : 'hasil-ai.jpg')">
                <i class="bi bi-download me-2"></i>Download
              </button>
              <button type="button" class="btn btn-outline-info px-4 py-2 fw-bold" @click="showImagePreview(resultUrl)">
                <i class="bi bi-eye me-2"></i>Preview
              </button>
            </div>
            <div class="mt-2 text-success fw-semibold animate__animated animate__fadeInUp animate__faster">
              <template x-if="tab === 'generate'">Gambar berhasil dibuat!</template>
              <template x-if="tab === 'fusigaya'">Fusigaya berhasil diproses!</template>
              <template x-if="tab === 'faceswap'">Face swap berhasil diproses!</template>
              <template x-if="tab === 'miniatur'">Edit gambar berhasil diproses!</template>
            </div>
          </div>
        </template>
        <template x-if="!resultUrl && !loading">
          <div class="w-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 200px; opacity:0.7;">
            <i class="bi bi-image fs-1 text-gradient mb-2"></i>
            <div class="text-secondary">Preview gambar akan muncul di sini</div>
            <template x-if="tab === 'fusigaya' && fusigaya.images.some(img => img.preview)">
              <div class="mt-3">
                <small class="text-muted">
                  Gambar input yang dipilih (<span x-text="fusigaya.images.filter(img => img.preview).length"></span>)
                  <template x-if="fusigaya.images.filter(img => img.fileInfo).length > 0">
                    - Total: <span x-text="fusigaya.images.filter(img => img.fileInfo).reduce((sum, img) => sum + parseFloat(img.fileInfo.size), 0).toFixed(2)"></span> MB
                    <template x-if="fusigaya.images.filter(img => img.fileInfo && img.fileInfo.width).length > 0">
                      - Resolusi: <span x-text="fusigaya.images.filter(img => img.fileInfo && img.fileInfo.width).map(img => `${img.fileInfo.width}x${img.fileInfo.height}`).join(', ')"></span>
                    </template>
                  </template>
                </small>
                <div class="d-flex gap-2 mt-2 justify-content-center">
                  <template x-for="(img, idx) in fusigaya.images" :key="idx">
                    <template x-if="img.preview">
                      <img :src="img.preview" style="width:50px;height:50px;object-fit:cover;border-radius:0.5rem;border:2px solid #a855f7;" @click="showImagePreview(img.preview)" :title="`Click untuk preview lebih besar - ${img.fileInfo ? img.fileInfo.name : 'URL Image'}`">
                    </template>
                  </template>
                </div>
              </div>
            </template>
            <template x-if="tab === 'faceswap' && (faceSwap.imagePreview || faceSwap.faceImagePreview)">
              <div class="mt-3">
                <small class="text-muted">
                  Gambar yang dipilih:
                  <template x-if="faceSwap.imagePreview">
                    <span class="text-success"> Gambar utama</span>
                  </template>
                  <template x-if="faceSwap.faceImagePreview">
                    <span class="text-success"> Gambar wajah</span>
                  </template>
                </small>
                <div class="d-flex gap-2 mt-2 justify-content-center">
                  <template x-if="faceSwap.imagePreview">
                    <img :src="faceSwap.imagePreview" style="width:50px;height:50px;object-fit:cover;border-radius:0.5rem;border:2px solid #3b82f6;" @click="showImagePreview(faceSwap.imagePreview)" title="Click untuk preview gambar utama">
                  </template>
                  <template x-if="faceSwap.faceImagePreview">
                    <img :src="faceSwap.faceImagePreview" style="width:50px;height:50px;object-fit:cover;border-radius:0.5rem;border:2px solid #ec4899;" @click="showImagePreview(faceSwap.faceImagePreview)" title="Click untuk preview gambar wajah">
                  </template>
                </div>
              </div>
            </template>
          </div>
        </template>
      </div>
    </div>
  </div>
  {% raw %}
  <template x-if="showGallery !== false">
    <div class="gallery-overlay" @click.self="showGallery = false">
      <div class="gallery-popup animate__animated animate__zoomIn">
        <!-- Header -->
        <div class="gallery-header">
          <div class="gallery-title">
            <i class="bi bi-images me-2"></i>
            <span class="text-gradient">Galeri Gambar</span>
          </div>
          <button type="button" class="gallery-close-btn" @click="showGallery = false">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
        
        <!-- Instructions -->
        <div class="gallery-instructions">
          <i class="bi bi-mouse me-2"></i>
          <span>Klik gambar untuk memilih dan otomatis akan ditutup</span>
        </div>
        
        <!-- Gallery Tabs -->
        <div class="gallery-tabs">
          <button class="gallery-tab active" @click="activeGalleryTab = 'uploaded'">
            <i class="bi bi-upload me-2"></i>Gambar Upload
          </button>
          <button class="gallery-tab" @click="activeGalleryTab = 'generated'">
            <i class="bi bi-magic me-2"></i>Hasil Generate
          </button>
        </div>
        
        <!-- Uploaded Images Tab -->
        <div x-show="activeGalleryTab === 'uploaded'" class="gallery-content">
          <div class="gallery-section-header">
            <i class="bi bi-cloud-arrow-up me-2"></i>
            <span>Gambar yang Telah Diupload</span>
            <span class="gallery-count" x-text="`(${galleryImages.length})`"></span>
          </div>
          
          <div class="gallery-grid">
            <template x-for="img in galleryImages" :key="img.id">
              <div class="gallery-item" @click="
                if (tab === 'fusigaya') {
                  fusigaya.images[showGallery].url = img.url; 
                  fusigaya.images[showGallery].preview = img.url; 
                } else if (tab === 'faceswap') {
                  if (showGallery === 'image') {
                    faceSwap.image = img.url;
                    faceSwap.imagePreview = img.url;
                  } else if (showGallery === 'face') {
                    faceSwap.faceImage = img.url;
                    faceSwap.faceImagePreview = img.url;
                  }
                }
                showGallery = false">
                <div class="gallery-item-overlay">
                  <i class="bi bi-check-circle-fill"></i>
                </div>
                <img :src="img.url" :alt="img.caption" class="gallery-item-img">
                                 <div class="gallery-item-caption" :title="img.caption || 'Gambar Upload'">
                   <span x-text="getShortCaption(img.caption) || 'Gambar Upload'"></span>
                 </div>
              </div>
            </template>
          </div>
          
          <div x-show="galleryImages.length === 0" class="gallery-empty">
            <i class="bi bi-inbox fs-1 text-muted"></i>
            <p>Belum ada gambar yang diupload</p>
          </div>
        </div>
        
        <!-- Generated Images Tab -->
        <div x-show="activeGalleryTab === 'generated'" class="gallery-content">
          <div class="gallery-section-header">
            <i class="bi bi-stars me-2"></i>
            <span>Gambar Hasil Generate AI</span>
            <span class="gallery-count" x-text="`(${galleryGenerated.length})`"></span>
          </div>
          
          <div class="gallery-grid">
            <template x-for="img in galleryGenerated" :key="img.id">
              <div class="gallery-item" @click="
                if (tab === 'fusigaya') {
                  fusigaya.images[showGallery].url = img.url; 
                  fusigaya.images[showGallery].preview = img.url; 
                } else if (tab === 'faceswap') {
                  if (showGallery === 'image') {
                    faceSwap.image = img.url;
                    faceSwap.imagePreview = img.url;
                  } else if (showGallery === 'face') {
                    faceSwap.faceImage = img.url;
                    faceSwap.faceImagePreview = img.url;
                  }
                }
                showGallery = false">
                <div class="gallery-item-overlay">
                  <i class="bi bi-check-circle-fill"></i>
                </div>
                <img :src="img.url" :alt="img.caption" class="gallery-item-img">
                                 <div class="gallery-item-caption" :title="img.caption || 'Hasil AI'">
                   <span x-text="getShortCaption(img.caption) || 'Hasil AI'"></span>
                 </div>
              </div>
            </template>
          </div>
          
          <div x-show="galleryGenerated.length === 0" class="gallery-empty">
            <i class="bi bi-magic fs-1 text-muted"></i>
            <p>Belum ada hasil generate AI</p>
          </div>
        </div>
      </div>
    </div>
  </template>
  
  <!-- Image Preview Modal -->
  <template x-if="imagePreviewModal.show">
    <div class="image-preview-overlay" 
         @click.self="closeImagePreview()"
         @keydown="handleKeydown($event)"
         tabindex="0">
      <div class="image-preview-popup animate__animated animate__zoomIn">
        <div class="image-preview-header">
          <h5 class="text-white mb-0">Preview Gambar</h5>
          <button type="button" class="image-preview-close" @click="closeImagePreview()">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
        <div class="image-preview-body">
          <img :src="imagePreviewModal.url" 
               class="image-preview-img" 
               alt="Preview"
               @click="toggleImageZoom($event)"
               :class="{ 'zoomed': imageZoomed }">
        </div>
        <div class="image-preview-footer">
          <small class="text-muted">Click gambar untuk zoom in/out</small>
          <small class="text-info ms-3">Sumber: <span x-text="imagePreviewModal.source"></span></small>
        </div>
      </div>
    </div>
  </template>
  {% endraw %}
</div>

<!-- Contoh Gambar Section - Di bagian bawah seperti gambar kedua -->
<div class="mt-5" id="example-images-section" style="display: block;">
  <div class="glass-panel p-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="fw-bold text-white mb-0">Gambar Hasil</h5>
      <button type="button" class="btn btn-tag" onclick="toggleShowAllExamples()">
        <i class="bi bi-arrow-right me-1"></i>Lihat Semua
      </button>
    </div>
    
    <div class="row g-3">
      <!-- Gambar akan di-load dari database + 2 tambahan -->
      <div class="col-12 text-center">
        <div class="text-muted">
          <i class="bi bi-hourglass-split me-2"></i>Loading contoh gambar...
          </div>
        </div>
      </div>
      
    <!-- Informasi sumber gambar -->
    <div class="mt-3 text-center">
      <small class="text-muted">
        <i class="bi bi-images me-1"></i>Menampilkan 12 contoh gambar untuk inspirasi (10 dari database + 2 tambahan)
      </small>
          </div>
        </div>
      </div>
      
<!-- Modal Detail Contoh Gambar -->
<div class="modal fade" id="exampleDetailModal" tabindex="-1" aria-labelledby="exampleDetailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content bg-dark border-0">
      <div class="modal-header border-0 pb-0">
        <h5 class="modal-title text-white fw-bold" id="exampleDetailModalLabel">Detail Contoh</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" onclick="reRegisterEventListeners()"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-6">
            <div class="example-detail-image-container position-relative">
              <img id="exampleDetailImage" src="" alt="Example Detail" class="w-100 rounded-3" style="height: 300px; object-fit: cover;">
              <div class="example-detail-overlay">
                <button class="btn btn-primary rounded-circle download-detail-btn" onclick="downloadExampleImage(document.getElementById('exampleDetailImage').src, document.getElementById('exampleDetailModalLabel').textContent)">
                  <i class="bi bi-download"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <h6 class="text-white fw-bold mb-3" id="exampleDetailTitle">Judul Contoh</h6>
            <div class="mb-3">
              <label class="form-label text-white fw-semibold">Prompt Lengkap:</label>
              <textarea id="exampleDetailPrompt" class="form-control bg-dark text-white border border-secondary" rows="8" readonly></textarea>
            </div>
            <div class="d-flex gap-2">
              <button type="button" class="btn btn-gradient" onclick="useExamplePromptFromModal()">
                <i class="bi bi-magic me-2"></i>Gunakan Prompt
              </button>
              <button type="button" class="btn btn-outline-light" onclick="copyPromptToClipboard()">
                <i class="bi bi-clipboard me-2"></i>Copy Prompt
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1050;">
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<style>
  /* === MODERN GLASSMORPHISM EFFECT === */
  .glass-panel {
    background: rgba(255, 255, 255, 0.08);
    border-radius: 1.5rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    margin-bottom: 1.5rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  
  .glass-panel::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
    border-radius: 1.5rem 1.5rem 0 0;
  }
  
  .glass-panel:focus-within, .glass-panel:hover {
    box-shadow: 0 12px 40px rgba(102, 126, 234, 0.4);
    border-color: rgba(102, 126, 234, 0.3);
    transform: translateY(-2px);
  }
  
  /* === OPTIMIZED FORM STYLING === */
  .form-dark {
    background: rgba(30, 41, 59, 0.8) !important;
    color: #ffffff !important;
    border: 2px solid rgba(255, 255, 255, 0.1) !important;
    border-radius: 1rem;
    box-shadow: none;
    transition: all 0.3s ease;
    padding: 16px 20px;
    font-size: 16px;
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    font-feature-settings: "kern" 1;
    letter-spacing: 0.01em;
  }
  
  .form-dark:focus {
    border-color: #667eea !important;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    color: #ffffff !important;
    outline: none;
    transform: scale(1.02);
  }
  
  .form-dark::placeholder {
    color: rgba(203, 213, 225, 0.8) !important;
    opacity: 1;
    font-weight: 400;
  }
  
  /* === ENHANCED LABELS === */
  .form-label, label, .form-check-label {
    color: #e0e6ed !important;
    font-weight: 600;
    letter-spacing: 0.02em;
    margin-bottom: 0.75rem;
    font-size: 1rem;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
  }
  
  /* === ENHANCED TITLE INPUT SECTION === */
  .title-input-section {
    position: relative;
    background: rgba(255, 255, 255, 0.02);
    border-radius: 16px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
  }
  
  /* === MODEL SELECTION STYLING === */
  .advanced-parameters-section,
  .nano-banana-params {
    background: rgba(102, 126, 234, 0.05);
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid rgba(102, 126, 234, 0.1);
    margin-bottom: 1.5rem;
    transition: all 0.3s ease;
  }
  
  .advanced-parameters-section:hover,
  .nano-banana-params:hover {
    background: rgba(102, 126, 234, 0.08);
    border-color: rgba(102, 126, 234, 0.2);
    box-shadow: 0 4px 20px rgba(102, 126, 234, 0.1);
  }
  
  .advanced-parameters-section h6,
  .nano-banana-params h6 {
    color: #667eea;
    margin-bottom: 0.5rem;
    font-size: 1.1rem;
  }
  
  .advanced-parameters-section small,
  .nano-banana-params small {
    color: rgba(203, 213, 225, 0.8);
    font-size: 0.9rem;
  }
  
  /* Model selection styling */
  .model-selection-container {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(168, 85, 247, 0.1));
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid rgba(102, 126, 234, 0.2);
    margin-bottom: 1.5rem;
    transition: all 0.3s ease;
  }
  
  .model-selection-container:hover {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(168, 85, 247, 0.15));
    border-color: rgba(102, 126, 234, 0.3);
    box-shadow: 0 4px 20px rgba(102, 126, 234, 0.15);
  }
  
  .model-selection-container select {
    background: rgba(30, 41, 59, 0.8);
    border: 2px solid rgba(102, 126, 234, 0.3);
    color: #ffffff;
    font-weight: 500;
    transition: all 0.3s ease;
  }
  
  .model-selection-container select:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    background: rgba(30, 41, 59, 0.9);
  }
  
  .model-selection-container select option {
    background: #1e293b;
    color: #ffffff;
    padding: 8px;
  }
  
  /* Photo model selection styling */
  .photo-model-selection {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(168, 85, 247, 0.1));
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid rgba(102, 126, 234, 0.2);
    margin-bottom: 1.5rem;
    transition: all 0.3s ease;
  }
  
  .photo-model-selection:hover {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(168, 85, 247, 0.15));
    border-color: rgba(102, 126, 234, 0.3);
    box-shadow: 0 4px 20px rgba(102, 126, 234, 0.15);
  }
  
  .photo-model-selection select {
    background: rgba(30, 41, 59, 0.8);
    border: 2px solid rgba(102, 126, 234, 0.3);
    color: #ffffff;
    font-weight: 500;
    transition: all 0.3s ease;
  }
  
  .photo-model-selection select:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    background: rgba(30, 41, 59, 0.9);
  }
  
  .photo-model-selection select option {
    background: #1e293b;
    color: #ffffff;
    padding: 8px;
  }
  
  /* Model status header styling */
  .model-status-header {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(168, 85, 247, 0.1));
    border-radius: 12px;
    padding: 1rem;
    border: 1px solid rgba(102, 126, 234, 0.2);
    backdrop-filter: blur(10px);
  }
  
  .model-status-header .badge {
    font-size: 0.9rem;
    padding: 0.5rem 0.75rem;
    border-radius: 8px;
  }
  
  .model-status-header .model-info small {
    font-size: 0.85rem;
    opacity: 0.8;
  }
  
  .model-status-header .model-cost .badge {
    background: linear-gradient(135deg, #fbbf24, #f59e0b) !important;
    border: none;
    font-weight: 600;
  }
  
  .title-input-section:hover {
    background: rgba(255, 255, 255, 0.03);
    border-color: rgba(102, 126, 234, 0.2);
    box-shadow: 0 4px 20px rgba(102, 126, 234, 0.1);
  }
  
  /* Title label container */
  .title-label-container {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    margin-bottom: 1rem;
    position: relative;
  }
  
  .title-label-container .form-label {
    margin-bottom: 0;
    display: flex;
    align-items: center;
    font-weight: 600;
    color: var(--text-secondary);
    font-size: 1.1rem;
  }
  
  .title-label-container .form-label i {
    color: #667eea;
    font-size: 1.2rem;
    margin-right: 0.75rem;
    text-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
  }
  
  /* Input with counter container */
  .input-with-counter-container {
    position: relative;
    margin-bottom: 1rem;
  }
  
  .input-field-wrapper {
    position: relative;
    display: flex;
    align-items: center;
  }
  
  /* Title input field */
  .title-input {
    width: 100%;
    border-radius: 12px;
    padding: 16px 20px;
    padding-right: 80px; /* Space for character counter */
    font-size: 1rem;
    border: 2px solid rgba(102, 126, 234, 0.2);
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.03) 100%);
    transition: all 0.3s ease;
    color: white;
    font-weight: 500;
  }
  
  .title-input:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.25), 0 0 25px rgba(102, 126, 234, 0.15);
    transform: translateY(-2px);
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.05) 100%);
  }
  
  .title-input::placeholder {
    color: rgba(255, 255, 255, 0.5);
    font-style: italic;
  }
  
  /* Inline character counter */
  .inline-char-counter {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 3;
  }
  
  .char-counter-text-inline {
    color: var(--text-muted);
    font-size: 0.75rem;
    font-weight: 600;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.08) 100%);
    padding: 0.25rem 0.6rem;
    border-radius: 12px;
    backdrop-filter: blur(15px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
    min-width: 45px;
    text-align: center;
    display: inline-block;
    letter-spacing: 0.02em;
    white-space: nowrap;
  }
  
  /* Generate button container */
  .generate-btn-container {
    margin-bottom: 1rem;
  }
  
  /* Generate prompt button */
  .generate-prompt-btn {
    width: 100%;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    letter-spacing: 0.02em;
    border-radius: 12px;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.05) 100%);
    border: 2px solid rgba(102, 126, 234, 0.3);
    color: #667eea;
    transition: all 0.3s ease;
  }
  
  .generate-prompt-btn:hover:not(:disabled) {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.1) 100%);
    border-color: rgba(102, 126, 234, 0.5);
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
  }
  
  .generate-prompt-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
  }
  
  .btn-content {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    gap: 0.5rem;
  }
  
  .btn-content i {
    font-size: 1.1rem;
  }
  
  /* Input hint */
  .input-hint {
    margin-top: 0.5rem;
    color: var(--text-muted);
    font-size: 0.9rem;
    font-style: italic;
    padding: 0.75rem 1rem;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(102, 126, 234, 0.03) 100%);
    border-radius: 10px;
    border-left: 4px solid #667eea;
    transition: all 0.3s ease;
    line-height: 1.5;
  }
  
  .input-hint:hover {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.12) 0%, rgba(102, 126, 234, 0.06) 100%);
    transform: translateX(5px);
  }
  
  .input-hint i {
    color: #667eea;
    font-size: 1.1rem;
    margin-right: 0.75rem;
    text-shadow: 0 0 8px rgba(102, 126, 234, 0.4);
  }
  
  /* === CHARACTER COUNTER STATES === */
  
  /* Success state (150-239 characters) */
  .inline-char-counter.success .char-counter-text-inline {
    color: #10b981;
    border-color: rgba(16, 185, 129, 0.4);
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(16, 185, 129, 0.08) 100%);
  }
  
  /* Warning state (240-269 characters) */
  .inline-char-counter.warning .char-counter-text-inline {
    color: #ffc107;
    border-color: rgba(255, 193, 7, 0.4);
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.15) 0%, rgba(255, 193, 7, 0.08) 100%);
  }
  
  /* Danger state (270-300 characters) */
  .inline-char-counter.danger .char-counter-text-inline {
    color: #ef4444;
    border-color: rgba(239, 68, 68, 0.4);
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.08) 100%);
  }
  
  /* === RESPONSIVE BREAKPOINTS === */
  
  /* Large Desktop (1200px and above) */
  @media (min-width: 1200px) {
    .title-input-section {
      padding: 2rem;
    }
    
    .title-label-container {
      margin-bottom: 1.25rem;
    }
    
    .char-counter-text-inline {
      font-size: 0.8rem;
      padding: 0.3rem 0.7rem;
      min-width: 60px;
    }
    
    .title-input {
      padding: 18px 22px;
      padding-right: 100px;
      font-size: 1.05rem;
    }
    
    .generate-prompt-btn {
      height: 60px;
    }
  }
  
  /* Desktop (768px - 1199px) */
  @media (min-width: 768px) and (max-width: 1199px) {
    .title-input-section {
      padding: 1.75rem;
    }
    
    .title-label-container {
      margin-bottom: 1rem;
    }
    
    .char-counter-text-inline {
      font-size: 0.75rem;
      padding: 0.25rem 0.6rem;
      min-width: 55px;
    }
    
    .title-input {
      padding: 16px 20px;
      padding-right: 90px;
      font-size: 1rem;
    }
    
    .generate-prompt-btn {
      height: 56px;
    }

  }
  
  /* Tablet (768px - 991px) */
  @media (max-width: 991.98px) and (min-width: 768px) {
    .title-input-section {
      padding: 1.5rem;
    }
    
    .title-label-container {
      margin-bottom: 0.75rem;
    }
    
    .char-counter-text-inline {
      font-size: 0.7rem;
      padding: 0.22rem 0.55rem;
      min-width: 52px;
    }
    
    .title-input {
      padding: 14px 18px;
      padding-right: 85px;
      font-size: 0.95rem;
    }
    
    .generate-prompt-btn {
      height: 52px;
    }
  }
  
  /* Medium Mobile (600px - 767px) */
  @media (max-width: 767px) and (min-width: 600px) {
    .title-input-section {
      padding: 1.25rem;
    }
    
    .title-label-container {
      margin-bottom: 0.6rem;
    }
    
    .char-counter-text-inline {
      font-size: 0.68rem;
      padding: 0.2rem 0.5rem;
      min-width: 50px;
    }
    
    .title-input {
      padding: 12px 16px;
      padding-right: 80px;
      font-size: 0.9rem;
    }
    
    .generate-prompt-btn {
      height: 50px;
    }

  }
  
  /* Mobile (480px - 599px) */
  @media (max-width: 599px) and (min-width: 480px) {
    .title-input-section {
      padding: 1rem;
    }
    
    .title-label-container {
      margin-bottom: 0.5rem;
    }
    
    .char-counter-text-inline {
      font-size: 0.65rem;
      padding: 0.18rem 0.45rem;
      min-width: 48px;
    }
    
    .title-input {
      padding: 10px 14px;
      padding-right: 75px;
      font-size: 0.85rem;
    }
    
    .generate-prompt-btn {
      height: 48px;
      font-size: 0.9rem;
    }
    
    .input-hint {
      font-size: 0.8rem;
      padding: 0.6rem 0.8rem;
    }
  }
  
  /* Extra Small Mobile (below 480px) */
  @media (max-width: 479px) {
    .title-input-section {
      padding: 0.75rem;
      border-radius: 12px;
    }
    
    .title-label-container {
      margin-bottom: 0.4rem;
    }
    
    .char-counter-text-inline {
      font-size: 0.6rem;
      padding: 0.15rem 0.4rem;
      min-width: 45px;
    }
    
    .title-input {
      padding: 8px 12px;
      padding-right: 70px;
      font-size: 0.8rem;
    }
    
    .generate-prompt-btn {
      height: 44px;
      font-size: 0.85rem;
    }
    
    .input-hint {
      font-size: 0.75rem;
      padding: 0.5rem 0.7rem;
    }
  }
  
  /* === MOBILE TOUCH OPTIMIZATION === */
  
  @media (max-width: 767px) {
    /* Reduce hover effects on mobile */
    .inline-char-counter:hover .char-counter-text-inline {
      transform: translateY(-1px);
    }
    
    /* Touch-friendly sizing */
    .char-counter-text-inline {
      min-height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* Better touch targets */
    .inline-char-counter {
      padding: 2px;
    }
    
    .title-input-section:hover {
      transform: none;
      box-shadow: 0 2px 10px rgba(102, 126, 234, 0.1);
    }
  }
  
  /* === ENHANCED ANIMATIONS === */
  
  /* Hover effects for inline counter */
  .inline-char-counter:hover .char-counter-text-inline {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    border-color: rgba(102, 126, 234, 0.4);
  }
  
  /* Pulse animation for warning and danger */
  .inline-char-counter.warning .char-counter-text-inline,
  .inline-char-counter.danger .char-counter-text-inline {
    animation: pulse 2s infinite;
  }
  
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; }
  }
  
  /* === TOAST NOTIFICATION STYLING === */
  
  .toast-container {
    z-index: 9999 !important;
  }
  
  .toast {
    border-radius: 12px !important;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3) !important;
    backdrop-filter: blur(10px) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    min-width: 300px !important;
    max-width: 400px !important;
  }
  
  .toast.bg-success {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
  }
  
  .toast.bg-danger {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
  }
  
  .toast.bg-warning {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%) !important;
  }
  
  .toast.bg-info {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important;
  }
  
  .toast-body {
    font-weight: 500 !important;
    font-size: 0.95rem !important;
    padding: 1rem 1.25rem !important;
  }
  
  .btn-close {
    filter: brightness(0) invert(1) !important;
    opacity: 0.8 !important;
    transition: opacity 0.2s ease !important;
  }
  
  .btn-close:hover {
    opacity: 1 !important;
  }
  
  /* Mobile optimization for toast */
  @media (max-width: 767px) {
    .toast {
      min-width: 280px !important;
      max-width: 350px !important;
      margin: 0.5rem !important;
    }
    
    .toast-body {
      font-size: 0.9rem !important;
      padding: 0.875rem 1rem !important;
    }
  }
  
  /* === EXAMPLE IMAGE STYLING === */
  
  .example-card {
    transition: all 0.3s ease;
    border: 2px solid #a855f7 !important;
    background: rgba(168, 85, 247, 0.1) !important;
    cursor: pointer !important;
    position: relative;
    overflow: hidden;
  }
  
  .example-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(168, 85, 247, 0.3);
    border-color: #a855f7 !important;
    background: rgba(168, 85, 247, 0.15) !important;
  }
  
  .example-card-image-container {
    position: relative;
    overflow: hidden;
  }
  
  .example-card img {
    transition: transform 0.3s ease;
  }
  
  .example-card:hover img {
    transform: scale(1.05);
  }
  
  .example-card-overlay {
    position: absolute;
    top: 10px;
    right: 10px;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .example-card:hover .example-card-overlay {
    opacity: 1;
  }
  
  .download-example-btn {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.9);
    border: none;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }
  
  .download-example-btn:hover {
    background: white;
    transform: scale(1.1);
  }
  
  /* === MODAL STYLING === */
  
  .modal-content {
    border-radius: 16px !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5) !important;
  }
  
  .modal-header {
    border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
  }
  
  .example-detail-image-container {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
  }
  
  .example-detail-overlay {
    position: absolute;
    top: 15px;
    right: 15px;
  }
  
  .download-detail-btn {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(59, 130, 246, 0.9);
    border: none;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
  }
  
  .download-detail-btn:hover {
    background: #3b82f6;
    transform: scale(1.1);
  }
  
  /* === GALLERY GRID STYLING === */
  
  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }
  
  .gallery-thumb {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid rgba(168, 85, 247, 0.3);
  }
  
  .gallery-thumb:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(168, 85, 247, 0.4);
    border-color: #a855f7;
  }
  
  .gallery-img {
    width: 100%;
    height: 150px;
    object-fit: cover;
    transition: transform 0.3s ease;
  }
  
  .gallery-thumb:hover .gallery-img {
    transform: scale(1.05);
  }
  
  .gallery-img-gen {
    border: 2px solid #a855f7;
  }
  
  .text-secondary, .text-muted {
    color: #bfc9db !important;
    font-weight: 500;
  }
  
  /* === MODERN BUTTON STYLING === */
  .btn-gradient {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #ffffff;
    border: none;
    border-radius: 1.2rem;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    transition: all 0.3s ease;
    padding: 16px 32px;
    font-weight: 600;
    font-size: 1.1rem;
    letter-spacing: 0.02em;
    position: relative;
    overflow: hidden;
  }
  
  .btn-gradient::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
  }
  
  .btn-gradient:hover::before {
    left: 100%;
  }
  
  .btn-gradient:hover, .btn-gradient:focus {
    background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    color: #ffffff;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
    transform: translateY(-3px) scale(1.05);
  }
  
  /* === ENHANCED TAB STYLING === */
  .tab-active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #ffffff;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    border: none;
    border-radius: 1.2rem;
    transition: all 0.3s ease;
    font-weight: 600;
    letter-spacing: 0.02em;
  }
  
  .tab-inactive {
    background: rgba(30, 41, 59, 0.7);
    color: #667eea;
    border: 2px solid rgba(102, 126, 234, 0.2);
    border-radius: 1.2rem;
    transition: all 0.3s ease;
    font-weight: 500;
  }
  
  .tab-inactive:hover {
    background: rgba(102, 126, 234, 0.1);
    border-color: rgba(102, 126, 234, 0.4);
    transform: translateY(-1px);
  }
  
  /* === MODERN GALLERY STYLING === */
  .gallery-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
  }
  
  .gallery-popup {
    background: rgba(35, 35, 58, 0.95);
    border-radius: 1rem;
    padding: 1.5rem;
    max-width: 700px;
    max-height: 80vh;
    overflow-y: auto;
    border: 2px solid rgba(102, 126, 234, 0.3);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(20px);
    min-width: 340px;
    width: 95vw;
  }
  
  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
    gap: 0.7rem;
    margin-bottom: 1.2rem;
  }
  
  .gallery-thumb {
    border-radius: 0.7rem;
    overflow: hidden;
    border: 2px solid transparent;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
  }
  
  .gallery-thumb:hover {
    border-color: #667eea;
    transform: scale(1.05);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
  }
  
  .gallery-img {
    width: 72px;
    height: 72px;
    object-fit: cover;
    transition: transform 0.3s ease;
    border-radius: 0.7rem;
  }
  
  .gallery-thumb:hover .gallery-img {
    transform: scale(1.1);
  }
  
  /* === ENHANCED GALLERY IMAGE VARIANTS === */
    .gallery-img-gen {
    border: 2px solid #4f46e5;
    box-shadow: 0 1px 8px #4f46e599;
  }
  
  .gallery-thumb:hover .gallery-img-gen {
    transform: scale(1.1);
    box-shadow: 0 2px 16px #4f46e5cc;
  }
  
  /* === ENHANCED GALLERY CLOSE BUTTON === */
  .btn-close {
    filter: invert(1);
    opacity: 0.7;
    transition: opacity 0.2s;
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
  }
  
  .btn-close:hover { 
    opacity: 1; 
  }
  
  /* === RESPONSIVE GALLERY === */
  @media (max-width: 600px) {
    .gallery-popup { 
      min-width: 90vw; 
      padding: 1.2rem 0.5rem; 
      max-width: 99vw; 
    }
    .gallery-grid { 
      grid-template-columns: repeat(auto-fit, minmax(70px, 1fr)); 
      gap: 0.4rem; 
    }
    .gallery-img { 
      width: 56px; 
      height: 56px; 
    }
  }
  
  /* === ENHANCED GALLERY POPUP STYLING === */
  .gallery-popup .fw-bold {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 700 !important;
    letter-spacing: 0.02em !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
  }
  
  .gallery-popup .text-gradient {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 700 !important;
    letter-spacing: 0.02em !important;
  }
  
  .gallery-popup .small {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 500 !important;
    letter-spacing: 0.01em !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
  }
  
  .gallery-popup .text-secondary {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    color: #94a3b8 !important;
    font-weight: 500 !important;
    letter-spacing: 0.01em !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
  }
  
  /* === ENHANCED GALLERY ANIMATION === */
  .animate__zoomIn {
    animation-duration: 0.35s !important;
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
  }
  
  /* === ENHANCED GALLERY HEADER === */
  .gallery-popup .d-flex.justify-content-between {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
  }
  
  /* === ENHANCED GALLERY INSTRUCTIONS === */
  .gallery-popup .mb-2.small {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 500 !important;
    letter-spacing: 0.01em !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
  }
  
  /* === ENHANCED GALLERY SECTION TITLES === */
  .gallery-popup .fw-bold.text-gradient.fs-6 {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 600 !important;
    letter-spacing: 0.02em !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
  }
  
  /* === ENHANCED GALLERY GRID === */
  .gallery-grid {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
  }
  
  /* === ENHANCED GALLERY THUMBNAILS === */
  .gallery-thumb {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
  }
  
  /* === ENHANCED GALLERY IMAGES === */
  .gallery-img, .gallery-img-gen {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
  }
  
  /* === ENHANCED GALLERY OVERLAY === */
  .gallery-overlay {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
  }
  
  /* === ENHANCED GALLERY POPUP BACKGROUND === */
  .gallery-popup {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
  }
  
  /* === ENHANCED GALLERY CLOSE BUTTON === */
  .gallery-popup .btn-close {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
  }
  
  /* === ENHANCED GALLERY RESPONSIVE === */
  @media (max-width: 768px) {
    .gallery-popup {
      padding: 1rem !important;
      border-radius: 0.75rem !important;
    }
    
    .gallery-grid {
      grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)) !important;
      gap: 0.5rem !important;
    }
    
    .gallery-img {
      width: 60px !important;
      height: 60px !important;
    }
  }
  
  @media (max-width: 480px) {
    .gallery-popup {
      padding: 0.75rem !important;
      border-radius: 0.5rem !important;
    }
    
    .gallery-grid {
      grid-template-columns: repeat(auto-fit, minmax(50px, 1fr)) !important;
      gap: 0.4rem !important;
    }
    
    .gallery-img {
      width: 50px !important;
      height: 50px !important;
    }
  }
  
  /* === ENHANCED LOADING OVERLAY === */
  .loading-overlay {
    position: absolute;
    inset: 0;
    background: rgba(24, 24, 37, 0.9);
    z-index: 9;
    backdrop-filter: blur(15px);
    border-radius: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  /* === MODERN TEXT GRADIENTS === */
  .text-gradient {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    font-weight: 700;
  }
  
  /* === ENHANCED IMAGE PREVIEW === */
  .image-preview-container {
    transition: all 0.3s ease;
    border-radius: 1rem;
    overflow: hidden;
  }
  
  .image-preview-container:hover {
    transform: scale(1.03);
    box-shadow: 0 12px 30px rgba(102, 126, 234, 0.3);
  }
  
  .image-preview {
    border: 3px solid transparent;
    transition: all 0.3s ease;
    border-radius: 1rem;
  }
  
  .image-preview:hover {
    border-color: #667eea;
    transform: scale(1.02);
  }
  
  /* === MODERN BUTTON VARIANTS === */
  .btn-tag {
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
    border: 2px solid rgba(102, 126, 234, 0.3);
    border-radius: 999px;
    padding: 0.5rem 1.2rem;
    font-size: 0.95rem;
    font-weight: 600;
    transition: all 0.3s ease;
    letter-spacing: 0.02em;
  }
  
  .btn-tag.active, .btn-tag:hover {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #ffffff;
    border-color: transparent;
    transform: translateY(-1px);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
  }
  
  /* === ENHANCED ALERTS === */
  .alert-info {
    color: #2563eb !important;
    background: rgba(59, 130, 246, 0.15) !important;
    border: 2px solid rgba(59, 130, 246, 0.3) !important;
    border-radius: 1rem;
    backdrop-filter: blur(10px);
  }
  
  .text-info, a.text-info {
    color: #60a5fa !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    font-weight: 600;
  }
  
  /* === MODERN TOAST STYLING === */
  .toast {
    backdrop-filter: blur(15px);
    border-radius: 1rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
  }
  
  /* === ENHANCED EXAMPLE CARDS === */
  .example-card {
    transition: all 0.3s ease;
    cursor: pointer;
    height: 100%;
    border-radius: 1rem;
    overflow: hidden;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
  }
  
  .example-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
    border-color: rgba(102, 126, 234, 0.3);
  }
  
  .example-card img {
    transition: transform 0.3s ease;
  }
  
  .example-card:hover img {
    transform: scale(1.08);
  }
  
  /* === ENHANCED EXAMPLE CARD IMAGE CONTAINER === */
  .example-card-image-container {
    position: relative;
    overflow: hidden;
  }
  
  .example-card-overlay {
    position: absolute;
    top: 10px;
    right: 10px;
    opacity: 0;
    transition: all 0.3s ease;
    transform: scale(0.8);
  }
  
  .example-card:hover .example-card-overlay {
    opacity: 1;
    transform: scale(1);
  }
  
  .download-example-btn {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.9) !important;
    border: none !important;
    color: #333 !important;
    font-size: 14px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
  }
  
  .download-example-btn:hover {
    background: #ffffff !important;
    transform: scale(1.1);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
  }
  
  /* === ENHANCED EXAMPLE DETAIL MODAL === */
  .example-detail-image-container {
    position: relative;
    overflow: hidden;
    border-radius: 1rem;
  }
  
  .example-detail-overlay {
    position: absolute;
    top: 15px;
    right: 15px;
    opacity: 0;
    transition: all 0.3s ease;
    transform: scale(0.8);
  }
  
  .example-detail-image-container:hover .example-detail-overlay {
    opacity: 1;
    transform: scale(1);
  }
  
  .download-detail-btn {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
    transition: all 0.3s ease;
  }
  
  .download-detail-btn:hover {
    background: #3b82f6;
    transform: scale(1.1);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
  }
  
  /* === ENHANCED MODAL STYLING === */
  .modal-content.bg-dark {
    background: rgba(30, 41, 59, 0.95) !important;
    backdrop-filter: blur(20px);
    border: 1px solid rgba(102, 126, 234, 0.3);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  }
  
  .modal-header .btn-close-white {
    filter: invert(1);
    opacity: 0.7;
    transition: opacity 0.2s;
  }
  
  .modal-header .btn-close-white:hover {
    opacity: 1;
  }
  
  /* === ENHANCED TEXT STYLING === */
  .example-card .fw-semibold {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 600 !important;
    letter-spacing: 0.02em !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
  }
  
  .example-card .text-muted {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 500 !important;
    letter-spacing: 0.01em !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
  }
  
  /* === ENHANCED RESPONSIVE === */
  @media (max-width: 768px) {
    .example-card-overlay {
      opacity: 1;
      transform: scale(1);
    }
    
    .download-example-btn {
      width: 32px;
      height: 32px;
      font-size: 12px;
    }
    
    .modal-dialog {
      margin: 1rem;
    }
    
    .example-detail-image-container img {
      height: 200px !important;
    }
  }
  
  @media (max-width: 576px) {
    .example-card .fw-semibold {
      font-size: 0.85rem !important;
    }
    
    .example-card .text-muted {
      font-size: 0.7rem !important;
    }
    
    .download-example-btn {
      width: 28px;
      height: 28px;
      font-size: 11px;
    }
  }
  
  /* === RESPONSIVE DESIGN === */
  @media (max-width: 991.98px) {
    .glass-panel {
      margin-bottom: 1.2rem;
      border-radius: 1rem;
    }
    
    .btn-gradient {
      padding: 14px 24px;
      font-size: 1rem;
    }
    
    /* Tablet tab switcher */
    .tab-switcher {
      gap: 0.4rem;
      padding: 0.4rem;
      max-width: 400px;
      margin: 0 auto;
    }
    
    .tab-btn {
      padding: 10px 16px;
      min-width: 120px;
      font-size: 0.95rem;
    }
    
    .tab-btn i {
      font-size: 1rem;
    }
    
    /* Tablet cost info panel */
    .cost-info-content {
      gap: 0.75rem;
    }
    
    .cost-info-icon {
      font-size: 1.25rem !important;
    }
    
    .cost-info-main {
      font-size: 1rem;
    }
    
    /* Tablet form inputs */
    .form-control.form-dark,
    .form-select.form-dark {
      padding: 11px 15px;
      font-size: 0.95rem;
    }
    
    .form-label {
      font-size: 0.95rem;
      margin-bottom: 0.6rem;
    }
    
    textarea.form-control.form-dark {
      min-height: 75px;
    }
    
    /* Tablet input layout */
    .input-group-container {
      gap: 0.75rem;
    }
    
    .title-input {
      padding: 12px 16px;
      font-size: 0.95rem;
    }
    
    .generate-prompt-btn {
      height: 48px;
      font-size: 0.95rem;
    }
    
    /* Tablet title input layout */
    .title-label-container {
      flex-direction: row;
      align-items: center !important;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }
    
    /* Tablet character counter */
    .char-counter-container {
      gap: 0.3rem;
    }
    
    .char-counter-progress {
      width: 75px;
      height: 4px;
    }
    
    .char-counter-text {
      font-size: 0.75rem;
      padding: 0.25rem 0.6rem;
      min-width: 42px;
    }
  }
  
  @media (max-width: 600px) {
    .gallery-popup { 
      min-width: 95vw; 
      padding: 1.5rem 1rem; 
      max-width: 98vw; 
      border-radius: 1rem;
    }
    
    .glass-panel {
      border-radius: 1rem;
      margin-bottom: 1rem;
    }
    
    /* Mobile-optimized input layout */
    .input-group-container {
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .input-field-wrapper {
      min-width: 100%;
    }
    
    .generate-btn-wrapper {
      width: 100%;
    }
    
    .generate-prompt-btn {
      width: 100%;
      min-width: auto;
      height: 44px;
      font-size: 0.9rem;
      border-radius: 10px;
    }
    
    .title-input {
      padding: 10px 14px;
      font-size: 0.9rem;
      border-radius: 10px;
    }
    
    /* Mobile title input layout */
    .title-label-container {
      flex-direction: column;
      align-items: flex-start !important;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    .title-label-container .form-label {
      margin-bottom: 0;
    }
    
    .char-counter-container {
      gap: 0.25rem;
      align-self: flex-end;
    }
    
    .char-counter-progress {
      width: 70px;
      height: 3px;
    }
    
    .char-counter-text {
      font-size: 0.7rem;
      padding: 0.2rem 0.5rem;
      min-width: 40px;
    }
    
    .input-hint {
      font-size: 0.75rem;
      padding: 0.4rem 0.6rem;
      margin-top: 0.5rem;
    }
    
    /* Mobile tab switcher */
    .tab-switcher {
      flex-direction: column;
      gap: 0.25rem;
      padding: 0.3rem;
      border-radius: 12px;
      width: 100%;
      max-width: 300px;
      margin: 0 auto;
    }
    
    .tab-btn {
      min-width: auto;
      width: 100%;
      padding: 8px 12px;
      font-size: 0.85rem;
      border-radius: 8px;
    }
    
    .tab-btn i {
      font-size: 0.9rem;
    }
    
    /* Mobile cost info panel */
    .cost-info-content {
      flex-direction: column;
      text-align: center;
      gap: 0.5rem;
    }
    
    .cost-info-icon {
      font-size: 1.25rem !important;
    }
    
    .cost-info-main {
      font-size: 0.9rem;
      line-height: 1.3;
    }
    
    /* Mobile form inputs */
    .form-control.form-dark,
    .form-select.form-dark {
      padding: 8px 12px;
      font-size: 0.85rem;
      border-radius: 8px;
    }
    
    .form-label {
      font-size: 0.85rem;
      margin-bottom: 0.4rem;
      flex-direction: column;
      align-items: flex-start;
      gap: 0.25rem;
    }
    
    textarea.form-control.form-dark {
      min-height: 60px;
    }
    
    /* Mobile form spacing */
    .mb-3, .mb-4 {
      margin-bottom: 0.75rem !important;
    }
    
    .mb-2 {
      margin-bottom: 0.5rem !important;
    }
    
    /* Mobile button spacing */
    .btn {
      font-size: 0.9rem;
      padding: 8px 16px;
    }
    
    .btn-gradient {
      padding: 10px 20px;
      font-size: 0.95rem;
    }
  }
  
  @media (max-width: 480px) {
    /* Extra small mobile optimization */
    .container {
      padding-left: 0.5rem;
      padding-right: 0.5rem;
    }
    
    .input-group-container {
      gap: 0.4rem;
    }
    
    .title-input {
      padding: 8px 12px;
      font-size: 0.85rem;
    }
    
    .generate-prompt-btn {
      height: 40px;
      font-size: 0.85rem;
      padding: 6px 12px;
    }
    
    .char-counter {
      font-size: 0.65rem;
      padding: 0.2rem 0.4rem;
    }
    
    .input-hint {
      font-size: 0.7rem;
      padding: 0.3rem 0.5rem;
    }
    
    /* Extra small mobile tab switcher */
    .tab-switcher {
      padding: 0.25rem;
      border-radius: 10px;
      max-width: 280px;
    }
    
    .tab-btn {
      padding: 6px 10px;
      font-size: 0.8rem;
      border-radius: 6px;
    }
    
    .tab-btn i {
      font-size: 0.8rem;
    }
    
    /* Extra small mobile form */
    .form-control.form-dark,
    .form-select.form-dark {
      padding: 6px 10px;
      font-size: 0.8rem;
      border-radius: 6px;
    }
    
    .form-label {
      font-size: 0.8rem;
      margin-bottom: 0.3rem;
    }
    
    textarea.form-control.form-dark {
      min-height: 50px;
    }
    
    /* Extra small mobile spacing */
    .mb-3, .mb-4 {
      margin-bottom: 0.5rem !important;
    }
    
    .mb-2 {
      margin-bottom: 0.4rem !important;
    }
    
    .btn {
      font-size: 0.85rem;
      padding: 6px 12px;
    }
    
    .btn-gradient {
      padding: 8px 16px;
      font-size: 0.9rem;
    }
    
    /* Extra small mobile glass panel */
    .glass-panel {
      padding: 0.75rem !important;
      border-radius: 0.75rem;
    }
  }
  
  @media (min-width: 768px) {
    /* Desktop optimization */
    .input-group-container {
      gap: 1.25rem;
    }
    
    .title-input {
      padding: 16px 20px;
      font-size: 1.05rem;
    }
    
    .generate-prompt-btn {
      height: 56px;
      font-size: 1.05rem;
    }
    
    /* Desktop title input layout */
    .title-label-container {
      flex-direction: row;
      align-items: center !important;
      gap: 1rem;
      margin-bottom: 0.75rem;
    }
    
    /* Desktop character counter */
    .char-counter-container {
      gap: 0.4rem;
    }
    
    .char-counter-progress {
      width: 85px;
      height: 5px;
    }
    
    .char-counter-text {
      font-size: 0.8rem;
      padding: 0.3rem 0.7rem;
      min-width: 48px;
    }
  }
  
  /* === MODERN TAB SWITCHER === */
  .modern-tab-container {
    display: flex;
    justify-content: center;
    margin-bottom: 2rem;
    padding: 0 1rem;
  }
  
  .modern-tab-wrapper {
    position: relative;
    display: flex;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 20px;
    padding: 8px;
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    max-width: 800px;
    width: 100%;
    overflow: hidden;
  }
  
  .modern-tab-background {
    position: absolute;
    top: 8px;
    left: 8px;
    width: calc(33.333% - 5.33px);
    height: calc(100% - 16px);
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 16px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    z-index: 1;
  }
  
  .modern-tab-btn {
    position: relative;
    flex: 1;
    background: transparent;
    border: none;
    color: rgba(255, 255, 255, 0.7);
    padding: 20px 16px;
    border-radius: 16px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    z-index: 2;
    min-height: 80px;
    overflow: hidden;
  }
  
  .modern-tab-btn:hover {
    color: white;
    transform: translateY(-2px);
  }
  
  .modern-tab-btn.active {
    color: white;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }
  
  .tab-icon {
    font-size: 1.5rem;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
  }
  
  .modern-tab-btn.active .tab-icon {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
    box-shadow: 0 4px 15px rgba(255, 255, 255, 0.2);
  }
  
  .tab-content {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 4px;
    flex: 1;
  }
  
  .tab-title {
    font-size: 1.1rem;
    font-weight: 600;
    line-height: 1.2;
    transition: all 0.3s ease;
  }
  
  .tab-subtitle {
    font-size: 0.85rem;
    opacity: 0.8;
    line-height: 1.2;
    transition: all 0.3s ease;
  }
  
  .modern-tab-btn.active .tab-title {
    font-size: 1.15rem;
    font-weight: 700;
  }
  
  .modern-tab-btn.active .tab-subtitle {
    opacity: 0.9;
  }
  
  .tab-indicator {
    position: absolute;
    bottom: 8px;
    left: 50%;
    transform: translateX(-50%) scaleX(0);
    width: 30px;
    height: 3px;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 2px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .tab-indicator.active {
    transform: translateX(-50%) scaleX(1);
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
  }
  
  /* Hover Effects */
  .modern-tab-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
    opacity: 0;
    transition: opacity 0.3s ease;
    border-radius: 16px;
  }
  
  .modern-tab-btn:hover::before {
    opacity: 1;
  }
  
  .modern-tab-btn.active::before {
    opacity: 0;
  }
  
  /* Loading State Animation */
  .modern-tab-container.loading .modern-tab-wrapper {
    opacity: 0.7;
    pointer-events: none;
  }
  
  .modern-tab-container.loading .modern-tab-background {
    animation: pulse 1.5s ease-in-out infinite;
  }
  
  @keyframes pulse {
    0%, 100% {
      opacity: 1;
      transform: translateX(0%);
    }
    50% {
      opacity: 0.8;
      transform: translateX(0%) scale(1.02);
    }
  }
  
  /* === MOBILE OPTIMIZATION === */
  @media (max-width: 768px) {
    .modern-tab-container {
      margin-bottom: 1.5rem;
      padding: 0 0.5rem;
    }
    
    .container {
      padding-left: 1rem;
      padding-right: 1rem;
    }
    
    .modern-tab-wrapper {
      flex-direction: column;
      gap: 8px;
      padding: 6px;
      border-radius: 16px;
      max-width: 100%;
    }
    
    .modern-tab-background {
      width: calc(100% - 12px);
      height: calc(33.333% - 2.67px);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .modern-tab-btn {
      padding: 16px 20px;
      min-height: 60px;
      justify-content: flex-start;
    }
    
    .tab-icon {
      width: 32px;
      height: 32px;
      font-size: 1.2rem;
    }
    
    .tab-title {
      font-size: 0.95rem;
    }
    
    .tab-subtitle {
      font-size: 0.75rem;
    }
    
    /* Medium mobile title input layout */
    .title-label-container {
      flex-direction: column;
      align-items: flex-start !important;
      gap: 0.6rem;
      margin-bottom: 0.6rem;
    }
    
    .title-label-container .form-label {
      margin-bottom: 0;
    }
    
    .char-counter-container {
      align-self: flex-end;
    }
  }
  
  .tab-switcher {
    display: flex;
    gap: 0.5rem;
    background: rgba(255, 255, 255, 0.05);
    padding: 0.5rem;
    border-radius: 16px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .tab-btn {
    padding: 12px 20px;
    font-weight: 600;
    border-radius: 12px;
    transition: all 0.3s ease;
    white-space: nowrap;
    min-width: 140px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }
  
  .tab-btn i {
    font-size: 1.1rem;
  }
  
  .tab-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
  }
  
  .tab-btn.tab-active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
  }
  
  .tab-btn.tab-inactive {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-secondary);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .tab-btn.tab-inactive:hover {
    background: rgba(255, 255, 255, 0.15);
    color: white;
  }
  
  /* === ENHANCED COST INFO PANEL === */
  .cost-info-panel {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.05) 100%);
    border: 1px solid rgba(102, 126, 234, 0.2);
    backdrop-filter: blur(15px);
  }
  
  .cost-info-content {
    gap: 0.5rem;
  }
  
  .cost-info-icon {
    flex-shrink: 0;
    text-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
  }
  
  .cost-info-text {
    flex: 1;
  }
  
  .cost-info-main {
    font-size: 1.05rem;
    line-height: 1.4;
  }
  
  .cost-info-main .text-warning {
    background: linear-gradient(135deg, #ffc107 0%, #ff8c00 100%);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    font-weight: 700;
    text-shadow: 0 0 15px rgba(255, 193, 7, 0.3);
  }
  
  /* === ENHANCED FORM INPUTS === */
  .form-control.form-dark,
  .form-select.form-dark {
    border-radius: 12px;
    padding: 12px 16px;
    font-size: 1rem;
    border: 2px solid rgba(102, 126, 234, 0.2);
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
    transition: all 0.3s ease;
    color: white;
    width: 100%;
  }
  
  /* === MOBILE FORM OPTIMIZATION === */
  @media (max-width: 600px) {
    .form-control.form-dark,
    .form-select.form-dark {
      margin-bottom: 0.5rem;
    }
    
    .row.g-2 {
      margin-left: -0.25rem;
      margin-right: -0.25rem;
    }
    
    .row.g-2 > [class*="col-"] {
      padding-left: 0.25rem;
      padding-right: 0.25rem;
    }
  }
  
  .form-control.form-dark:focus,
  .form-select.form-dark:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.25), 0 0 20px rgba(102, 126, 234, 0.1);
    transform: translateY(-1px);
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.03) 100%);
  }
  
  .form-control.form-dark::placeholder,
  .form-select.form-dark::placeholder {
    color: rgba(255, 255, 255, 0.6);
  }
  
  /* Enhanced form labels */
  .form-label {
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .form-label i {
    color: #667eea;
    font-size: 1.1rem;
  }
  
  /* Enhanced textarea */
  textarea.form-control.form-dark {
    min-height: 80px;
    resize: vertical;
    line-height: 1.5;
  }
  
  /* Enhanced select dropdowns */
  .form-select.form-dark option {
    background: #1a1a2e;
    color: white;
    padding: 8px 12px;
  }
  
  /* === UTILITY CLASSES === */
  [x-cloak] {
    display: none !important;
  }
  
  .bg-gradient {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }
  
  /* === ANIMATIONS === */
  @keyframes progress-animation {
    0% { width: 0%; }
    50% { width: 70%; }
    100% { width: 100%; }
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .fade-in-up {
    animation: fadeInUp 0.6s ease-out;
  }
  
  /* === ENHANCED FOCUS STATES === */
  *:focus {
    outline: none;
  }
  
  .form-control:focus,
  .form-select:focus {
    border-color: #667eea !important;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1) !important;
  }
  
  /* === SMOOTH SCROLLING === */
  html {
    scroll-behavior: smooth;
  }
  
  /* === ADDITIONAL MOBILE OPTIMIZATIONS === */
  @media (max-width: 600px) {
    /* Better mobile spacing */
    .mb-4 {
      margin-bottom: 1rem !important;
    }
    
    .mb-3 {
      margin-bottom: 0.75rem !important;
    }
    
    /* Mobile form layout improvements */
    .input-group-container {
      margin-bottom: 0.5rem;
    }
    
    /* Mobile label improvements */
    .form-label.text-secondary.d-flex.align-items-center.justify-content-between {
      flex-direction: column;
      align-items: flex-start !important;
      gap: 0.5rem;
    }
    
    .char-counter {
      align-self: flex-end;
      margin-top: 0;
    }
    
    /* Mobile input hint improvements */
    .input-hint {
      margin-top: 0.5rem;
      text-align: left;
    }
    
    /* Mobile button improvements */
    .d-grid.mt-4 {
      margin-top: 1rem !important;
    }
    
    .btn-gradient.py-3.fw-bold.fs-5 {
      padding: 12px 20px !important;
      font-size: 1rem !important;
    }
  }
  
  @media (max-width: 480px) {
    /* Extra small mobile improvements */
    .form-label.text-secondary.d-flex.align-items-center.justify-content-between {
      gap: 0.4rem;
    }
    
    /* Extra small mobile title input layout */
    .title-label-container {
      gap: 0.4rem;
      margin-bottom: 0.4rem;
    }
    
    .char-counter-container {
      gap: 0.2rem;
      align-self: flex-end;
    }
    
    .char-counter-progress {
      width: 60px;
      height: 2px;
    }
    
    .char-counter-text {
      font-size: 0.6rem;
      padding: 0.15rem 0.4rem;
      min-width: 35px;
    }
    
    .input-hint {
      font-size: 0.65rem;
      padding: 0.25rem 0.4rem;
    }
    
    .btn-gradient.py-3.fw-bold.fs-5 {
      padding: 10px 16px !important;
      font-size: 0.9rem !important;
    }
  }
  
  /* === ENHANCED SHADOWS === */
  .glass-panel,
  .gallery-popup,
  .btn-gradient {
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
  }
  
  /* === FACE SWAP SPECIFIC STYLING === */
  .face-swap-form {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 1.5rem;
    padding: 2rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(15px);
  }
  
  .face-swap-upload-area {
    border: 2px dashed rgba(102, 126, 234, 0.4) !important;
    border-radius: 1rem !important;
    padding: 1.5rem !important;
    background: rgba(102, 126, 234, 0.05);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  
  .face-swap-upload-area::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, #667eea, #764ba2);
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .face-swap-upload-area:hover {
    border-color: rgba(102, 126, 234, 0.6) !important;
    background: rgba(102, 126, 234, 0.08);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
  }
  
  .face-swap-upload-area:hover::before {
    opacity: 1;
  }
  
  .face-swap-preview {
    max-width: 140px !important;
    max-height: 140px !important;
    border-radius: 1rem !important;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3) !important;
    margin-bottom: 1rem !important;
    object-fit: cover;
    border: 3px solid rgba(102, 126, 234, 0.2);
    transition: all 0.3s ease;
  }
  
  .face-swap-preview:hover {
    transform: scale(1.05);
    border-color: rgba(102, 126, 234, 0.5);
    box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4) !important;
  }
  
  /* === ENHANCED FORM CONTROLS === */
  .form-check-input {
    background-color: rgba(30, 41, 59, 0.8) !important;
    border: 2px solid rgba(255, 255, 255, 0.2) !important;
    border-radius: 0.5rem;
    width: 1.2rem;
    height: 1.2rem;
    transition: all 0.3s ease;
  }
  
  .form-check-input:checked {
    background-color: #667eea !important;
    border-color: #667eea !important;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
  }
  
  .form-check-input:focus {
    border-color: #667eea !important;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
    outline: none;
  }
  
  .form-check-label {
    cursor: pointer;
    user-select: none;
    transition: color 0.3s ease;
  }
  
  .form-check-label:hover {
    color: #667eea !important;
  }
  
  /* === MODERN ALERT STYLING === */
  .alert {
    border-radius: 1rem;
    border: 2px solid transparent;
    backdrop-filter: blur(15px);
    font-weight: 500;
    letter-spacing: 0.02em;
  }
  
  .alert-info {
    background: rgba(59, 130, 246, 0.15) !important;
    border-color: rgba(59, 130, 246, 0.3) !important;
    color: #60a5fa !important;
  }
  
  .alert-success {
    background: rgba(16, 185, 129, 0.15) !important;
    border-color: rgba(16, 185, 129, 0.3) !important;
    color: #10b981 !important;
  }
  
  .alert-danger {
    background: rgba(239, 68, 68, 0.15) !important;
    border-color: rgba(239, 68, 68, 0.3) !important;
    color: #ef4444 !important;
  }
  
  .alert-warning {
    background: rgba(245, 158, 11, 0.15) !important;
    border-color: rgba(245, 158, 11, 0.3) !important;
    color: #f59e0b !important;
  }
  
  /* === ENHANCED BUTTON VARIANTS === */
  .btn-warning {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    border: none;
    color: white;
    border-radius: 0.75rem;
    padding: 0.5rem 1rem;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
  }
  
  .btn-warning:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
    color: white;
  }
  
  /* === ENHANCED SPINNER === */
  .spinner-border {
    border-width: 0.2em;
    border-color: currentColor transparent currentColor transparent;
  }
  
  /* === SMOOTH TRANSITIONS === */
  * {
    transition: all 0.3s ease;
  }
  
  /* === ENHANCED TYPOGRAPHY === */
  .fw-bold {
    font-weight: 700 !important;
    letter-spacing: 0.02em;
  }
  
  .fw-semibold {
    font-weight: 600 !important;
    letter-spacing: 0.01em;
  }
  
  /* === MODERN ICONS === */
  .bi {
    transition: all 0.3s ease;
  }
  
  .bi:hover {
    transform: scale(1.1);
  }
  
  /* === ENHANCED FOCUS RINGS === */
  .btn:focus,
  .form-control:focus,
  .form-select:focus,
  .form-check-input:focus {
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2) !important;
    outline: none;
  }
  
  /* === ANTI-BLUR TEXT OPTIMIZATION === */
  * {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
  }
  
  body, html {
    font-smooth: never !important;
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
  }
  
  /* === CRYSTAL CLEAR TEXT === */
  .form-label,
  .form-control,
  .form-select,
  .btn,
  .alert,
  .text-white,
  .text-secondary,
  .text-muted,
  .fw-bold,
  .fw-semibold,
  label,
  small,
  span,
  div,
  p,
  h1, h2, h3, h4, h5, h6 {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    text-shadow: 0 0 1px rgba(0, 0, 0, 0.1) !important;
    font-weight: inherit !important;
  }
  
  /* === ENHANCED INPUT STYLING === */
  .form-control,
  .form-select {
    font-weight: 500 !important;
    letter-spacing: 0.02em !important;
    line-height: 1.6 !important;
    font-size: 16px !important;
    padding: 16px 20px !important;
    border-radius: 1rem !important;
    border: 2px solid rgba(255, 255, 255, 0.1) !important;
    background: rgba(30, 41, 59, 0.9) !important;
    color: #ffffff !important;
    transition: all 0.3s ease !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
  }
  
  .form-control:focus,
  .form-select:focus {
    border-color: #667eea !important;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2), 0 4px 12px rgba(0, 0, 0, 0.3) !important;
    background: rgba(30, 41, 59, 0.95) !important;
    transform: translateY(-1px) !important;
  }
  
  .form-control::placeholder,
  .form-select::placeholder {
    color: rgba(203, 213, 225, 0.7) !important;
    font-weight: 400 !important;
    opacity: 1 !important;
  }
  
  /* === CRYSTAL CLEAR LABELS === */
  .form-label {
    font-weight: 600 !important;
    color: #e0e6ed !important;
    margin-bottom: 0.75rem !important;
    font-size: 1rem !important;
    letter-spacing: 0.02em !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
    display: block !important;
  }
  
  /* === ENHANCED BUTTON TEXT === */
  .btn {
    font-weight: 600 !important;
    letter-spacing: 0.02em !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
  }
  
  .btn-gradient {
    font-weight: 700 !important;
    letter-spacing: 0.03em !important;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important;
  }
  
  /* === CRYSTAL CLEAR ALERTS === */
  .alert {
    font-weight: 500 !important;
    letter-spacing: 0.02em !important;
    line-height: 1.6 !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
  }
  
  /* === ENHANCED TYPOGRAPHY === */
  .text-white {
    color: #ffffff !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
  }
  
  .text-secondary {
    color: #bfc9db !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
  }
  
  .text-muted {
    color: #94a3b8 !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
  }
  
  .fw-bold {
    font-weight: 700 !important;
    letter-spacing: 0.03em !important;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important;
  }
  
  .fw-semibold {
    font-weight: 600 !important;
    letter-spacing: 0.02em !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
  }
  
  /* === ENHANCED SMALL TEXT === */
  small {
    font-weight: 500 !important;
    letter-spacing: 0.01em !important;
    line-height: 1.5 !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
  }
  
  /* === ENHANCED ICONS === */
  .bi {
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
  }
  
  /* === ENHANCED PLACEHOLDER === */
  ::placeholder {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    opacity: 1 !important;
  }
  
  /* === ENHANCED SELECT OPTIONS === */
  .form-select option {
    background: rgba(30, 41, 59, 0.95) !important;
    color: #ffffff !important;
    font-weight: 500 !important;
    padding: 12px !important;
  }
  
  /* === ENHANCED TEXTAREA === */
  textarea.form-control {
    min-height: 120px !important;
    resize: vertical !important;
    line-height: 1.6 !important;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
  }
  
  /* === ENHANCED FOCUS VISIBILITY === */
  .form-control:focus,
  .form-select:focus,
  .btn:focus {
    outline: none !important;
    border-color: #667eea !important;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2) !important;
  }
  
  /* === ENHANCED HOVER STATES === */
  .form-control:hover,
  .form-select:hover {
    border-color: rgba(102, 126, 234, 0.3) !important;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.3) !important;
  }
  
  /* === ENHANCED DISABLED STATES === */
  .form-control:disabled,
  .form-select:disabled,
  .btn:disabled {
    opacity: 0.6 !important;
    cursor: not-allowed !important;
    background: rgba(30, 41, 59, 0.5) !important;
  }
  
  /* === ENHANCED VALIDATION STATES === */
  .form-control.is-valid {
    border-color: #10b981 !important;
    box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.2) !important;
  }
  
  .form-control.is-invalid {
    border-color: #ef4444 !important;
    box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2) !important;
  }
  
  /* === ENHANCED READONLY STATES === */
  .form-control[readonly] {
    background: rgba(30, 41, 59, 0.7) !important;
    color: #94a3b8 !important;
    cursor: default !important;
  }
  
  /* === ENHANCED REQUIRED FIELDS === */
  .form-label.required::after {
    content: " *" !important;
    color: #ef4444 !important;
    font-weight: 700 !important;
  }
  
  /* === ENHANCED HELPER TEXT === */
  .form-text {
    font-size: 0.875rem !important;
    color: #94a3b8 !important;
    margin-top: 0.5rem !important;
    font-weight: 400 !important;
    letter-spacing: 0.01em !important;
    line-height: 1.5 !important;
  }
  
  /* === PROMPT TEXTAREA ANTI-BLUR === */
  textarea[placeholder*="denim jacket"],
  textarea[placeholder*="prompt"],
  textarea[placeholder*="Masukkan prompt"],
  textarea.form-control {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 500 !important;
    letter-spacing: 0.02em !important;
    line-height: 1.6 !important;
    font-size: 16px !important;
    color: #ffffff !important;
    background: rgba(30, 41, 59, 0.95) !important;
    border: 2px solid rgba(255, 255, 255, 0.15) !important;
    border-radius: 1rem !important;
    padding: 20px !important;
    min-height: 120px !important;
    resize: vertical !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
    transition: all 0.3s ease !important;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
  }
  
  textarea.form-control:focus {
    border-color: #667eea !important;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2), 0 8px 25px rgba(0, 0, 0, 0.4) !important;
    background: rgba(30, 41, 59, 1) !important;
    transform: translateY(-2px) !important;
    outline: none !important;
  }
  
  textarea.form-control::placeholder {
    color: rgba(203, 213, 225, 0.8) !important;
    font-weight: 400 !important;
    opacity: 1 !important;
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
  }
  
  /* === ENHANCED PROMPT LABELS === */
  .form-label:has(+ textarea),
  .form-label:has(+ .form-control) {
    font-weight: 700 !important;
    color: #ffffff !important;
    margin-bottom: 1rem !important;
    font-size: 1.1rem !important;
    letter-spacing: 0.03em !important;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4) !important;
    display: block !important;
    text-transform: uppercase !important;
    letter-spacing: 0.05em !important;
  }
  
  /* === ENHANCED NEGATIVE PROMPT === */
  .form-label:has(+ input[placeholder*="blur"]) {
    color: #fca5a5 !important;
    font-weight: 600 !important;
  }
  
  input[placeholder*="blur"],
  input[placeholder*="noise"],
  input[placeholder*="distorsi"] {
    background: rgba(239, 68, 68, 0.1) !important;
    border-color: rgba(239, 68, 68, 0.3) !important;
    color: #fca5a5 !important;
  }
  
  input[placeholder*="blur"]:focus,
  input[placeholder*="noise"]:focus,
  input[placeholder*="distorsi"]:focus {
    border-color: #ef4444 !important;
    box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2) !important;
  }
  
  /* === ENHANCED ASPECT RATIO SELECT === */
  .form-label:has(+ select[value="1:1"]),
  .form-label:has(+ select[value="16:9"]),
  .form-label:has(+ select[value="9:16"]) {
    color: #a78bfa !important;
    font-weight: 600 !important;
  }
  
  select[value="1:1"],
  select[value="16:9"],
  select[value="9:16"] {
    background: rgba(168, 139, 250, 0.1) !important;
    border-color: rgba(168, 139, 250, 0.3) !important;
  }
  
  /* === ENHANCED OUTPUT FORMAT === */
  .form-label:has(+ select[value="jpg"]),
  .form-label:has(+ select[value="png"]),
  .form-label:has(+ select[value="webp"]) {
    color: #34d399 !important;
    font-weight: 600 !important;
  }
  
  select[value="jpg"],
  select[value="png"],
  select[value="webp"] {
    background: rgba(52, 211, 153, 0.1) !important;
    border-color: rgba(52, 211, 153, 0.3) !important;
  }
  
  /* === ENHANCED GENERATE BUTTON === */
  .btn[type="submit"] {
    font-weight: 800 !important;
    letter-spacing: 0.05em !important;
    text-transform: uppercase !important;
    font-size: 1.2rem !important;
    padding: 20px 40px !important;
    border-radius: 1.5rem !important;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4) !important;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4) !important;
    transition: all 0.4s ease !important;
  }
  
  .btn[type="submit"]:hover {
    transform: translateY(-3px) scale(1.05) !important;
    box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6) !important;
  }
  
  /* === ENHANCED LOADING STATE === */
  .spinner-border-sm {
    border-width: 0.15em !important;
    width: 1rem !important;
    height: 1rem !important;
  }
  
  /* === ENHANCED TAB STYLING === */
  .btn[class*="tab-"] {
    font-weight: 700 !important;
    letter-spacing: 0.03em !important;
    text-transform: uppercase !important;
    font-size: 0.95rem !important;
    padding: 12px 24px !important;
    border-radius: 1rem !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
  }
  
  /* === ENHANCED INFO ALERTS === */
  .alert-info .text-white {
    color: #ffffff !important;
    font-weight: 700 !important;
    letter-spacing: 0.02em !important;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4) !important;
  }
  
  .alert-info .text-warning {
    color: #fbbf24 !important;
    font-weight: 800 !important;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4) !important;
  }
  
  /* === ENHANCED ICONS IN ALERTS === */
  .alert .bi {
    font-size: 1.2rem !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
  }
  
  /* === ENHANCED CONTAINER === */
  .container {
    font-smooth: never !important;
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
  }
  
  /* === ENHANCED ROW AND COL === */
  .row, .col-12, .col-lg-6 {
    font-smooth: never !important;
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
  }
  
  /* === ENHANCED GLASS PANEL TEXT === */
  .glass-panel * {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
  }
  
  /* === ENHANCED FORM TEXT === */
  form * {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
  }
  
  /* === ENHANCED ALL TEXT ELEMENTS === */
  .text-white, .text-secondary, .text-muted, .fw-bold, .fw-semibold,
  label, small, span, div, p, h1, h2, h3, h4, h5, h6,
  button, input, select, textarea, option {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    text-shadow: 0 0 1px rgba(0, 0, 0, 0.1) !important;
  }
  
  /* === ULTIMATE ANTI-BLUR OVERRIDE === */
  * {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-smooth: never !important;
  }
  
  /* === ENHANCED FACE SWAP SPECIFIC === */
  .face-swap-form * {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-smooth: never !important;
  }
  
  /* === ENHANCED BUTTON SM === */
  .btn-sm {
    font-weight: 600 !important;
    letter-spacing: 0.02em !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
  }
  
  /* === ENHANCED DANGER BUTTON === */
  .btn-danger {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
    border: none !important;
    color: white !important;
    border-radius: 0.75rem !important;
    padding: 0.5rem 1rem !important;
    font-weight: 600 !important;
    transition: all 0.3s ease !important;
    box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3) !important;
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
  }
  
  .btn-danger:hover {
    transform: translateY(-2px) !important;
    box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4) !important;
    color: white !important;
  }
  
  /* === ENHANCED IMAGE PREVIEWS === */
  .img-fluid {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
  }
  
  /* === ENHANCED SHADOW LG === */
  .shadow-lg {
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05) !important;
  }
  
  /* === ENHANCED ROUNDED === */
  .rounded {
    border-radius: 0.5rem !important;
  }
  
  /* === ENHANCED NOTIFICATION TEXT === */
  .notification-text {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 600 !important;
    letter-spacing: 0.02em !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
  }
  
  /* === ENHANCED PLACEHOLDER TEXT === */
  ::placeholder {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    opacity: 1 !important;
    font-weight: 400 !important;
  }
  
  /* === ENHANCED SELECT OPTIONS === */
  .form-select option {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 500 !important;
    background: rgba(30, 41, 59, 0.95) !important;
    color: #ffffff !important;
    padding: 12px !important;
  }
  
  /* === ENHANCED CHECKBOX LABELS === */
  .form-check-label {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 500 !important;
    letter-spacing: 0.01em !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
    cursor: pointer !important;
    user-select: none !important;
  }
  
  /* === ENHANCED TOOLTIP TEXT === */
  [title] {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
  }
  
  /* === ENHANCED ALT TEXT === */
  [alt] {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
  }
  
  /* === ENHANCED ALL BUTTONS === */
  .btn, .btn-primary, .btn-secondary, .btn-success, .btn-danger, .btn-warning, .btn-info, .btn-light, .btn-dark {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 600 !important;
    letter-spacing: 0.02em !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
  }
  
  /* === ENHANCED ALL INPUTS === */
  input, input[type="text"], input[type="number"], input[type="email"], input[type="password"], input[type="search"], input[type="tel"], input[type="url"] {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 500 !important;
    letter-spacing: 0.02em !important;
  }
  
  /* === ENHANCED ALL SELECTS === */
  select, select.form-select, select.form-control {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 500 !important;
    letter-spacing: 0.02em !important;
  }
  
  /* === ENHANCED ALL TEXTAREAS === */
  textarea, textarea.form-control, textarea.form-control-sm, textarea.form-control-lg {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 500 !important;
    letter-spacing: 0.02em !important;
    line-height: 1.6 !important;
  }
  
  /* === ENHANCED ALL LABELS === */
  label, .form-label, .form-check-label, .form-select-label {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 600 !important;
    letter-spacing: 0.02em !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
  }
  
  /* === ENHANCED ALL SMALL TEXT === */
  small, .small, .text-muted, .text-secondary {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 500 !important;
    letter-spacing: 0.01em !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
  }
  
  /* === ENHANCED ALL ICONS === */
  .bi, i, [class*="bi-"], [class*="icon-"] {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
  }
  
  /* === ENHANCED ALL ALERTS === */
  .alert, .alert-primary, .alert-secondary, .alert-success, .alert-danger, .alert-warning, .alert-info, .alert-light, .alert-dark {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 500 !important;
    letter-spacing: 0.02em !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
  }
  
  /* === ENHANCED ALL SPANS === */
  span, .span, [class*="text-"] {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    text-shadow: 0 0 1px rgba(0, 0, 0, 0.1) !important;
  }
  
  /* === ENHANCED ALL DIVS === */
  div, .div, [class*="col-"], [class*="row"], [class*="container"] {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
  }
  
  /* === ENHANCED ALL PARAGRAPHS === */
  p, .p, [class*="lead"], [class*="text-"] {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    line-height: 1.6 !important;
    text-shadow: 0 0 1px rgba(0, 0, 0, 0.1) !important;
  }
  
  /* === ENHANCED ALL HEADINGS === */
  h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 700 !important;
    letter-spacing: 0.03em !important;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important;
  }
  
  /* === ENHANCED ALL OPTIONS === */
  option, .option {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-weight: 500 !important;
    letter-spacing: 0.01em !important;
  }
  
  /* === ENHANCED ALL TEMPLATES === */
  template, [x-text], [x-html], [x-show] {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
  }
  
  /* === ENHANCED ALL ALPINE DIRECTIVES === */
  [x-data], [x-init], [x-show], [x-if], [x-for], [x-model], [x-bind], [x-on] {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
  }
  
  /* === ENHANCED ALL BOOTSTRAP CLASSES === */
  .container, .row, .col, .col-1, .col-2, .col-3, .col-4, .col-5, .col-6, .col-7, .col-8, .col-9, .col-10, .col-11, .col-12,
  .col-sm, .col-md, .col-lg, .col-xl, .col-xxl,
  .d-flex, .d-grid, .d-block, .d-inline, .d-inline-block,
  .p-1, .p-2, .p-3, .p-4, .p-5,
  .m-1, .m-2, .m-3, .m-4, .m-5,
  .mb-1, .mb-2, .mb-3, .mb-4, .mb-5,
  .mt-1, .mt-2, .mt-3, .mt-4, .mt-5,
  .ms-1, .ms-2, .ms-3, .ms-4, .ms-5,
  .me-1, .me-2, .me-3, .me-4, .me-5,
  .py-1, .py-2, .py-3, .py-4, .py-5,
  .px-1, .px-2, .px-3, .px-4, .px-5,
  .gap-1, .gap-2, .gap-3, .gap-4, .gap-5,
  .w-100, .h-100, .position-relative, .position-absolute, .position-fixed,
  .text-center, .text-start, .text-end, .text-justify,
  .align-items-center, .align-items-start, .align-items-end, .align-items-stretch,
  .justify-content-center, .justify-content-start, .justify-content-end, .justify-content-between, .justify-content-around,
  .fs-1, .fs-2, .fs-3, .fs-4, .fs-5, .fs-6 {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
  }
  
  /* === ENHANCED ALL CUSTOM CLASSES === */
  .glass-panel, .form-dark, .btn-gradient, .btn-tag, .tab-active, .tab-inactive,
  .gallery-overlay, .gallery-popup, .gallery-grid, .gallery-thumb, .gallery-img,
  .loading-overlay, .text-gradient, .stat-card, .stat-number, .stat-label,
  .filter-section, .filter-title, .filter-row, .filter-group, .filter-label,
  .posts-table, .pagination-container, .pagination-info, .pagination-controls,
  .pagination-select, .pagination-button, .user-info, .user-avatar, .user-details,
  .status-badge, .action-buttons, .btn-action, .post-content, .content-type-indicator {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
  }
  
  /* === FINAL ANTI-BLUR OVERRIDE === */
  html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1 !important;
    font-smooth: never !important;
  }
  
  /* === ENHANCED MOBILE-FIRST LAYOUT === */
  .input-group-container {
    display: flex;
    gap: 1rem;
    align-items: flex-end;
    flex-wrap: wrap;
  }
  
  .input-field-wrapper {
    flex: 1;
    min-width: 250px;
  }
  
  .generate-btn-wrapper {
    flex-shrink: 0;
  }
  
  .title-input {
    width: 100%;
    border-radius: 12px;
    padding: 14px 18px;
    font-size: 1rem;
    border: 2px solid rgba(102, 126, 234, 0.2);
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
    transition: all 0.3s ease;
  }
  
  .title-input:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.25), 0 0 20px rgba(102, 126, 234, 0.1);
    transform: translateY(-1px);
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.03) 100%);
  }
  
  .generate-prompt-btn {
    min-width: 160px;
    height: 52px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    letter-spacing: 0.02em;
    white-space: nowrap;
  }
  
  /* === MOBILE BUTTON OPTIMIZATION === */
  @media (max-width: 600px) {
    .generate-prompt-btn {
      white-space: normal;
      text-align: center;
      line-height: 1.2;
    }
    
    .btn-content {
      flex-direction: column;
      gap: 0.25rem;
    }
    
    .btn-content i {
      font-size: 1.1rem;
    }
  }
  
  .btn-content {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
  }
  
  /* === AUTO PROMPT STYLING (Legacy Support) === */
  .form-row {
    display: flex;
    gap: 1rem;
    align-items: flex-end;
  }
  
  .form-section {
    flex: 1;
  }
  
  .char-counter {
    color: var(--text-muted);
    font-size: 0.8rem;
    font-weight: 500;
    background: rgba(255, 255, 255, 0.1);
    padding: 0.25rem 0.5rem;
    border-radius: 6px;
    margin-left: auto;
  }
  
  .input-hint {
    margin-top: 0.5rem;
    color: var(--text-muted);
    font-size: 0.85rem;
    font-style: italic;
  }
  
  .input-hint i {
    color: #667eea;
  }
  
  .btn-outline-primary {
    color: #667eea;
    border: 2px solid #667eea;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(102, 126, 234, 0.05) 100%);
    backdrop-filter: blur(10px);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    font-weight: 600;
    border-radius: 12px;
    padding: 12px 24px;
    white-space: nowrap;
    min-width: 160px;
    box-shadow: 0 4px 20px rgba(102, 126, 234, 0.15);
  }
  
  .btn-outline-primary::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
  }
  
  .btn-outline-primary:hover::before {
    left: 100%;
  }
  
  .btn-outline-primary:hover {
    color: white;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-color: #667eea;
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4), 0 0 20px rgba(102, 126, 234, 0.2);
  }
  
  .btn-outline-primary:active {
    transform: translateY(-1px) scale(0.98);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
  }
  
  .btn-outline-primary:disabled {
    color: #888;
    border-color: #444;
    background: rgba(68, 68, 68, 0.1);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }
  
  .btn-outline-primary:disabled::before {
    display: none;
  }
  
  /* Enhanced Magic Icon Animation */
  .btn-outline-primary .bi-magic {
    display: inline-block;
    transition: all 0.3s ease;
  }
  
  .btn-outline-primary:hover .bi-magic {
    transform: rotate(360deg) scale(1.1);
    color: #ffd700;
    text-shadow: 0 0 8px rgba(255, 215, 0, 0.6);
  }
  
  /* Gradient text effect for button */
  .btn-outline-primary:hover {
    background-clip: text;
    -webkit-background-clip: text;
  }
  
  .spinner {
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  
  /* Pulse glow animation for generating state */
  .btn-outline-primary.generating {
    animation: pulse-glow 2s ease-in-out infinite;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: 0 0 20px rgba(102, 126, 234, 0.6), 0 0 40px rgba(102, 126, 234, 0.4);
  }
  
  @keyframes pulse-glow {
    0%, 100% {
      box-shadow: 0 0 20px rgba(102, 126, 234, 0.6), 0 0 40px rgba(102, 126, 234, 0.4);
    }
    50% {
      box-shadow: 0 0 30px rgba(102, 126, 234, 0.8), 0 0 60px rgba(102, 126, 234, 0.6);
    }
  }
  
  /* Enhanced form row styling */
  .form-row {
    display: flex;
    gap: 1rem;
    align-items: flex-end;
    position: relative;
  }
  
  .form-row::after {
    content: '';
    position: absolute;
    bottom: -5px;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.3), transparent);
    border-radius: 1px;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .form-row:hover::after {
    opacity: 1;
  }
  
  /* Enhanced title input section */
  .title-input-section {
    position: relative;
  }
  
  .title-label-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 0.75rem;
    gap: 1rem;
  }
  
  .title-label-container .form-label {
    margin-bottom: 0;
    flex: 1;
  }
  
  .char-counter-container {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 0.3rem;
    flex-shrink: 0;
    position: relative;
  }
  
  .char-counter-progress {
    width: 80px;
    height: 4px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
    overflow: hidden;
    position: relative;
  }
  
  .char-counter-bar {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    border-radius: 2px;
    transition: width 0.3s ease;
    position: relative;
  }
  
  .char-counter-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    animation: shimmer 2s infinite;
  }
  
  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }
  
  .char-counter-text {
    color: var(--text-muted);
    font-size: 0.75rem;
    font-weight: 600;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
    padding: 0.25rem 0.6rem;
    border-radius: 12px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
    min-width: 45px;
    text-align: center;
  }
  
  .char-counter-text:hover {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(102, 126, 234, 0.08) 100%);
    color: #667eea;
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
  }
  
  /* Character counter states */
  .char-counter-container.warning .char-counter-bar {
    background: linear-gradient(90deg, #ffc107 0%, #ff8c00 100%);
  }
  
  .char-counter-container.warning .char-counter-text {
    color: #ffc107;
    border-color: rgba(255, 193, 7, 0.3);
  }
  
  .char-counter-container.danger .char-counter-bar {
    background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
  }
  
  .char-counter-container.danger .char-counter-text {
    color: #ef4444;
    border-color: rgba(239, 68, 68, 0.3);
  }
  
  .char-counter-container.success .char-counter-bar {
    background: linear-gradient(90deg, #10b981 0%, #059669 100%);
  }
  
  .char-counter-container.success .char-counter-text {
    color: #10b981;
    border-color: rgba(16, 185, 129, 0.3);
  }
  
  /* Character counter animations */
  .char-counter-container:hover .char-counter-progress {
    transform: scaleY(1.2);
    transition: transform 0.2s ease;
  }
  
  .char-counter-container:hover .char-counter-text {
    transform: translateY(-2px);
    transition: transform 0.2s ease;
  }
  
  /* Enhanced input hint */
  .input-hint {
    margin-top: 0.8rem;
    color: var(--text-muted);
    font-size: 0.85rem;
    font-style: italic;
    padding: 0.5rem 0.8rem;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(102, 126, 234, 0.02) 100%);
    border-radius: 8px;
    border-left: 3px solid #667eea;
    transition: all 0.3s ease;
  }
  
  .input-hint:hover {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(102, 126, 234, 0.05) 100%);
    transform: translateX(5px);
  }
  
  .input-hint i {
    color: #667eea;
    font-size: 1rem;
    margin-right: 0.5rem;
    text-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
  }
  
  /* Enhanced focus states for inputs */
  .form-control.form-dark.focus-ring:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.25), 0 0 20px rgba(102, 126, 234, 0.1);
    transform: translateY(-1px);
    transition: all 0.3s ease;
  }
  
  /* Success state for generated prompts */
  .form-control.success {
    border-color: #28a745;
    box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.25);
    background: linear-gradient(135deg, rgba(40, 167, 69, 0.05) 0%, rgba(40, 167, 69, 0.02) 100%);
  }
  
  /* Floating label effect */
  .form-label {
    transition: all 0.3s ease;
    position: relative;
  }
  
  .form-label::before {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 2px;
    background: linear-gradient(90deg, #667eea, #764ba2);
    transition: width 0.3s ease;
  }
  
  .form-section:hover .form-label::before {
    width: 100%;
  }
  
  /* Professional card styling enhancement */
  .glass-panel {
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
  }
  
  .glass-panel:hover {
    border-color: rgba(102, 126, 234, 0.3);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15), 0 0 20px rgba(102, 126, 234, 0.1);
  }
  
  /* === MODERN UPLOAD AREA STYLING === */
  .modern-upload-area {
    border: 2px dashed rgba(102, 126, 234, 0.4);
    border-radius: 1.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
    overflow: hidden;
    position: relative;
    min-height: 200px;
    background: rgba(255, 255, 255, 0.02);
    backdrop-filter: blur(10px);
  }
  
  .modern-upload-area:hover {
    border-color: #667eea;
    background: rgba(102, 126, 234, 0.05);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
  }
  
  .modern-upload-area.dragover {
    border-color: #8b5cf6;
    background: rgba(139, 92, 246, 0.1);
    transform: scale(1.02);
    box-shadow: 0 12px 35px rgba(139, 92, 246, 0.3);
  }
  
  .modern-upload-area.dragover .upload-icon {
    color: #8b5cf6;
    transform: scale(1.2);
  }
  
  .modern-upload-area.dragover .upload-placeholder h5 {
    color: #8b5cf6;
  }
  
  /* Face Swap specific dragover effects */
  .modern-upload-area.dragover .upload-placeholder p {
    color: #8b5cf6;
  }
  
  .modern-upload-area.dragover .upload-hint {
    background: rgba(139, 92, 246, 0.2);
    border-color: #8b5cf6;
    color: #8b5cf6;
  }
  
  .modern-upload-area.has-preview {
    border-style: solid;
    border-color: #667eea;
    background: rgba(102, 126, 234, 0.08);
  }
  
  .upload-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 3rem 2rem;
    text-align: center;
    height: 100%;
    min-height: 200px;
    cursor: pointer;
  }
  
  .upload-icon {
    font-size: 3.5rem;
    color: #667eea;
    margin-bottom: 1.5rem;
    transition: all 0.3s ease;
    text-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
  }
  
  .modern-upload-area:hover .upload-icon {
    transform: scale(1.1);
    color: #8b5cf6;
  }
  
  .upload-placeholder h5 {
    color: #ffffff;
    margin-bottom: 0.75rem;
    font-size: 1.25rem;
    font-weight: 600;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }
  
  .upload-placeholder p {
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: 1rem;
    font-size: 0.95rem;
  }
  
  .upload-hint {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.8rem;
    background: rgba(102, 126, 234, 0.1);
    padding: 0.5rem 1rem;
    border-radius: 8px;
    border: 1px solid rgba(102, 126, 234, 0.2);
    backdrop-filter: blur(10px);
  }
  
  .image-preview-container {
    position: relative;
    padding: 1.5rem;
    text-align: center;
  }
  
  .preview-img {
    max-width: 100%;
    max-height: 300px;
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    border: 3px solid rgba(102, 126, 234, 0.3);
    transition: all 0.3s ease;
  }
  
  .preview-img:hover {
    transform: scale(1.02);
    border-color: #667eea;
    box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
  }
  
  .image-actions {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    margin-top: 1rem;
    flex-wrap: wrap;
  }
  
  .image-actions .btn {
    border-radius: 8px;
    font-size: 0.85rem;
    padding: 0.5rem 1rem;
    font-weight: 500;
    transition: all 0.3s ease;
  }
  
  .image-actions .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  }
  
  .empty-state-actions {
    position: absolute;
    top: 1rem;
    right: 1rem;
    z-index: 3;
  }
  
  .empty-state-actions .btn {
    background: rgba(220, 38, 38, 0.1);
    border-color: rgba(220, 38, 38, 0.3);
    color: #dc2626;
    transition: all 0.3s ease;
  }
  
  .empty-state-actions .btn:hover {
    background: rgba(220, 38, 38, 0.2);
    border-color: #dc2626;
    transform: scale(1.05);
  }
  
  .url-input-container {
    margin-top: 1rem;
  }
  
  .url-input-container .input-group-text {
    background: rgba(102, 126, 234, 0.1);
    border: 1px solid rgba(102, 126, 234, 0.2);
    color: #667eea;
    border-right: none;
  }
  
  .url-input-container .form-control {
    border-left: none;
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(102, 126, 234, 0.2);
  }
  
  .url-input-container .form-control:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }
  
  .url-input-container .btn {
    border-left: none;
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(102, 126, 234, 0.2);
    color: rgba(255, 255, 255, 0.7);
    transition: all 0.3s ease;
  }
  
  .url-input-container .btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: #ffffff;
    transform: scale(1.05);
  }
  
  .btn-disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
  }
  
  .btn-disabled:hover {
    transform: none !important;
    box-shadow: none !important;
  }
  
  /* === IMAGE PREVIEW MODAL === */
  .image-preview-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    padding: 2rem;
    outline: none;
  }
  
  .image-preview-popup {
    background: rgba(30, 41, 59, 0.95);
    border-radius: 1rem;
    max-width: 90vw;
    max-height: 90vh;
    overflow: hidden;
    border: 2px solid rgba(102, 126, 234, 0.3);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  }
  
  .image-preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(102, 126, 234, 0.1);
  }
  
  .image-preview-close {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #ffffff;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    cursor: pointer;
  }
  
  .image-preview-close:hover {
    background: rgba(220, 38, 38, 0.8);
    border-color: #dc2626;
    transform: scale(1.1);
  }
  
  .image-preview-body {
    padding: 1rem;
    text-align: center;
    max-height: 70vh;
    overflow: auto;
  }
  
  .image-preview-img {
    max-width: 100%;
    max-height: 100%;
    border-radius: 0.5rem;
    cursor: zoom-in;
    transition: all 0.3s ease;
  }
  
  .image-preview-img.zoomed {
    transform: scale(1.5);
    cursor: zoom-out;
  }
  
  .image-preview-footer {
    padding: 1rem 1.5rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(102, 126, 234, 0.05);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  /* === RESULT IMAGE STYLING === */
  .result-image {
    transition: all 0.3s ease;
  }
  
  .result-image:hover {
    transform: scale(1.02);
    box-shadow: 0 12px 50px rgba(168, 85, 247, 0.6) !important;
    border-color: #8b5cf6 !important;
  }
  
  .result-image:active {
    transform: scale(0.98);
  }
  
  /* Ensure result image remains clickable */
  .result-image {
    pointer-events: auto !important;
    user-select: none;
  }
  
  .result-image:hover {
    pointer-events: auto !important;
  }
  
  /* === UPLOAD PROGRESS BAR === */
  .upload-progress {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 1rem;
    border: 1px solid rgba(102, 126, 234, 0.2);
  }
  
  .progress-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }
  
  .progress-text {
    color: #ffffff;
    font-size: 0.9rem;
    font-weight: 500;
  }
  
  .progress-percent {
    color: #667eea;
    font-weight: 600;
    font-size: 0.9rem;
  }
  
  .progress-bar {
    width: 100%;
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    overflow: hidden;
    position: relative;
  }
  
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea, #8b5cf6);
    border-radius: 4px;
    transition: width 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  
  .progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    animation: shimmer 2s infinite;
  }
  
  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }
  
  /* === RESPONSIVE DESIGN === */
  @media (max-width: 768px) {
    .modern-upload-area {
      min-height: 180px;
    }
    
    .upload-placeholder {
      padding: 2rem 1rem;
    }
    
    .upload-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }
    
    .upload-placeholder h5 {
      font-size: 1.1rem;
    }
    
    .image-actions {
      flex-direction: column;
      align-items: center;
    }
    
    .image-actions .btn {
      width: 100%;
      max-width: 200px;
    }
    
    .image-preview-overlay {
      padding: 1rem;
    }
    
    .image-preview-popup {
      max-width: 95vw;
      max-height: 95vh;
    }
    
    .image-preview-header {
      padding: 0.75rem 1rem;
    }
    
    .image-preview-body {
      padding: 0.75rem;
    }
    
    .image-preview-footer {
      padding: 0.75rem 1rem;
      flex-direction: column;
      gap: 0.5rem;
      text-align: center;
    }
  }
  
  /* === MODERN GALLERY STYLING === */
  .gallery-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid rgba(102, 126, 234, 0.2);
  }
  
  .gallery-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #ffffff;
  }
  
  .gallery-title .text-gradient {
    background: linear-gradient(135deg, #667eea, #8b5cf6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .gallery-close-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #ffffff;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    cursor: pointer;
  }
  
  .gallery-close-btn:hover {
    background: rgba(220, 38, 38, 0.8);
    border-color: #dc2626;
    transform: scale(1.1);
  }
  
  .gallery-instructions {
    background: rgba(102, 126, 234, 0.1);
    border: 1px solid rgba(102, 126, 234, 0.2);
    border-radius: 8px;
    padding: 0.75rem 1rem;
    margin-bottom: 1.5rem;
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.9rem;
    text-align: center;
  }
  
  .gallery-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 0.25rem;
  }
  
  .gallery-tab {
    flex: 1;
    background: transparent;
    border: none;
    color: rgba(255, 255, 255, 0.7);
    padding: 0.75rem 1rem;
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.3s ease;
    cursor: pointer;
  }
  
  .gallery-tab.active {
    background: linear-gradient(135deg, #667eea, #8b5cf6);
    color: #ffffff;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
  }
  
  .gallery-tab:hover:not(.active) {
    background: rgba(255, 255, 255, 0.1);
    color: #ffffff;
  }
  
  .gallery-section-header {
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
    padding: 0.75rem 1rem;
    background: rgba(102, 126, 234, 0.1);
    border-radius: 8px;
    border-left: 4px solid #667eea;
    color: #ffffff;
    font-weight: 600;
  }
  
  .gallery-count {
    margin-left: auto;
    background: rgba(102, 126, 234, 0.2);
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.8rem;
    color: #667eea;
  }
  
  .gallery-content {
    margin-bottom: 2rem;
  }
  
  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 1rem;
    margin-bottom: 1rem;
  }
  
  .gallery-item {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid transparent;
  }
  
  .gallery-item:hover {
    transform: translateY(-4px);
    border-color: #667eea;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
  }
  
  .gallery-item-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(102, 126, 234, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: all 0.3s ease;
    z-index: 2;
  }
  
  .gallery-item:hover .gallery-item-overlay {
    opacity: 1;
  }
  
  .gallery-item-overlay i {
    font-size: 2rem;
    color: #ffffff;
  }
  
  .gallery-item-img {
    width: 100%;
    height: 120px;
    object-fit: cover;
    transition: all 0.3s ease;
  }
  
  .gallery-item:hover .gallery-item-img {
    transform: scale(1.1);
  }
  
  .gallery-item-caption {
    padding: 0.4rem 0.5rem;
    background: rgba(0, 0, 0, 0.8);
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.75rem;
    text-align: center;
    line-height: 1.2;
    max-height: 2.4em;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
  }
  
  .gallery-empty {
    text-align: center;
    padding: 3rem 1rem;
    color: rgba(255, 255, 255, 0.6);
  }
  
  .gallery-empty i {
    margin-bottom: 1rem;
    opacity: 0.5;
  }
  
  .gallery-empty p {
    margin: 0;
    font-size: 1rem;
  }
  
  /* === RESPONSIVE GALLERY === */
  @media (max-width: 768px) {
    .gallery-grid {
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 0.75rem;
    }
    
    .gallery-item-img {
      height: 100px;
    }
    
    .gallery-tabs {
      flex-direction: column;
    }
    
    .gallery-header {
      flex-direction: column;
      gap: 1rem;
      text-align: center;
    }
  }
</style>
<script>
function alpineData() {
  return {
    tab: 'generate',
    loading: false,
    photo: { 
      title: '', 
      prompt: '', 
      model: 'imagen4-ultra',
      aspect: '1:1', 
      format: 'jpg', 
      negative_prompt: '' 
    },
    fusigaya: {
      title: '',
      prompt: '',
      model: 'flux-kontext-dev',
      images: [{ url: '', preview: '', loading: false, fileInfo: null, uploadProgress: 0, dragover: false }],
      size: '',
      num_inference_steps: 28,
      guidance_scale: 2.5,
      num_images: 1,
      seed: -1,
      enable_base64_output: false,
      enable_safety_checker: true
    },
    faceSwap: {
      image: '',
      faceImage: '',
      imagePreview: '',
      faceImagePreview: '',
      imageUploadProgress: 0,
      faceUploadProgress: 0,
      imageDragover: false,
      faceDragover: false,
      targetIndex: 0,
      outputFormat: 'jpeg',
      enableBase64Output: false,
      enableSafetyChecker: true,
      enableSyncMode: false
    },
    miniatur: {
      prompt: '',
      imageUrl: '',
      imagePreview: '',
      uploadProgress: 0,
      dragover: false,
      isGeneratingPrompt: false
    },
    
    // Computed properties untuk character counter
    get photoCharCounterClass() {
      const length = this.photo.title.length;
      if (length === 0) return '';
      if (length >= 270) return 'danger';
      if (length >= 240) return 'warning';
      if (length >= 150) return 'success';
      return '';
    },
    
    get fusigayaCharCounterClass() {
      const length = this.fusigaya.title.length;
      if (length === 0) return '';
      if (length >= 270) return 'danger';
      if (length >= 240) return 'warning';
      if (length >= 150) return 'success';
      return '';
    },
    
    
    get miniaturPromptCharCounterClass() {
      const length = this.miniatur.prompt.length;
      if (length === 0) return '';
      if (length >= 900) return 'danger';
      if (length >= 800) return 'warning';
      if (length >= 600) return 'success';
      return '';
    },
    
    // Function untuk memotong caption yang terlalu panjang
    getShortCaption(caption) {
      if (!caption) return '';
      if (caption.length <= 50) return caption;
      return caption.substring(0, 50) + '...';
    },
    
    // Function untuk trigger file input
    triggerFileInput(idx) {
      const fileInput = document.getElementById('fusigayaFile' + idx);
      if (fileInput) {
        fileInput.click();
      }
    },
    
    // Function untuk handle drag and drop
    handleDrop(event, idx) {
      event.preventDefault();
      const files = event.dataTransfer.files;
      if (files.length > 0) {
        const file = files[0];
        // Simulasi event untuk handleFusigayaFile
        const fakeEvent = { target: { files: [file] } };
        this.handleFusigayaFile(fakeEvent, idx);
      }
    },
    
    // Function untuk trigger face swap file input
    triggerFaceSwapFileInput(type) {
      const fileInput = document.getElementById('faceSwap' + (type === 'image' ? 'ImageInput' : 'FaceInput'));
      if (fileInput) {
        fileInput.click();
      }
    },
    
    // Function untuk handle face swap drag and drop
    handleFaceSwapDrop(event, type) {
      event.preventDefault();
      const files = event.dataTransfer.files;
      if (files.length > 0) {
        const file = files[0];
        // Simulasi event untuk handleFaceSwapImageFile
        const fakeEvent = { target: { files: [file] } };
        this.handleFaceSwapImageFile(fakeEvent, type);
      }
    },
    showGallery: false,
    showFusigayaGallery: false,
    showFusigayaSlotGallery: null,
    fusigayaModelIntroShown: false,
    photoModelIntroShown: false,
    showFaceSwapMainGallery: false,
    showFaceSwapFaceGallery: false,
    selectedFusigayaSlot: 0,
    activeGalleryTab: 'uploaded',
    imagePreviewModal: { show: false, url: '', source: '' },
    imageZoomed: false,
    showAllExamples: false,
    galleryImages: [],
    galleryGenerated: [],
    isGeneratingPrompt: false,
    isGeneratingFusigayaPrompt: false,
    exampleImages: [
      {
        id: 1,
        url: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=400&fit=crop',
        caption: 'Pria tua dengan rambut putih, mengenakan sweater coklat, duduk di bangku taman kayu.',
        source: 'fallback'
      },
      {
        id: 2,
        url: 'https://images.unsplash.com/photo-1494790108755-2616b612b786?w=400&h=400&fit=crop',
        caption: 'Wanita muda dengan rambut keriting gelap, mengenakan jaket denim dan t-shirt putih.',
        source: 'fallback'
      },
      {
        id: 3,
        url: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=400&h=400&fit=crop',
        caption: 'Pria paruh baya dengan jenggot dan kacamata, mengenakan trench coat coklat muda.',
        source: 'fallback'
      },
      {
        id: 4,
        url: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=400&h=400&fit=crop',
        caption: 'Pria tua dengan jenggot, mengenakan beanie gelap dan sweater gelap.',
        source: 'fallback'
      }
    ],
    exampleSource: 'fallback',
    resultUrl: '',
    errorMsg: '',
    onPhotoModelChange() {
      // Update UI based on selected model
      if (this.photo.model === 'gpt-image-1') {
        this.showNotification('Model GPT Image 1 dipilih. Model ini cepat dan kreatif untuk eksperimen!', 'info');
      } else {
        this.showNotification('Model Imagen4 Ultra dipilih. Model ini memberikan kualitas premium yang detail!', 'info');
      }
    },
    
    async submitPhoto() {
      this.loading = true;
      this.resultUrl = '';
      this.errorMsg = '';
      try {
        const res = await fetch('/generate_photo', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            prompt: this.photo.prompt,
            model: this.photo.model,
            aspect_ratio: this.photo.aspect,
            negative_prompt: this.photo.negative_prompt || ''
          })
        });
        const data = await res.json();
        if (data.success && data.photo_url) {
          this.resultUrl = data.photo_url;
          this.errorMsg = '';
          // Refresh contoh gambar setelah berhasil generate
          setTimeout(() => {
            loadExampleImagesFromDatabase();
          }, 1000);
        } else {
          this.resultUrl = '';
          this.errorMsg = data.message || data.error || 'Gagal generate gambar.';
        }
      } catch (e) {
        this.resultUrl = '';
        this.errorMsg = 'Terjadi kesalahan koneksi.';
      }
      this.loading = false;
    },
    
    // Generate Prompt from Title Function
    async generatePromptFromTitle() {
      if (!this.photo.title.trim()) {
        this.showNotification(' Harap masukkan judul gambar terlebih dahulu', 'warning');
        return;
      }
      
      if (this.photo.title.trim().length < 3) {
        this.showNotification(' Judul gambar terlalu pendek. Minimal 3 karakter.', 'warning');
        return;
      }
      
      this.isGeneratingPrompt = true;
      this.showNotification(' Memulai generate prompt dari judul...', 'info');
      
      try {
        const payload = {
          title: this.photo.title,
          type: 'image'
        };

        // Tambahkan timeout untuk mencegah hanging
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 detik timeout

        const response = await fetch('/api/chat/generate-photo-prompt', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
          signal: controller.signal
        });

        clearTimeout(timeoutId);

        const data = await response.json();
        if (data.success) {
          // Set generated prompt to textarea
          this.photo.prompt = data.prompt;
          
          // Set negative prompt if available
          if (data.negative_prompt) {
            this.photo.negative_prompt = data.negative_prompt;
          }
          
          this.showNotification(' Prompt dan Negative Prompt berhasil di-generate! Silakan review dan edit jika diperlukan.', 'success');
          
          // Scroll ke prompt textarea
          const textarea = document.querySelector('textarea[x-model="photo.prompt"]');
          if (textarea) {
            textarea.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        } else {
          this.showNotification(` ${data.error || 'Gagal generate prompt'}`, 'error');
        }
      } catch (error) {
        console.error('Error generating prompt:', error);
        
        if (error.name === 'AbortError') {
          this.showNotification(' Generate prompt timeout. Silakan coba lagi dengan judul yang lebih sederhana.', 'warning');
        } else if (error.message.includes('fetch')) {
          this.showNotification(' Gagal terhubung ke server. Silakan cek koneksi internet Anda.', 'error');
        } else {
          this.showNotification(' Error generate prompt. Silakan coba lagi.', 'error');
        }
      } finally {
        this.isGeneratingPrompt = false;
      }
    },
    
    // Generate Fusigaya Prompt from Title Function
    async generateFusigayaPromptFromTitle() {
      if (!this.fusigaya.title.trim()) {
        this.showNotification(' Harap masukkan judul gambar terlebih dahulu', 'warning');
        return;
      }
      
      if (this.fusigaya.title.trim().length < 3) {
        this.showNotification(' Judul gambar terlalu pendek. Minimal 3 karakter.', 'warning');
        return;
      }
      
      this.isGeneratingFusigayaPrompt = true;
      this.showNotification(' Memulai generate prompt fusigaya dari judul...', 'info');
      
      try {
        // Cek apakah ada gambar yang diupload
        const uploadedImages = this.fusigaya.images
          .filter(img => img.url && img.url.trim() !== '')
          .map(img => img.url);
        
        let payload;
        
        if (uploadedImages.length > 0) {
          // Jika ada gambar, gunakan analisis gambar
          this.showNotification(' Menganalisis gambar untuk memperkuat prompt...', 'info');
          
          // Ambil gambar pertama untuk analisis
          const firstImage = uploadedImages[0];
          
          // Convert gambar ke base64 untuk analisis
          const response = await fetch(firstImage);
          const blob = await response.blob();
          const base64 = await this.convertToBase64(blob);
          
          payload = {
            input: this.fusigaya.title,
            image_base64: base64
          };
          
          // Gunakan endpoint analisis gambar dengan timeout
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 detik timeout
          
          const analysisResponse = await fetch('/api/chat/analyze-image-fusigaya', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
            signal: controller.signal
          });
          
          clearTimeout(timeoutId);
          
          const analysisData = await analysisResponse.json();
          
          if (analysisData.success) {
            this.fusigaya.prompt = analysisData.prompt;
            this.showNotification(' Prompt FLUX.1 Kontext berhasil dibuat dengan analisis gambar! Prompt sudah siap pakai untuk style fusion.', 'success');
          } else {
            // Fallback ke generate prompt biasa jika analisis gagal
            this.showNotification(' Analisis gambar gagal, menggunakan generate prompt biasa...', 'warning');
            await this.generateFusigayaPromptFallback();
          }
        } else {
          // Jika tidak ada gambar, gunakan generate prompt biasa
          await this.generateFusigayaPromptFallback();
        }
        
        // Scroll ke prompt textarea
        const textarea = document.querySelector('textarea[x-model="fusigaya.prompt"]');
        if (textarea) {
          textarea.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
      } catch (error) {
        console.error('Error generating fusigaya prompt:', error);
        
        if (error.name === 'AbortError') {
          this.showNotification(' Generate prompt fusigaya timeout. Silakan coba lagi dengan judul yang lebih sederhana.', 'warning');
        } else if (error.message.includes('fetch')) {
          this.showNotification(' Gagal terhubung ke server. Silakan cek koneksi internet Anda.', 'error');
        } else if (error.message.includes('blob')) {
          this.showNotification(' Error memproses gambar. Pastikan format gambar valid (JPG, PNG, WEBP).', 'error');
        } else {
          this.showNotification(' Error generate prompt fusigaya. Silakan coba lagi.', 'error');
        }
      } finally {
        this.isGeneratingFusigayaPrompt = false;
      }
    },
    
    // Fallback function untuk generate prompt fusigaya tanpa gambar
    async generateFusigayaPromptFallback() {
      try {
        const payload = {
          title: this.fusigaya.title,
          type: 'fusigaya'
        };

        // Tambahkan timeout untuk mencegah hanging
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 detik timeout

        const response = await fetch('/api/chat/generate-photo-prompt', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
          signal: controller.signal
        });

        clearTimeout(timeoutId);

        const data = await response.json();
        if (data.success) {
          this.fusigaya.prompt = data.prompt;
          this.showNotification(' Prompt FLUX.1 Kontext berhasil dibuat! Prompt sudah siap pakai untuk style fusion.', 'success');
        } else {
          this.showNotification(` ${data.error || 'Gagal generate prompt fusigaya'}`, 'error');
        }
      } catch (error) {
        console.error('Error in fallback:', error);
        
        if (error.name === 'AbortError') {
          this.showNotification(' Generate prompt fusigaya timeout. Silakan coba lagi dengan judul yang lebih sederhana.', 'warning');
        } else if (error.message.includes('fetch')) {
          this.showNotification(' Gagal terhubung ke server. Silakan cek koneksi internet Anda.', 'error');
        } else {
          this.showNotification(' Error generate prompt fusigaya. Silakan coba lagi.', 'error');
        }
      }
    },
    
    // Helper function untuk convert blob ke base64
    convertToBase64(blob) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
          const base64 = reader.result.split(',')[1]; // Hapus data:image/...;base64,
          resolve(base64);
        };
        reader.onerror = reject;
        reader.readAsDataURL(blob);
      });
    },
    handleFusigayaFile(e, idx) {
      const file = e.target.files[0];
      if (file) {
        // Validasi ukuran file (max 10MB)
        if (file.size > 10 * 1024 * 1024) {
          const fileSize = (file.size / 1024 / 1024).toFixed(2);
          this.showNotification(`File ${file.name} terlalu besar (${fileSize} MB). Maksimal 10MB.`, 'warning');
          e.target.value = '';
          return;
        }
        // Validasi tipe file
        if (!file.type.startsWith('image/')) {
          this.showNotification(`File ${file.name} harus berupa gambar.`, 'warning');
          e.target.value = '';
          return;
        }
        // Tampilkan preview file lokal terlebih dahulu
        const reader = new FileReader();
        reader.onload = (event) => {
          this.fusigaya.images[idx].preview = event.target.result;
          // Simpan informasi file
          const fileSize = (file.size / 1024 / 1024).toFixed(2);
          // Dapatkan resolusi gambar
          const img = new Image();
          img.onload = () => {
            this.fusigaya.images[idx].fileInfo = {
              name: file.name,
              size: fileSize,
              type: file.type,
              width: img.width,
              height: img.height
            };
          };
          img.src = event.target.result;
        };
        reader.readAsDataURL(file);
        this.fusigaya.images[idx].loading = true;
        this.fusigaya.images[idx].uploadProgress = 0;
        
        // Simulasi progress bar untuk upload
        const progressInterval = setInterval(() => {
          if (this.fusigaya.images[idx].uploadProgress < 90) {
            this.fusigaya.images[idx].uploadProgress += Math.random() * 15;
          }
        }, 200);
        
        const formData = new FormData();
        formData.append('file', file);
        fetch('/upload_image_to_fusigaya', { method: 'POST', body: formData })
          .then(res => res.json())
          .then(data => {
            if (data.url) {
              this.fusigaya.images[idx].url = data.url;
              // Tetap gunakan preview lokal untuk performa lebih baik
              // this.fusigaya.images[idx].preview = data.url;
              console.log('File uploaded successfully:', data.url);
              // Tampilkan notifikasi sukses dengan informasi file
              const fileInfo = this.fusigaya.images[idx].fileInfo;
              if (fileInfo) {
                const sizeText = parseFloat(fileInfo.size) > 1 ? `${fileInfo.size} MB` : `${(parseFloat(fileInfo.size) * 1024).toFixed(0)} KB`;
                const fileType = fileInfo.type.split('/')[1]?.toUpperCase() || 'IMAGE';
                const resolution = fileInfo.width && fileInfo.height ? `${fileInfo.width}x${fileInfo.height}` : 'Unknown';
                this.showNotification(`File ${fileInfo.name} (${sizeText}, ${fileType}, ${resolution}) berhasil diupload!`, 'success');
              } else {
                this.showNotification('File berhasil diupload!', 'success');
              }
            } else {
              this.showNotification('Gagal upload file.', 'danger');
            }
            this.fusigaya.images[idx].loading = false;
            this.fusigaya.images[idx].uploadProgress = 100;
            clearInterval(progressInterval);
            // Reset file input
            e.target.value = '';
          })
          .catch(error => {
            console.error('Error uploading file:', error);
            this.fusigaya.images[idx].loading = false;
            this.fusigaya.images[idx].preview = '';
            this.fusigaya.images[idx].uploadProgress = 0;
            clearInterval(progressInterval);
            // Reset file input
            e.target.value = '';
            // Tampilkan notifikasi error
            const fileInfo = this.fusigaya.images[idx].fileInfo;
            if (fileInfo) {
              this.showNotification(`Gagal upload file ${fileInfo.name}. Silakan coba lagi.`, 'danger');
            } else {
              this.showNotification('Gagal upload file. Silakan coba lagi.', 'danger');
            }
          });
      }
    },
    handleFusigayaUrl(e, idx) {
      const url = e.target.value.trim();
      this.fusigaya.images[idx].url = url;
      if (url) {
        this.fusigaya.images[idx].loading = true;
        this.fusigaya.images[idx].preview = '';
        this.validateImageUrl(url, idx);
      } else {
        this.fusigaya.images[idx].preview = '';
        this.fusigaya.images[idx].loading = false;
      }
    },
    validateImageUrl(url, idx) {
      // Validasi format URL dasar
      try {
        new URL(url);
      } catch (e) {
        this.fusigaya.images[idx].preview = '';
        console.warn('Invalid URL format:', url);
        const urlParts = url.split('/');
        const fileName = urlParts[urlParts.length - 1] || 'gambar';
        this.showNotification(`Format URL tidak valid: ${fileName}`, 'warning');
        return;
      }
      const img = new Image();
      const timeout = setTimeout(() => {
        img.src = '';
        this.fusigaya.images[idx].preview = '';
        this.fusigaya.images[idx].loading = false;
        console.warn('Image load timeout:', url);
        const urlParts = url.split('/');
        const fileName = urlParts[urlParts.length - 1] || 'gambar';
        this.showNotification(`Timeout: ${fileName} terlalu lama dimuat.`, 'warning');
      }, 10000); // 10 detik timeout
      img.onload = () => {
        clearTimeout(timeout);
        // URL valid, preview sudah diatur
        this.fusigaya.images[idx].preview = url;
        this.fusigaya.images[idx].loading = false;
        // Hanya tampilkan notifikasi jika bukan dari file upload
        if (!this.fusigaya.images[idx].fileInfo) {
          const urlParts = url.split('/');
          const fileName = urlParts[urlParts.length - 1] || 'gambar';
          const resolution = `${img.width}x${img.height}`;
          this.showNotification(`URL gambar valid: ${fileName} (${resolution})`, 'success');
        }
      };
      img.onerror = () => {
        clearTimeout(timeout);
        // URL tidak valid, hapus preview
        this.fusigaya.images[idx].preview = '';
        this.fusigaya.images[idx].loading = false;
        console.warn('Invalid image URL:', url);
        const urlParts = url.split('/');
        const fileName = urlParts[urlParts.length - 1] || 'gambar';
        this.showNotification(`URL ${fileName} tidak valid atau tidak dapat diakses.`, 'warning');
      };
      img.src = url;
    },
    addFusigayaImage() {
      if (this.fusigaya.images.length >= 10) {
        this.showNotification('Maksimal 10 slot gambar yang diperbolehkan.', 'warning');
        return;
      }
      this.fusigaya.images.push({ url: '', preview: '', loading: false, fileInfo: null, uploadProgress: 0, dragover: false });
      const totalSlots = this.fusigaya.images.length;
      this.showNotification(`Slot gambar baru ditambahkan. Total: ${totalSlots} slot.`, 'success');
    },
    
    // Fungsi untuk mengatur gambar dari gallery ke slot Fusigaya tertentu
    setFusigayaImageFromGallery(slotIndex, url) {
      if (slotIndex >= 0 && slotIndex < this.fusigaya.images.length) {
        this.fusigaya.images[slotIndex].url = url;
        this.fusigaya.images[slotIndex].preview = url;
        this.fusigaya.images[slotIndex].loading = false;
        this.fusigaya.images[slotIndex].fileInfo = null;
        this.fusigaya.images[slotIndex].uploadProgress = 0;
        this.fusigaya.images[slotIndex].dragover = false;
        
        this.showNotification(`Gambar dari galeri berhasil diatur ke slot ${slotIndex + 1}.`, 'success');
      } else {
        this.showNotification('Slot tidak valid.', 'warning');
      }
    },
    
    // Fungsi untuk menambahkan gambar dari gallery ke Fusigaya (untuk kompatibilitas)
    addFusigayaImageFromGallery(url) {
      if (this.fusigaya.images.length >= 10) {
        this.showNotification('Maksimal 10 slot gambar yang diperbolehkan.', 'warning');
        return;
      }
      
      // Tambahkan slot baru dengan gambar dari gallery
      this.fusigaya.images.push({ 
        url: url, 
        preview: url, 
        loading: false, 
        fileInfo: null, 
        uploadProgress: 0, 
        dragover: false 
      });
      
      const totalSlots = this.fusigaya.images.length;
      this.showNotification(`Gambar dari galeri berhasil ditambahkan ke slot ${totalSlots}.`, 'success');
    },
    
    // Fungsi untuk mengatur gambar utama Face Swap dari gallery
    setFaceSwapMainImage(url) {
      this.faceSwap.image = url;
      this.faceSwap.imagePreview = url;
      this.showNotification('Gambar dari galeri berhasil dipilih sebagai gambar utama.', 'success');
    },
    
    // Fungsi untuk mengatur gambar wajah Face Swap dari gallery
    setFaceSwapFaceImage(url) {
      this.faceSwap.faceImage = url;
      this.faceSwap.faceImagePreview = url;
      this.showNotification('Gambar dari galeri berhasil dipilih sebagai gambar wajah.', 'success');
    },
    
    // Fungsi untuk memilih gambar dari gallery untuk Face Swap (untuk kompatibilitas)
    selectFaceSwapGalleryImage(url) {
      // Tentukan slot mana yang kosong (image atau faceImage)
      if (!this.faceSwap.image || !this.faceSwap.imagePreview) {
        // Set sebagai gambar utama
        this.faceSwap.image = url;
        this.faceSwap.imagePreview = url;
        this.showNotification('Gambar dari galeri berhasil dipilih sebagai gambar utama.', 'success');
      } else if (!this.faceSwap.faceImage || !this.faceSwap.faceImagePreview) {
        // Set sebagai gambar wajah
        this.faceSwap.faceImage = url;
        this.faceSwap.faceImagePreview = url;
        this.showNotification('Gambar dari galeri berhasil dipilih sebagai gambar wajah.', 'success');
      } else {
        // Kedua slot sudah terisi, tanya user mana yang ingin diganti
        if (confirm('Kedua slot gambar sudah terisi. Apakah Anda ingin mengganti gambar utama?')) {
          this.faceSwap.image = url;
          this.faceSwap.imagePreview = url;
          this.showNotification('Gambar dari galeri berhasil dipilih sebagai gambar utama.', 'success');
        } else {
          this.faceSwap.faceImage = url;
          this.faceSwap.faceImagePreview = url;
          this.showNotification('Gambar dari galeri berhasil dipilih sebagai gambar wajah.', 'success');
        }
      }
    },
    removeFusigayaImage(idx) {
      const removedImage = this.fusigaya.images[idx];
      this.fusigaya.images.splice(idx, 1);
      if (removedImage.fileInfo) {
        const sizeText = parseFloat(removedImage.fileInfo.size) > 1 ? `${removedImage.fileInfo.size} MB` : `${(parseFloat(removedImage.fileInfo.size) * 1024).toFixed(0)} KB`;
        const fileType = removedImage.fileInfo.type.split('/')[1]?.toUpperCase() || 'IMAGE';
        const resolution = removedImage.fileInfo.width && removedImage.fileInfo.height ? `${removedImage.fileInfo.width}x${removedImage.fileInfo.height}` : 'Unknown';
        this.showNotification(`File ${removedImage.fileInfo.name} (${sizeText}, ${fileType}, ${resolution}) berhasil dihapus.`, 'info');
      } else if (removedImage.url) {
        const urlParts = removedImage.url.split('/');
        const fileName = urlParts[urlParts.length - 1] || 'gambar';
        const resolution = removedImage.fileInfo && removedImage.fileInfo.width ? `${removedImage.fileInfo.width}x${removedImage.fileInfo.height}` : 'Unknown';
        this.showNotification(`URL ${fileName} (${resolution}) berhasil dihapus.`, 'info');
      } else {
        const remainingSlots = this.fusigaya.images.length;
        this.showNotification(`Gambar berhasil dihapus. Sisa: ${remainingSlots} slot.`, 'info');
      }
    },
    clearImageInput(idx) {
      const clearedImage = this.fusigaya.images[idx];
      this.fusigaya.images[idx].url = '';
      this.fusigaya.images[idx].preview = '';
      this.fusigaya.images[idx].loading = false;
      this.fusigaya.images[idx].fileInfo = null;
      this.fusigaya.images[idx].uploadProgress = 0;
      this.fusigaya.images[idx].dragover = false;
      if (clearedImage.fileInfo) {
        const sizeText = parseFloat(clearedImage.fileInfo.size) > 1 ? `${clearedImage.fileInfo.size} MB` : `${(parseFloat(clearedImage.fileInfo.size) * 1024).toFixed(0)} KB`;
        const fileType = clearedImage.fileInfo.type.split('/')[1]?.toUpperCase() || 'IMAGE';
        const resolution = clearedImage.fileInfo.width && clearedImage.fileInfo.height ? `${clearedImage.fileInfo.width}x${clearedImage.fileInfo.height}` : 'Unknown';
        this.showNotification(`Input file ${clearedImage.fileInfo.name} (${sizeText}, ${fileType}, ${resolution}) berhasil dibersihkan.`, 'info');
      } else if (clearedImage.url) {
        const urlParts = clearedImage.url.split('/');
        const fileName = urlParts[urlParts.length - 1] || 'gambar';
        const resolution = clearedImage.fileInfo && clearedImage.fileInfo.width ? `${clearedImage.fileInfo.width}x${clearedImage.fileInfo.height}` : 'Unknown';
        this.showNotification(`Input URL ${fileName} (${resolution}) berhasil dibersihkan.`, 'info');
      } else {
        const remainingSlots = this.fusigaya.images.length;
        this.showNotification(`Input berhasil dibersihkan. Sisa: ${remainingSlots} slot.`, 'info');
      }
    },
    onModelChange() {
      // Update UI based on selected model
      if (this.fusigaya.model === 'nano-banana') {
        // Reset FLUX-specific parameters for nano-banana model
        this.fusigaya.num_inference_steps = 28;
        this.fusigaya.guidance_scale = 2.5;
        this.fusigaya.num_images = 1;
        this.fusigaya.seed = -1;
        this.fusigaya.size = '';
        this.fusigaya.enable_safety_checker = true;
        this.showNotification('Model Nano Banana dipilih. Parameter lanjutan telah direset ke default.', 'info');
      } else {
        // Reset to default FLUX parameters
        this.fusigaya.num_inference_steps = 28;
        this.fusigaya.guidance_scale = 2.5;
        this.fusigaya.num_images = 1;
        this.fusigaya.seed = -1;
        this.showNotification(`Model ${this.fusigaya.model === 'flux-kontext-dev' ? 'FLUX.1 Kontext Dev' : 'FLUX.1 Kontext Pro'} dipilih. Semua parameter tersedia.`, 'info');
      }
    },
    
    async submitFusigaya() {
      // Validasi input
      if (!this.fusigaya.prompt.trim()) {
        this.errorMsg = 'Prompt wajib diisi.';
        this.showNotification(this.errorMsg, 'warning');
        return;
      }
      const validImages = this.fusigaya.images.filter(img => img.url && img.url.trim() !== '');
      if (validImages.length === 0) {
        this.errorMsg = 'Setidaknya satu gambar wajib diisi.';
        this.showNotification(this.errorMsg, 'warning');
        return;
      }
      console.log('Submitting fusigaya with:', {
        prompt: this.fusigaya.prompt,
        model: this.fusigaya.model,
        images: validImages.length,
        parameters: {
          size: this.fusigaya.size,
          num_inference_steps: this.fusigaya.num_inference_steps,
          guidance_scale: this.fusigaya.guidance_scale,
          num_images: this.fusigaya.num_images,
          seed: this.fusigaya.seed
        }
      });
      this.loading = true;
      this.resultUrl = '';
      this.errorMsg = '';
      try {
        const res = await fetch('/api/fusigaya', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            prompt: this.fusigaya.prompt,
            model: this.fusigaya.model,
            images: this.fusigaya.images.map(img => img.url).filter(Boolean),
            size: this.fusigaya.size,
            num_inference_steps: this.fusigaya.num_inference_steps,
            guidance_scale: this.fusigaya.guidance_scale,
            num_images: this.fusigaya.num_images,
            seed: this.fusigaya.seed,
            enable_base64_output: this.fusigaya.enable_base64_output,
            enable_safety_checker: this.fusigaya.enable_safety_checker
          })
        });
        const data = await res.json();
        if (res.ok && data.output_url) {
          this.resultUrl = data.output_url;
          const imageCount = this.fusigaya.images.filter(img => img.url).length;
          const resolutions = this.fusigaya.images.filter(img => img.fileInfo && img.fileInfo.width).map(img => `${img.fileInfo.width}x${img.fileInfo.height}`);
          const resolutionText = resolutions.length > 0 ? ` (${resolutions.join(', ')})` : '';
          this.showNotification(`Fusigaya berhasil! Diproses ${imageCount} gambar${resolutionText}.`, 'success');
          // Refresh contoh gambar setelah berhasil generate
          setTimeout(() => {
            loadExampleImagesFromDatabase();
          }, 1000);
        } else if (res.ok && data.result_url) {
          this.resultUrl = data.result_url;
          const imageCount = this.fusigaya.images.filter(img => img.url).length;
          const resolutions = this.fusigaya.images.filter(img => img.fileInfo && img.fileInfo.width).map(img => `${img.fileInfo.width}x${img.fileInfo.height}`);
          const resolutionText = resolutions.length > 0 ? ` (${resolutions.join(', ')})` : '';
          this.showNotification(`Fusigaya berhasil! Diproses ${imageCount} gambar${resolutionText}.`, 'success');
        } else if (res.ok && data.image_url) {
          this.resultUrl = data.image_url;
          const imageCount = this.fusigaya.images.filter(img => img.url).length;
          const resolutions = this.fusigaya.images.filter(img => img.fileInfo && img.fileInfo.width).map(img => `${img.fileInfo.width}x${img.fileInfo.height}`);
          const resolutionText = resolutions.length > 0 ? ` (${resolutions.join(', ')})` : '';
          this.showNotification(`Fusigaya berhasil! Diproses ${imageCount} gambar${resolutionText}.`, 'success');
          // Refresh contoh gambar setelah berhasil generate
          setTimeout(() => {
            loadExampleImagesFromDatabase();
          }, 1000);
        } else {
          this.errorMsg = data.error || 'Gagal generate fusigaya.';
          this.showNotification(this.errorMsg, 'danger');
          console.error('Fusigaya error:', data);
        }
      } catch (e) {
        this.errorMsg = 'Terjadi kesalahan koneksi.';
        this.showNotification(this.errorMsg, 'danger');
        console.error('Connection error:', e);
      }
      this.loading = false;
    },
    
    async submitMiniatur() {
      // Validasi input
      if (!this.miniatur.prompt.trim()) {
        this.errorMsg = 'Instruksi edit wajib diisi.';
        this.showNotification(this.errorMsg, 'warning');
        return;
      }
      
      if (!this.miniatur.imageUrl || !this.miniatur.imageUrl.trim()) {
        this.errorMsg = 'Gambar wajib diupload atau URL gambar harus diisi.';
        this.showNotification(this.errorMsg, 'warning');
        return;
      }
      
      console.log('Submitting miniatur with:', {
        prompt: this.miniatur.prompt,
        imageUrl: this.miniatur.imageUrl
      });
      
      this.loading = true;
      this.resultUrl = '';
      this.errorMsg = '';
      
      try {
        const res = await fetch('/generate-miniatur', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            prompt: this.miniatur.prompt,
            image_url: this.miniatur.imageUrl
          })
        });
        
        const data = await res.json();
        
        if (res.ok && data.success && data.result_url) {
          this.resultUrl = data.result_url;
          this.showNotification('Edit gambar berhasil diproses!', 'success');
          
          // Refresh contoh gambar setelah berhasil generate
          setTimeout(() => {
            loadExampleImagesFromDatabase();
          }, 1000);
        } else {
          this.errorMsg = data.error || 'Gagal memproses edit gambar.';
          this.showNotification(this.errorMsg, 'danger');
          console.error('Miniatur error:', data);
        }
      } catch (e) {
        this.errorMsg = 'Terjadi kesalahan koneksi.';
        this.showNotification(this.errorMsg, 'danger');
        console.error('Connection error:', e);
      }
      
      this.loading = false;
    },
    
    
    async generateMiniaturPrompt() {
      if (!this.miniatur.imagePreview) {
        this.showNotification('Upload gambar terlebih dahulu untuk generate instruksi.', 'warning');
        return;
      }
      
      this.miniatur.isGeneratingPrompt = true;
      
      try {
        const res = await fetch('/api/generate-miniatur-prompt', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            image_url: this.miniatur.imageUrl
          })
        });
        
        const data = await res.json();
        
        if (res.ok && data.prompt) {
          this.miniatur.prompt = data.prompt;
          this.showNotification('Instruksi edit berhasil digenerate!', 'success');
        } else {
          this.showNotification(data.error || 'Gagal generate instruksi.', 'danger');
        }
      } catch (error) {
        console.error('Generate prompt error:', error);
        this.showNotification('Terjadi kesalahan saat generate instruksi.', 'danger');
      }
      
      this.miniatur.isGeneratingPrompt = false;
    },
    
    async generateMiniaturDirect() {
      if (!this.miniatur.imagePreview) {
        this.showNotification('Upload gambar terlebih dahulu.', 'warning');
        return;
      }
      
      // Generate prompt otomatis terlebih dahulu
      this.miniatur.isGeneratingPrompt = true;
      
      try {
        const promptRes = await fetch('/api/generate-miniatur-prompt', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            image_url: this.miniatur.imageUrl
          })
        });
        
        const promptData = await promptRes.json();
        
        if (promptRes.ok && promptData.prompt) {
          this.miniatur.prompt = promptData.prompt;
          this.miniatur.isGeneratingPrompt = false;
          
          // Langsung submit
          this.showNotification('Memulai generate miniatur dengan instruksi otomatis...', 'info');
          await this.submitMiniatur();
        } else {
          this.miniatur.isGeneratingPrompt = false;
          this.showNotification(promptData.error || 'Gagal generate instruksi otomatis.', 'danger');
        }
      } catch (error) {
        this.miniatur.isGeneratingPrompt = false;
        console.error('Generate direct error:', error);
        this.showNotification('Terjadi kesalahan saat generate otomatis.', 'danger');
      }
    },
    
    handleMiniaturFile(e) {
      const file = e.target.files[0];
      if (file) {
        // Validasi ukuran file (max 10MB)
        if (file.size > 10 * 1024 * 1024) {
          const fileSize = (file.size / 1024 / 1024).toFixed(2);
          this.showNotification(`File ${file.name} terlalu besar (${fileSize} MB). Maksimal 10MB.`, 'warning');
          e.target.value = '';
          return;
        }
        
        // Validasi tipe file
        if (!file.type.startsWith('image/')) {
          this.showNotification(`File ${file.name} harus berupa gambar.`, 'warning');
          e.target.value = '';
          return;
        }
        
        // Tampilkan preview file lokal terlebih dahulu
        const reader = new FileReader();
        reader.onload = (event) => {
          this.miniatur.imagePreview = event.target.result;
        };
        reader.readAsDataURL(file);
        
        // Upload file ke server
        this.uploadMiniaturFile(file);
      }
    },
    
    handleMiniaturFileDrop(e) {
      e.preventDefault();
      this.miniatur.dragover = false;
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        const file = files[0];
        const fakeEvent = { target: { files: [file] } };
        this.handleMiniaturFile(fakeEvent);
      }
    },
    
    removeMiniaturImage() {
      this.miniatur.imagePreview = '';
      this.miniatur.imageUrl = '';
      this.miniatur.uploadProgress = 0;
      this.showNotification('Gambar berhasil dihapus.', 'info');
    },
    
    loadMiniaturImageFromUrl() {
      if (this.miniatur.imageUrl && this.miniatur.imageUrl.trim()) {
        // Validasi URL format
        try {
          new URL(this.miniatur.imageUrl);
          this.miniatur.imagePreview = this.miniatur.imageUrl;
          this.showNotification('URL gambar berhasil dimuat.', 'success');
        } catch (e) {
          this.showNotification('Format URL tidak valid. Contoh: https://example.com/image.jpg', 'warning');
        }
      } else {
        this.miniatur.imagePreview = '';
      }
    },
    
    openMiniaturGallery() {
      this.showGallery = 'miniatur';
      this.showNotification('Fitur galeri akan segera tersedia.', 'info');
    },
    
    async uploadMiniaturFile(file) {
      const formData = new FormData();
      formData.append('file', file);
      
      try {
        this.miniatur.uploadProgress = 0;
        this.showNotification('Mengupload file...', 'info');
        
        const res = await fetch('/upload_image_to_miniatur', {
          method: 'POST',
          body: formData
        });
        
        if (res.ok) {
          const data = await res.json();
          if (data.url) {
            this.miniatur.imageUrl = data.url;
            this.miniatur.uploadProgress = 100;
            this.showNotification(`File ${file.name} berhasil diupload.`, 'success');
          } else {
            this.showNotification(data.error || 'Gagal upload file.', 'danger');
            this.removeMiniaturImage();
          }
        } else {
          // Jika server error, coba parse error message
          try {
            const errorData = await res.json();
            this.showNotification(errorData.error || `Error ${res.status}: Gagal upload file.`, 'danger');
          } catch {
            this.showNotification(`Error ${res.status}: Gagal upload file.`, 'danger');
          }
          this.removeMiniaturImage();
        }
      } catch (error) {
        console.error('Upload error:', error);
        this.showNotification('Terjadi kesalahan koneksi saat upload file.', 'danger');
        this.removeMiniaturImage();
      }
    },
    
    handleFaceSwapImageFile(e, type) {
      const file = e.target.files[0];
      if (file) {
        // Validasi ukuran file (max 10MB)
        if (file.size > 10 * 1024 * 1024) {
          const fileSize = (file.size / 1024 / 1024).toFixed(2);
          this.showNotification(`File ${file.name} terlalu besar (${fileSize} MB). Maksimal 10MB.`, 'warning');
          e.target.value = '';
          return;
        }
        // Validasi tipe file
        if (!file.type.startsWith('image/')) {
          this.showNotification(`File ${file.name} harus berupa gambar.`, 'warning');
          e.target.value = '';
          return;
        }
        
        // Tampilkan preview file lokal terlebih dahulu
        const reader = new FileReader();
        reader.onload = (event) => {
          if (type === 'image') {
            this.faceSwap.imagePreview = event.target.result;
          } else {
            this.faceSwap.faceImagePreview = event.target.result;
          }
          
          // Simpan informasi file untuk feedback
          const fileInfo = {
            name: file.name,
            size: (file.size / 1024 / 1024).toFixed(2),
            type: file.type,
            width: 0,
            height: 0
          };
          
          // Dapatkan resolusi gambar
          const img = new Image();
          img.onload = () => {
            fileInfo.width = img.width;
            fileInfo.height = img.height;
            const sizeText = parseFloat(fileInfo.size) > 1 ? `${fileInfo.size} MB` : `${(parseFloat(fileInfo.size) * 1024).toFixed(0)} KB`;
            const fileType = fileInfo.type.split('/')[1]?.toUpperCase() || 'IMAGE';
            const resolution = `${fileInfo.width}x${fileInfo.height}`;
            this.showNotification(`File ${fileInfo.name} (${sizeText}, ${fileType}, ${resolution}) siap diupload.`, 'info');
          };
          img.src = event.target.result;
        };
        reader.readAsDataURL(file);
        
        // Upload file ke server
        const formData = new FormData();
        formData.append('file', file);
        
        // Set progress untuk upload
        if (type === 'image') {
          this.faceSwap.imageUploadProgress = 0;
        } else {
          this.faceSwap.faceUploadProgress = 0;
        }
        
        // Simulasi progress bar untuk upload
        const progressInterval = setInterval(() => {
          if (type === 'image') {
            if (this.faceSwap.imageUploadProgress < 90) {
              this.faceSwap.imageUploadProgress += Math.random() * 15;
            }
          } else {
            if (this.faceSwap.faceUploadProgress < 90) {
              this.faceSwap.faceUploadProgress += Math.random() * 15;
            }
          }
        }, 200);
        
        fetch('/upload_image_to_face_swap', { 
          method: 'POST', 
          body: formData 
        })
        .then(res => {
          if (!res.ok) {
            throw new Error(`HTTP ${res.status}: ${res.statusText}`);
          }
          return res.json();
        })
        .then(data => {
          if (data.url) {
            if (type === 'image') {
              this.faceSwap.image = data.url;
            } else {
              this.faceSwap.faceImage = data.url;
            }
            console.log('File uploaded successfully:', data.url);
            const fileSize = (file.size / 1024 / 1024).toFixed(2);
            const sizeText = parseFloat(fileSize) > 1 ? `${fileSize} MB` : `${(parseFloat(fileSize) * 1024).toFixed(0)} KB`;
            const fileType = file.type.split('/')[1]?.toUpperCase() || 'IMAGE';
            this.showNotification(`File ${file.name} (${sizeText}, ${fileType}) berhasil diupload!`, 'success');
            
            // Set progress ke 100% dan clear interval
            if (type === 'image') {
              this.faceSwap.imageUploadProgress = 100;
            } else {
              this.faceSwap.faceUploadProgress = 100;
            }
            clearInterval(progressInterval);
          } else {
            throw new Error(data.error || 'Upload gagal');
          }
          e.target.value = '';
        })
        .catch(error => {
          console.error('Error uploading file:', error);
          e.target.value = '';
          // Clear progress dan clear preview jika upload gagal
          if (type === 'image') {
            this.faceSwap.imagePreview = '';
            this.faceSwap.imageUploadProgress = 0;
          } else {
            this.faceSwap.faceImagePreview = '';
            this.faceSwap.faceUploadProgress = 0;
          }
          clearInterval(progressInterval);
          this.showNotification(`Gagal upload file ${file.name}. ${error.message}`, 'danger');
        });
      }
    },
    clearFaceSwapInput(type) {
      if (type === 'image') {
        this.faceSwap.image = '';
        this.faceSwap.imagePreview = '';
        this.faceSwap.imageUploadProgress = 0;
        this.faceSwap.imageDragover = false;
      } else {
        this.faceSwap.faceImage = '';
        this.faceSwap.faceImagePreview = '';
        this.faceSwap.faceUploadProgress = 0;
        this.faceSwap.faceDragover = false;
      }
      this.showNotification('Input berhasil dibersihkan.', 'info');
    },
    
    handleFaceSwapUrl(e, type) {
      const url = e.target.value.trim();
      if (type === 'image') {
        this.faceSwap.image = url;
        this.faceSwap.imagePreview = '';
      } else {
        this.faceSwap.faceImage = url;
        this.faceSwap.faceImagePreview = '';
      }
      
      if (url) {
        // Validasi URL
        try {
          new URL(url);
          // Test load image
          const img = new Image();
          const timeout = setTimeout(() => {
            img.src = '';
            this.showNotification(`URL gambar ${type === 'image' ? 'utama' : 'wajah'} tidak dapat diakses.`, 'warning');
          }, 10000);
          
          img.onload = () => {
            clearTimeout(timeout);
            if (type === 'image') {
              this.faceSwap.imagePreview = url;
            } else {
              this.faceSwap.faceImagePreview = url;
            }
            const resolution = `${img.width}x${img.height}`;
            this.showNotification(`URL gambar ${type === 'image' ? 'utama' : 'wajah'} valid (${resolution})`, 'success');
          };
          
          img.onerror = () => {
            clearTimeout(timeout);
            this.showNotification(`URL gambar ${type === 'image' ? 'utama' : 'wajah'} tidak valid.`, 'warning');
          };
          
          img.src = url;
        } catch (e) {
          this.showNotification(`Format URL tidak valid untuk gambar ${type === 'image' ? 'utama' : 'wajah'}.`, 'warning');
        }
      }
    },
    async submitFaceSwap() {
      // Validasi input yang lebih detail
      if (!this.faceSwap.image.trim()) {
        this.errorMsg = 'Gambar utama wajib diisi.';
        this.showNotification(this.errorMsg, 'warning');
        return;
      }
      if (!this.faceSwap.faceImage.trim()) {
        this.errorMsg = 'Gambar wajah wajib diisi.';
        this.showNotification(this.errorMsg, 'warning');
        return;
      }
      
      // Validasi format data
      const isImageDataUrl = this.faceSwap.image.startsWith('data:');
      const isFaceImageDataUrl = this.faceSwap.faceImage.startsWith('data:');
      const isImageUrl = this.faceSwap.image.startsWith('http');
      const isFaceImageUrl = this.faceSwap.faceImage.startsWith('http');
      
      if (!isImageDataUrl && !isImageUrl) {
        this.errorMsg = 'Format gambar utama tidak valid. Gunakan URL atau upload file.';
        this.showNotification(this.errorMsg, 'warning');
        return;
      }
      
      if (!isFaceImageDataUrl && !isFaceImageUrl) {
        this.errorMsg = 'Format gambar wajah tidak valid. Gunakan URL atau upload file.';
        this.showNotification(this.errorMsg, 'warning');
        return;
      }
      
      const payload = {
        image: this.faceSwap.image,
        face_image: this.faceSwap.faceImage,
        target_index: parseInt(this.faceSwap.targetIndex) || 0,
        output_format: this.faceSwap.outputFormat,
        enable_base64_output: this.faceSwap.enableBase64Output,
        enable_safety_checker: this.faceSwap.enableSafetyChecker,
        enable_sync_mode: this.faceSwap.enableSyncMode
      };
      
      console.log('Submitting face swap with payload:', {
        ...payload,
        image_length: payload.image.length,
        face_image_length: payload.face_image.length
      });
      
      this.loading = true;
      this.resultUrl = '';
      this.errorMsg = '';
      
      try {
        const res = await fetch('/api/face_swap', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        
        const data = await res.json();
        console.log('Face swap response:', data);
        
        if (res.ok && data.success && data.output_url) {
          this.resultUrl = data.output_url;
          const elapsed = data.elapsed ? ` (${data.elapsed.toFixed(1)}s)` : '';
          this.showNotification(`Face swap berhasil!${elapsed}`, 'success');
          // Refresh contoh gambar setelah berhasil generate
          setTimeout(() => {
            loadExampleImagesFromDatabase();
          }, 1000);
        } else if (res.ok && data.success && data.result_url) {
          this.resultUrl = data.result_url;
          const elapsed = data.elapsed ? ` (${data.elapsed.toFixed(1)}s)` : '';
          this.showNotification(`Face swap berhasil!${elapsed}`, 'success');
          // Refresh contoh gambar setelah berhasil generate
          setTimeout(() => {
            loadExampleImagesFromDatabase();
          }, 1000);
        } else {
          this.errorMsg = data.error || 'Gagal generate face swap.';
          this.showNotification(this.errorMsg, 'danger');
          console.error('Face swap error:', data);
        }
      } catch (e) {
        this.errorMsg = 'Terjadi kesalahan koneksi. Silakan coba lagi.';
        this.showNotification(this.errorMsg, 'danger');
        console.error('Connection error:', e);
      }
      this.loading = false;
    },
    downloadResult(url, filename) {
      fetch(url)
        .then(resp => resp.blob())
        .then(blob => {
          const link = document.createElement('a');
          link.href = window.URL.createObjectURL(blob);
          link.download = filename || 'download';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          const urlParts = url.split('/');
          const fileName = urlParts[urlParts.length - 1] || filename || 'hasil-ai.jpg';
          const fileSize = (blob.size / 1024 / 1024).toFixed(2);
          const sizeText = parseFloat(fileSize) > 1 ? `${fileSize} MB` : `${(parseFloat(fileSize) * 1024).toFixed(0)} KB`;
          this.showNotification(`Download berhasil: ${fileName} (${sizeText})`, 'success');
        })
        .catch(error => {
          console.error('Download error:', error);
          const urlParts = url.split('/');
          const fileName = urlParts[urlParts.length - 1] || filename || 'hasil-ai.jpg';
          this.showNotification(`Gagal download file ${fileName}.`, 'danger');
        });
    },
    showImagePreview(url) {
      if (!url) {
        console.warn('showImagePreview called with empty URL');
        return;
      }
      
      // Set state untuk menampilkan preview modal
      this.imagePreviewModal = {
        show: true,
        url: url,
        source: url.startsWith('data:') ? 'File lokal' : url.substring(0, 50) + (url.length > 50 ? '...' : '')
      };
      this.imageZoomed = false; // Reset zoom state
      
      // Log untuk debugging
      console.log('Image preview opened:', url);
    },
    
    toggleImageZoom(event) {
      this.imageZoomed = !this.imageZoomed;
      event.stopPropagation();
    },
    
    closeImagePreview() {
      this.imagePreviewModal.show = false;
      this.imageZoomed = false;
      console.log('Image preview closed');
    },
    
    handleKeydown(event) {
      if (event.key === 'Escape' && this.imagePreviewModal.show) {
        this.closeImagePreview();
      }
    },
    async initTooltips() {
      // Inisialisasi tooltip Bootstrap
      const tooltipTriggerList = [].slice.call(document.querySelectorAll('[title]'));
      tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });
    },
    async init() {
      console.log('Alpine.js init started');
      
      // Fetch gallery images on init
      try {
        const res1 = await fetch('/api/gallery_images');
        const data1 = await res1.json();
        if (data1.success) this.galleryImages = data1.images;
      } catch (e) {
        console.error('Error loading gallery images:', e);
        this.showNotification('Warning: Gagal memuat galeri gambar', 'warning');
      }
      
      try {
        const res2 = await fetch('/api/gallery_generated_images');
        const data2 = await res2.json();
        if (data2.success) this.galleryGenerated = data2.images;
      } catch (e) {
        console.error('Error loading gallery generated images:', e);
        this.showNotification('Warning: Gagal memuat galeri gambar hasil generate', 'warning');
      }
      
      // Add global event listener for ESC key
      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && this.imagePreviewModal.show) {
          this.closeImagePreview();
        }
      });
      
      // Initialize example images after Alpine.js is ready
      setTimeout(() => {
        try {
          loadExampleImagesFromDatabase();
        } catch (e) {
          console.error('Error initializing example images:', e);
          this.showNotification('Warning: Gagal memuat contoh gambar', 'warning');
        }
      }, 500);
      
      console.log('Alpine.js init completed');
    },
    useExamplePrompt(prompt) {
      if (!prompt || typeof prompt !== 'string') {
        console.error('useExamplePrompt called with invalid prompt:', prompt);
        return;
      }
      this.photo.prompt = prompt;
      this.showNotification('Prompt contoh telah diterapkan! Silakan klik Generate Gambar.', 'success');
      // Scroll ke form
      const textarea = document.querySelector('textarea[x-model="photo.prompt"]');
      if (textarea) {
        textarea.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    },

    showNotification(message, type = 'info') {
      // Buat notifikasi toast
      const toast = document.createElement('div');
      toast.className = `toast align-items-center text-white bg-${type} border-0`;
      toast.setAttribute('role', 'alert');
      toast.innerHTML = `
        <div class="d-flex">
          <div class="toast-body">
            ${message}
          </div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
      `;
      // Tambahkan ke container toast
      let toastContainer = document.querySelector('.toast-container');
      if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
        toastContainer.style.zIndex = '9999';
        document.body.appendChild(toastContainer);
      }
      toastContainer.appendChild(toast);
      const bsToast = new bootstrap.Toast(toast);
      bsToast.show();
      // Hapus toast setelah ditampilkan
      toast.addEventListener('hidden.bs.toast', () => {
        toastContainer.removeChild(toast);
      });
    },
    
    // Fungsi untuk membersihkan event listener saat tab berubah
    cleanupEventListeners() {
      console.log('Cleaning up event listeners for tab change...');
      if (window.exampleImageClickHandler) {
        document.removeEventListener('click', window.exampleImageClickHandler);
        window.exampleImageClickHandler = null;
        console.log('Event listeners cleaned up');
      }
    },
    
    // Get tab background style based on screen size
    getTabBackgroundStyle() {
      const isMobile = window.innerWidth <= 768;
      if (isMobile) {
        const tabIndex = ['generate', 'fusigaya', 'faceswap'].indexOf(this.tab);
        return {
          transform: `translateY(${tabIndex * 100}%)`
        };
      } else {
        const tabIndex = ['generate', 'fusigaya', 'faceswap'].indexOf(this.tab);
        return {
          transform: `translateX(${tabIndex * 100}%)`
        };
      }
    },
    
    // Modern tab switching with smooth animations
    switchTab(newTab) {
      if (this.tab === newTab) return;
      
      // Add loading state for smooth transition
      this.loading = true;
      
      // Clear previous states
      this.errorMsg = '';
      this.resultUrl = '';
      
      // Switch tab with delay for smooth animation
      setTimeout(() => {
        this.tab = newTab;
        this.loading = false;
        
        // Show appropriate notifications based on tab
        if (newTab === 'generate') {
          if (!this.photoModelIntroShown) {
            this.showNotification(' Fitur Baru: Pilihan Model Generate Image! Sekarang Anda bisa memilih antara Imagen4 Ultra dan GPT Image 1 untuk hasil yang optimal.', 'success');
            this.photoModelIntroShown = true;
          } else {
            this.showNotification('Mode Generate Gambar aktif - Pilih model yang sesuai dengan kebutuhan Anda!', 'info');
          }
        } else if (newTab === 'fusigaya') {
          if (!this.fusigayaModelIntroShown) {
            this.showNotification(' Fitur Baru: Pilihan Model Fusigaya! Sekarang Anda bisa memilih antara FLUX.1 Kontext (Dev/Pro) dan Nano Banana untuk hasil yang lebih optimal.', 'success');
            this.fusigayaModelIntroShown = true;
          } else {
            this.showNotification('Mode Fusigaya aktif - Pilih model yang sesuai dengan kebutuhan Anda!', 'info');
          }
        } else if (newTab === 'faceswap') {
          this.showNotification('Mode Face Swap aktif - Siap untuk menukar wajah', 'info');
        }
        
        // Initialize tooltips for new tab
        this.$nextTick(() => this.initTooltips());
      }, 200);
    }
  }
}

// Fungsi JavaScript untuk contoh gambar (tidak menggunakan Alpine.js)
function showExampleImages() {
  const section = document.getElementById('example-images-section');
  if (section) {
    section.style.display = 'block';
  }
}

function hideExampleImages() {
  const section = document.getElementById('example-images-section');
  if (section) {
    section.style.display = 'none';
  }
}

function toggleShowAllExamples() {
  // Fungsi untuk toggle show all examples
  console.log('Toggle show all examples clicked');
}

function useExamplePrompt(prompt) {
  if (!prompt || typeof prompt !== 'string') {
    console.error('useExamplePrompt called with invalid prompt:', prompt);
    return;
  }
  
  // Cari textarea untuk prompt
  const textarea = document.querySelector('textarea[x-model="photo.prompt"]');
  if (textarea) {
    textarea.value = prompt;
    // Trigger Alpine.js update jika ada
    if (textarea.dispatchEvent) {
      textarea.dispatchEvent(new Event('input', { bubbles: true }));
    }
  }
  
  // Tampilkan notifikasi
  showNotification('Prompt contoh telah diterapkan! Silakan klik Generate Gambar.', 'success');
  
  // Scroll ke form
  if (textarea) {
    textarea.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
}



// Tampilkan contoh gambar saat halaman dimuat
document.addEventListener('DOMContentLoaded', function() {
  // Pastikan section contoh hasil langsung terlihat
  const section = document.getElementById('example-images-section');
  if (section) {
    section.style.display = 'block';
  }
  
  // Tambahkan event listener untuk gambar hasil
  addExampleImageEventListeners();
  
  // Tambahkan event listener untuk modal yang ditutup
  const modalElement = document.getElementById('exampleDetailModal');
  if (modalElement) {
    modalElement.addEventListener('hidden.bs.modal', function() {
      console.log('Modal hidden event triggered, re-registering listeners...');
      setTimeout(() => {
        addExampleImageEventListeners();
      }, 100);
    });
    
    // Tambahkan event listener untuk modal yang ditutup dengan cara lain
    modalElement.addEventListener('click', function(event) {
      if (event.target === modalElement) {
        console.log('Modal backdrop clicked, modal will close');
        // Event listener akan di-re-register oleh hidden.bs.modal event
      }
    });
  }
  
  // Ambil data dari database dan tampilkan contoh gambar
  loadExampleImagesFromDatabase();
});

// Fungsi untuk menambahkan event listener ke gambar hasil
function addExampleImageEventListeners() {
  console.log('Adding example image event listeners...');
  
  // Hapus event listener lama jika ada
  if (window.exampleImageClickHandler) {
    document.removeEventListener('click', window.exampleImageClickHandler);
    console.log('Removed old event listener');
  }
  
  // Buat handler function yang bisa di-remove
  window.exampleImageClickHandler = function(event) {
    const exampleCard = event.target.closest('.example-card');
    if (exampleCard) {
      event.preventDefault();
      event.stopPropagation();
      
      console.log('Example card clicked!');
      console.log('Event target:', event.target);
      console.log('Closest example-card:', exampleCard);
      
      const title = exampleCard.getAttribute('data-title');
      const prompt = exampleCard.getAttribute('data-prompt');
      const imageUrl = exampleCard.getAttribute('data-image');
      
      console.log('Card data:', { title, prompt, imageUrl });
      
      if (title && prompt && imageUrl) {
        console.log('Example card clicked:', { title, prompt, imageUrl });
        showExampleDetail(title, prompt, imageUrl);
      } else {
        console.error('Missing data attributes on example card');
        console.log('Available attributes:', exampleCard.attributes);
        
        // Fallback: coba ambil dari text content jika data attributes kosong
        const titleText = exampleCard.querySelector('.fw-semibold')?.textContent || 'Unknown Title';
        const promptText = exampleCard.querySelector('.text-muted')?.textContent || 'No description available';
        const imgElement = exampleCard.querySelector('img');
        const imgSrc = imgElement ? imgElement.src : '';
        
        if (imgSrc) {
          console.log('Using fallback data:', { titleText, promptText, imgSrc });
          showExampleDetail(titleText, promptText, imgSrc);
        } else {
          showNotification('Error: Data gambar tidak lengkap', 'danger');
        }
      }
    } else {
      console.log('Click event on non-example-card element:', event.target);
    }
  };
  
  // Tambahkan event listener baru
  document.addEventListener('click', window.exampleImageClickHandler);
  
  // Verifikasi bahwa event listener sudah ter-register
  const exampleCards = document.querySelectorAll('.example-card');
  console.log(`Event listeners added successfully. Found ${exampleCards.length} example cards.`);
  
  // Log semua example cards untuk debugging
  exampleCards.forEach((card, index) => {
    const title = card.getAttribute('data-title');
    const prompt = card.getAttribute('data-prompt');
    const imageUrl = card.getAttribute('data-image');
    console.log(`Card ${index + 1}:`, { title, prompt, imageUrl });
  });
}

// Fungsi untuk menampilkan contoh gambar statis
function showExampleImages() {
  const section = document.getElementById('example-images-section');
  if (section) {
    section.style.display = 'block';
    console.log('Static example images displayed');
  }
}

// Fungsi untuk mengambil contoh gambar dari database
async function loadExampleImagesFromDatabase() {
  try {
    console.log('Loading example images from database...');
    const response = await fetch('/api/example_images');
    const data = await response.json();
    
    if (data.success && data.images && data.images.length > 0) {
      console.log('Example images loaded from database:', data.images.length);
      displayExampleImagesFromDatabase(data.images, data.source);
    } else {
      console.log('No images from database, showing fallback images');
      showExampleImages(); // Tampilkan gambar statis sebagai fallback
    }
  } catch (error) {
    console.error('Error loading example images from database:', error);
    showExampleImages(); // Tampilkan gambar statis sebagai fallback
  }
}

// Fungsi untuk menampilkan contoh gambar dari database
function displayExampleImagesFromDatabase(images, source) {
  const section = document.getElementById('example-images-section');
  if (!section) return;
  
  // Ambil 10 gambar dari database
  const databaseImages = images.slice(0, 10);
  
  // Buat HTML untuk gambar dari database
  let imagesHTML = '';
  databaseImages.forEach((img, index) => {
    // Buat judul singkat dari caption
    const shortTitle = img.caption.split(' ').slice(0, 3).join(' ') + '...';
    const shortDesc = img.caption.split(' ').slice(3, 6).join(' ') + '...';
    
    // Escape special characters untuk data attributes
    const safeTitle = shortTitle.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
    const safePrompt = img.caption.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
    const safeUrl = img.url.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
    
    imagesHTML += `
      <div class="col-md-4 col-6 col-lg-3">
        <div class="example-card rounded-3 overflow-hidden" 
             style="border: 2px solid #a855f7; background: rgba(168,85,247,0.1); cursor: pointer;" 
             data-title="${safeTitle}" 
             data-prompt="${safePrompt}" 
             data-image="${safeUrl}">
          <div class="example-card-image-container position-relative">
            <img src="${img.url}" 
                 class="w-100" style="height: 150px; object-fit: cover;" 
                 alt="${shortTitle}">
            <div class="example-card-overlay">
              <button class="btn btn-sm btn-light rounded-circle download-example-btn" onclick="event.stopPropagation(); downloadExampleImage('${img.url}', '${shortTitle.replace(/'/g, "\\'")}')">
                <i class="bi bi-download"></i>
              </button>
            </div>
          </div>
          <div class="p-2">
            <small class="text-muted fw-semibold" style="font-size: 0.9rem; line-height: 1.3;">${shortTitle}</small>
            <small class="text-muted d-block" style="font-size: 0.75rem; line-height: 1.2;">${shortDesc}</small>
          </div>
        </div>
      </div>
    `;
  });
  
  // Tambah 2 gambar baru untuk mencapai total 12
  imagesHTML += `
    <!-- Gambar 11: Nature Scene -->
    <div class="col-md-4 col-6 col-lg-3">
      <div class="example-card rounded-3 overflow-hidden" 
           style="border: 2px solid #a855f7; background: rgba(168,85,247,0.1); cursor: pointer;" 
           data-title="Nature Scene" 
           data-prompt="Beautiful landscape with mountains, forest, and flowing river. Natural lighting, high resolution, realistic photography style." 
           data-image="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=400&fit=crop">
        <div class="example-card-image-container position-relative">
          <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=400&fit=crop" 
               class="w-100" style="height: 150px; object-fit: cover;" 
               alt="Nature Scene">
          <div class="example-card-overlay">
            <button class="btn btn-sm btn-light rounded-circle download-example-btn" onclick="event.stopPropagation(); downloadExampleImage('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=400&fit=crop', 'Nature Scene')">
              <i class="bi bi-download"></i>
            </button>
          </div>
        </div>
        <div class="p-2">
          <small class="text-muted fw-semibold" style="font-size: 0.9rem; line-height: 1.3;">Nature Scene</small>
          <small class="text-muted d-block" style="font-size: 0.75rem; line-height: 1.2;">Mountains, forest, river</small>
        </div>
      </div>
    </div>
    
    <!-- Gambar 12: City Life -->
    <div class="col-md-4 col-6 col-lg-3">
      <div class="example-card rounded-3 overflow-hidden" 
           style="border: 2px solid #a855f7; background: rgba(168,85,247,0.1); cursor: pointer;" 
           data-title="City Life" 
           data-prompt="Modern cityscape with skyscrapers, busy streets, and urban architecture. Night time, neon lights, cinematic atmosphere." 
           data-image="https://images.unsplash.com/photo-1449824913935-59a10b8d2000?w=400&h=400&fit=crop">
        <div class="example-card-image-container position-relative">
          <img src="https://images.unsplash.com/photo-1449824913935-59a10b8d2000?w=400&h=400&fit=crop" 
               class="w-100" style="height: 150px; object-fit: cover;" 
               alt="City Life">
          <div class="example-card-overlay">
            <button class="btn btn-sm btn-light rounded-circle download-example-btn" onclick="event.stopPropagation(); downloadExampleImage('https://images.unsplash.com/photo-1449824913935-59a10b8d2000?w=400&h=400&fit=crop', 'City Life')">
              <i class="bi bi-download"></i>
            </button>
          </div>
        </div>
        <div class="p-2">
          <small class="text-muted fw-semibold" style="font-size: 0.9rem; line-height: 1.3;">City Life</small>
          <small class="text-muted d-block" style="font-size: 0.75rem; line-height: 1.2;">Skyscrapers, neon lights</small>
        </div>
      </div>
    </div>
  `;
  
  // Update informasi sumber
  let sourceText = '';
  if (source === 'user_history') {
    sourceText = '<i class="bi bi-person-check me-1"></i>Menampilkan 12 hasil terbaru Anda (10 dari database + 2 tambahan)';
  } else if (source === 'random_samples') {
    sourceText = '<i class="bi bi-stars me-1"></i>Menampilkan 12 contoh terbaik (10 dari komunitas + 2 tambahan)';
  } else {
    sourceText = '<i class="bi bi-images me-1"></i>Menampilkan 12 contoh gambar untuk inspirasi (10 dari database + 2 tambahan)';
  }
  
  // Update konten section
  const rowDiv = section.querySelector('.row.g-3');
  const sourceDiv = section.querySelector('.mt-3.text-center small');
  
  if (rowDiv) {
    rowDiv.innerHTML = imagesHTML;
    console.log('Example images HTML updated successfully');
    
    // Tambahkan event listener setelah HTML di-update
    setTimeout(() => {
      addExampleImageEventListeners();
      // Verifikasi event listener berfungsi
      verifyEventListeners();
    }, 200);
  } else {
    console.error('Row element not found in example section');
  }
  
  if (sourceDiv) {
    sourceDiv.innerHTML = sourceText;
  }
  
  // Tampilkan section
  section.style.display = 'block';
}

// === FUNCTIONS FOR EXAMPLE DETAIL MODAL ===

// Fungsi untuk menampilkan detail contoh gambar
function showExampleDetail(title, prompt, imageUrl) {
  try {
    console.log('showExampleDetail called with:', { title, prompt, imageUrl });
    
    // Set konten modal
    const modalLabel = document.getElementById('exampleDetailModalLabel');
    const modalTitle = document.getElementById('exampleDetailTitle');
    const modalImage = document.getElementById('exampleDetailImage');
    const modalPrompt = document.getElementById('exampleDetailPrompt');
    
    if (!modalLabel || !modalTitle || !modalImage || !modalPrompt) {
      console.error('Modal elements not found');
      showNotification('Error: Modal elements not found', 'danger');
      return;
    }
    
    modalLabel.textContent = title;
    modalTitle.textContent = title;
    modalImage.src = imageUrl;
    modalPrompt.value = prompt;
    
    // Tampilkan modal
    const modalElement = document.getElementById('exampleDetailModal');
    if (modalElement) {
      try {
        const modal = new bootstrap.Modal(modalElement);
        
              // Tambahkan event listener untuk modal yang ditutup
      modalElement.addEventListener('hidden.bs.modal', function() {
        console.log('Modal closed, re-registering event listeners...');
        // Re-register event listeners setelah modal ditutup
        setTimeout(() => {
          addExampleImageEventListeners();
          verifyEventListeners();
        }, 200);
      }, { once: true }); // Gunakan once: true agar event listener hanya sekali
      
      // Tambahkan event listener untuk membersihkan saat halaman unload
      window.addEventListener('beforeunload', function() {
        if (window.exampleImageClickHandler) {
          document.removeEventListener('click', window.exampleImageClickHandler);
          window.exampleImageClickHandler = null;
        }
      });
        
        modal.show();
        console.log('Modal shown successfully');
      } catch (modalError) {
        console.error('Error showing modal:', modalError);
        // Fallback: tampilkan dalam alert jika modal gagal
        showExampleDetailFallback(title, prompt, imageUrl);
      }
    } else {
      console.error('Modal element not found');
      showNotification('Error: Modal not found', 'danger');
      // Fallback: tampilkan dalam alert
      showExampleDetailFallback(title, prompt, imageUrl);
    }
  } catch (error) {
    console.error('Error in showExampleDetail:', error);
    showNotification('Error: Gagal menampilkan detail gambar', 'danger');
  }
}

// Fungsi fallback jika modal tidak bisa dibuka
function showExampleDetailFallback(title, prompt, imageUrl) {
  console.log('Using fallback method for:', { title, prompt, imageUrl });
  
  // Tampilkan dalam alert sederhana sebagai fallback
  const message = `Judul: ${title}\n\nPrompt: ${prompt}\n\nURL Gambar: ${imageUrl}`;
  alert(message);
}

// Fungsi untuk re-register event listeners
function reRegisterEventListeners() {
  console.log('Re-registering event listeners...');
  
  // Hapus event listener lama terlebih dahulu
  if (window.exampleImageClickHandler) {
    document.removeEventListener('click', window.exampleImageClickHandler);
    window.exampleImageClickHandler = null;
    console.log('Old event listener removed');
  }
  
  setTimeout(() => {
    addExampleImageEventListeners();
    // Verifikasi bahwa event listener sudah ter-register
    verifyEventListeners();
  }, 200);
}

// Fungsi untuk verifikasi event listeners
function verifyEventListeners() {
  console.log('Verifying event listeners...');
  
  // Cek apakah ada gambar hasil
  const exampleCards = document.querySelectorAll('.example-card');
  console.log('Found example cards:', exampleCards.length);
  
  // Cek apakah event listener sudah ter-register
  if (window.exampleImageClickHandler) {
    console.log('Event listener handler exists:', !!window.exampleImageClickHandler);
  } else {
    console.log('Event listener handler missing');
  }
  
  // Test click pada gambar pertama (jika ada)
  if (exampleCards.length > 0) {
    console.log('First example card found, testing click functionality...');
    // Simulasi hover untuk memastikan styling berfungsi
    exampleCards[0].style.transform = 'translateY(-2px)';
    setTimeout(() => {
      exampleCards[0].style.transform = '';
    }, 200);
  }
}

// Fungsi untuk menggunakan prompt dari modal
function useExamplePromptFromModal() {
  const prompt = document.getElementById('exampleDetailPrompt').value;
  if (prompt) {
    // Set prompt ke input yang aktif
    if (document.getElementById('prompt-input')) {
      document.getElementById('prompt-input').value = prompt;
      // Trigger event untuk update preview jika ada
      const event = new Event('input', { bubbles: true });
      document.getElementById('prompt-input').dispatchEvent(event);
    }
    
    // Tutup modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('exampleDetailModal'));
    modal.hide();
    
    // Scroll ke input prompt
    document.getElementById('prompt-input')?.scrollIntoView({ behavior: 'smooth' });
    
    // Tampilkan notifikasi
    showNotification('Prompt berhasil disalin ke input!', 'success');
  }
}

// Fungsi untuk copy prompt ke clipboard
async function copyPromptToClipboard() {
  const prompt = document.getElementById('exampleDetailPrompt').value;
  try {
    await navigator.clipboard.writeText(prompt);
    showNotification('Prompt berhasil disalin ke clipboard!', 'success');
  } catch (err) {
    // Fallback untuk browser yang tidak support clipboard API
    const textArea = document.createElement('textarea');
    textArea.value = prompt;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    showNotification('Prompt berhasil disalin ke clipboard!', 'success');
  }
}

// Fungsi untuk download contoh gambar
function downloadExampleImage(imageUrl, filename) {
  // Buat nama file yang aman
  const safeFilename = filename.replace(/[^a-z0-9]/gi, '_').toLowerCase() + '.jpg';
  
  // Download gambar
  fetch(imageUrl)
    .then(resp => resp.blob())
    .then(blob => {
      const link = document.createElement('a');
      link.href = window.URL.createObjectURL(blob);
      link.download = safeFilename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      // Tampilkan notifikasi
      const fileSize = (blob.size / 1024 / 1024).toFixed(2);
      const sizeText = parseFloat(fileSize) > 1 ? `${fileSize} MB` : `${(parseFloat(fileSize) * 1024).toFixed(0)} KB`;
      showNotification(`Download berhasil: ${safeFilename} (${sizeText})`, 'success');
    })
    .catch(error => {
      console.error('Download error:', error);
      showNotification(`Gagal download file ${safeFilename}.`, 'danger');
    });
}

// === ENHANCED EXAMPLE CARD INTERACTIONS ===

// Fungsi untuk toggle show all examples (jika diperlukan)
function toggleShowAllExamples() {
  // Implementasi untuk menampilkan semua contoh jika diperlukan
  showNotification('Fitur "Lihat Semua" akan segera hadir!', 'info');
}

// === ENHANCED NOTIFICATION SYSTEM ===

// Fungsi untuk menampilkan notifikasi yang lebih baik
function showNotification(message, type = 'info') {
  const toast = document.createElement('div');
  toast.className = `toast align-items-center text-white bg-${type} border-0`;
  toast.setAttribute('role', 'alert');
  toast.setAttribute('aria-live', 'assertive');
  toast.setAttribute('aria-atomic', 'true');
  
  toast.innerHTML = `
    <div class="d-flex">
      <div class="toast-body">
        <i class="bi bi-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-triangle' : type === 'warning' ? 'exclamation-circle' : 'info-circle'} me-2"></i>
        ${message}
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  `;
  
  // Tambahkan ke container toast
  let toastContainer = document.querySelector('.toast-container');
  if (!toastContainer) {
    toastContainer = document.createElement('div');
    toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
    toastContainer.style.zIndex = '9999';
    document.body.appendChild(toastContainer);
  }
  
  toastContainer.appendChild(toast);
  const bsToast = new bootstrap.Toast(toast);
  bsToast.show();
  
  // Hapus toast setelah ditampilkan
  toast.addEventListener('hidden.bs.toast', () => {
    if (toastContainer && toastContainer.contains(toast)) {
      toastContainer.removeChild(toast);
    }
  });
}

// === ENHANCED ERROR HANDLING ===

// Global error handler untuk mencegah crash
window.addEventListener('error', function(event) {
  console.error('Global error caught:', event.error);
  
  // Tampilkan notifikasi user-friendly
  if (event.error && event.error.message) {
    if (event.error.message.includes('fetch')) {
      showNotification(' Gagal terhubung ke server. Silakan cek koneksi internet Anda.', 'error');
    } else if (event.error.message.includes('timeout')) {
      showNotification(' Request timeout. Silakan coba lagi.', 'warning');
    } else {
      showNotification(' Terjadi kesalahan. Silakan refresh halaman.', 'error');
    }
  }
  
  // Prevent default error handling
  event.preventDefault();
});

// Unhandled promise rejection handler
window.addEventListener('unhandledrejection', function(event) {
  console.error('Unhandled promise rejection:', event.reason);
  
  // Tampilkan notifikasi user-friendly
  if (event.reason && event.reason.message) {
    if (event.reason.message.includes('fetch')) {
      showNotification(' Gagal terhubung ke server. Silakan cek koneksi internet Anda.', 'error');
    } else if (event.reason.message.includes('timeout')) {
      showNotification(' Request timeout. Silakan coba lagi.', 'warning');
    } else {
      showNotification(' Terjadi kesalahan. Silakan refresh halaman.', 'error');
    }
  }
  
  // Prevent default error handling
  event.preventDefault();
});

// === PERFORMANCE OPTIMIZATION ===

// Debounce function untuk mencegah multiple rapid calls
function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

// Throttle function untuk membatasi frekuensi calls
function throttle(func, limit) {
  let inThrottle;
  return function() {
    const args = arguments;
    const context = this;
    if (!inThrottle) {
      func.apply(context, args);
      inThrottle = true;
      setTimeout(() => inThrottle = false, limit);
    }
  };
}

// Optimized event listener untuk example cards
const optimizedExampleCardClick = debounce(function(event) {
  const exampleCard = event.target.closest('.example-card');
  if (exampleCard) {
    event.preventDefault();
    event.stopPropagation();
    
    const title = exampleCard.getAttribute('data-title');
    const prompt = exampleCard.getAttribute('data-prompt');
    const imageUrl = exampleCard.getAttribute('data-image');
    
    if (title && prompt && imageUrl) {
      showExampleDetail(title, prompt, imageUrl);
    } else {
      // Fallback handling
      const titleText = exampleCard.querySelector('.fw-semibold')?.textContent || 'Unknown Title';
      const promptText = exampleCard.querySelector('.text-muted')?.textContent || 'No description available';
      const imgElement = exampleCard.querySelector('img');
      const imgSrc = imgElement ? imgElement.src : '';
      
      if (imgSrc) {
        showExampleDetail(titleText, promptText, imgSrc);
      } else {
        showNotification('Error: Data gambar tidak lengkap', 'danger');
      }
    }
  }
}, 300);

// Cleanup function untuk mencegah memory leak
function cleanupAllEventListeners() {
  console.log('Cleaning up all event listeners...');
  
  // Remove example card event listeners
  if (window.exampleImageClickHandler) {
    document.removeEventListener('click', window.exampleImageClickHandler);
    window.exampleImageClickHandler = null;
  }
  
  // Remove optimized event listener
  document.removeEventListener('click', optimizedExampleCardClick);
  
  // Remove global error handlers
  window.removeEventListener('error', window.globalErrorHandler);
  window.removeEventListener('unhandledrejection', window.globalRejectionHandler);
  
  console.log('All event listeners cleaned up');
}

// Register cleanup on page unload
window.addEventListener('beforeunload', cleanupAllEventListeners);
</script>
{% endblock %}